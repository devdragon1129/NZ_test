import { EventDispatcher, EventDispatcherBinding } from '../common/core/EventDispatcher';
export class EventSubscriber extends EventDispatcher {
    constructor(component) {
        super();
        this.component = component;
        component.onSubscribedEvent((data) => {
            super.emit(data.event, data);
        });
    }
    on(event, handler) {
        if (this.getEventBindings(event).length === 0) {
            this.component.subscribe(event).catch(e => this.emit('error', e));
        }
        return super.on.apply(this, arguments);
    }
    off(event) {
        let theEventToValidate = null;
        const offResult = super.off.apply(this, arguments);
        if (typeof event === 'string') {
            theEventToValidate = event;
        }
        else if (event instanceof EventDispatcherBinding) {
            event = event.event;
        }
        if (theEventToValidate !== null) {
            if (this.getEventBindings(theEventToValidate).length === 0) {
                this.component.unsubscribe(theEventToValidate).catch(e => this.emit('error', e));
            }
        }
        return offResult;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRXZlbnRTdWJzY3JpYmVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2NsaWVudC9FdmVudFN1YnNjcmliZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLGVBQWUsRUFBRSxzQkFBc0IsRUFBRSxNQUFNLGdDQUFnQyxDQUFBO0FBR3hGLE1BQU0sT0FBTyxlQUFnQixTQUFRLGVBQWU7SUFDbEQsWUFBb0IsU0FBMkI7UUFDN0MsS0FBSyxFQUFFLENBQUE7UUFEVyxjQUFTLEdBQVQsU0FBUyxDQUFrQjtRQUc3QyxTQUFTLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxJQUFTLEVBQUUsRUFBRTtZQUN4QyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUE7UUFDOUIsQ0FBQyxDQUFDLENBQUE7SUFDSixDQUFDO0lBU0QsRUFBRSxDQUFDLEtBQWEsRUFBRSxPQUFZO1FBQzVCLElBQUksSUFBSSxDQUFDLGdCQUFnQixDQUFDLEtBQUssQ0FBQyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7WUFDN0MsSUFBSSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQTtTQUNsRTtRQUNELE9BQU8sS0FBSyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLFNBQWdCLENBQUMsQ0FBQTtJQUMvQyxDQUFDO0lBT0QsR0FBRyxDQUFDLEtBQWlEO1FBQ25ELElBQUksa0JBQWtCLEdBQWtCLElBQUksQ0FBQTtRQUM1QyxNQUFNLFNBQVMsR0FBRyxLQUFLLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsU0FBZ0IsQ0FBQyxDQUFBO1FBRXpELElBQUksT0FBTyxLQUFLLEtBQUssUUFBUSxFQUFFO1lBQzdCLGtCQUFrQixHQUFHLEtBQUssQ0FBQTtTQUMzQjthQUFNLElBQUksS0FBSyxZQUFZLHNCQUFzQixFQUFFO1lBQ2xELEtBQUssR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFBO1NBQ3BCO1FBRUQsSUFBSSxrQkFBa0IsS0FBSyxJQUFJLEVBQUU7WUFDL0IsSUFBSSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO2dCQUkxRCxJQUFJLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUE7YUFDakY7U0FDRjtRQUVELE9BQU8sU0FBUyxDQUFBO0lBQ2xCLENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEV2ZW50RGlzcGF0Y2hlciwgRXZlbnREaXNwYXRjaGVyQmluZGluZyB9IGZyb20gJy4uL2NvbW1vbi9jb3JlL0V2ZW50RGlzcGF0Y2hlcidcbmltcG9ydCB7IElTdWJzY3JpYmFibGVBUEkgfSBmcm9tICcuLi9ob3N0L0FQSSdcblxuZXhwb3J0IGNsYXNzIEV2ZW50U3Vic2NyaWJlciBleHRlbmRzIEV2ZW50RGlzcGF0Y2hlciB7XG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgY29tcG9uZW50OiBJU3Vic2NyaWJhYmxlQVBJKSB7XG4gICAgc3VwZXIoKVxuXG4gICAgY29tcG9uZW50Lm9uU3Vic2NyaWJlZEV2ZW50KChkYXRhOiBhbnkpID0+IHtcbiAgICAgIHN1cGVyLmVtaXQoZGF0YS5ldmVudCwgZGF0YSlcbiAgICB9KVxuICB9XG5cbiAgLyoqXG4gICAqIFJlZ2lzdGVycyBhIG5ldyBsaXN0ZW5lciBmb3IgYW4gc3BlY2lmaWMgZXZlbnQuXG4gICAqIEBwYXJhbSBldmVudCBUaGUgbmFtZSBvZiB0aGUgZXZlbnRcbiAgICogQHBhcmFtIGhhbmRsZXIgQSBoYW5kbGVyIHdoaWNoIGJlIGNhbGxlZCBlYWNoIHRpbWUgdGhlIGV2ZW50IGlzIHJlY2VpdmVkXG4gICAqL1xuICBvbihldmVudDogc3RyaW5nLCBjYWxsYmFjazogKC4uLmFyZ3M6IGFueVtdKSA9PiB2b2lkLCBvbmNlPzogYm9vbGVhbik6IEV2ZW50RGlzcGF0Y2hlckJpbmRpbmdcbiAgb24oZXZlbnQ6IHN0cmluZywgY2FsbGJhY2s6IGFueSwgb25jZT86IGJvb2xlYW4pOiBFdmVudERpc3BhdGNoZXJCaW5kaW5nXG4gIG9uKGV2ZW50OiBzdHJpbmcsIGhhbmRsZXI6IGFueSkge1xuICAgIGlmICh0aGlzLmdldEV2ZW50QmluZGluZ3MoZXZlbnQpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgdGhpcy5jb21wb25lbnQuc3Vic2NyaWJlKGV2ZW50KS5jYXRjaChlID0+IHRoaXMuZW1pdCgnZXJyb3InLCBlKSlcbiAgICB9XG4gICAgcmV0dXJuIHN1cGVyLm9uLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyBhcyBhbnkpXG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlcyBhIGxpc3RlbmVyIGZvciBhbiBzcGVjaWZpYyBldmVudFxuICAgKiBAcGFyYW0gZXZlbnQgVGhlIG5hbWUgb2YgdGhlIGV2ZW50XG4gICAqIEBwYXJhbSBiaW5kaW5nIEEgcmVmZXJlbmNlIHRvIGEgYmluZGluZyByZXR1cm5lZCBieSBhIHByZXZpb3VzIGBhZGRFdmVudExpc3RlbmVyYCBjYWxsXG4gICAqL1xuICBvZmYoZXZlbnQ6IHN0cmluZyB8IEV2ZW50RGlzcGF0Y2hlckJpbmRpbmcgfCBGdW5jdGlvbikge1xuICAgIGxldCB0aGVFdmVudFRvVmFsaWRhdGU6IHN0cmluZyB8IG51bGwgPSBudWxsXG4gICAgY29uc3Qgb2ZmUmVzdWx0ID0gc3VwZXIub2ZmLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyBhcyBhbnkpXG5cbiAgICBpZiAodHlwZW9mIGV2ZW50ID09PSAnc3RyaW5nJykge1xuICAgICAgdGhlRXZlbnRUb1ZhbGlkYXRlID0gZXZlbnRcbiAgICB9IGVsc2UgaWYgKGV2ZW50IGluc3RhbmNlb2YgRXZlbnREaXNwYXRjaGVyQmluZGluZykge1xuICAgICAgZXZlbnQgPSBldmVudC5ldmVudFxuICAgIH1cblxuICAgIGlmICh0aGVFdmVudFRvVmFsaWRhdGUgIT09IG51bGwpIHtcbiAgICAgIGlmICh0aGlzLmdldEV2ZW50QmluZGluZ3ModGhlRXZlbnRUb1ZhbGlkYXRlKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgLy8gSWYgd2UgYXJlIHJlbW92aW5nIHRoZSBsYXN0IGV2ZW50IGxpc3RlbmVyLCByZW1vdmUgaXQgYWxzbyBmcm9tIHRoZSBjb21wb25lbnRcbiAgICAgICAgLy8gdGhpcyB3aWxsIGtlZXAgbGlzdGVuZXJzIHVucmVsYXRlZCB0byB0aGUgY29tcG9uZW50IGludGFjdFxuXG4gICAgICAgIHRoaXMuY29tcG9uZW50LnVuc3Vic2NyaWJlKHRoZUV2ZW50VG9WYWxpZGF0ZSkuY2F0Y2goZSA9PiB0aGlzLmVtaXQoJ2Vycm9yJywgZSkpXG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIG9mZlJlc3VsdFxuICB9XG59XG4iXX0=