{"ast":null,"code":"function _createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"]; if (!it) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it.return != null) it.return(); } finally { if (didErr) throw err; } } }; }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nimport { createSelector } from 'reselect';\nimport { isLoadingType } from 'decentraland-dapps/dist/modules/loading/selectors';\nimport { getAddress } from 'decentraland-dapps/dist/modules/wallet/selectors';\nimport { getAuthorizedCollections, getData as getCollectionData } from 'modules/collection/selectors';\nimport { getEntities } from 'modules/entity/selectors';\nimport { getCurationsByCollectionId } from 'modules/curations/collectionCuration/selectors';\nimport { getItemCurationsByItemId } from 'modules/curations/itemCuration/selectors';\nimport { CurationStatus } from 'modules/curations/types';\nimport { getItemThirdParty } from 'modules/thirdParty/selectors';\nimport { isUserManagerOfThirdParty } from 'modules/thirdParty/utils';\nimport { isEqual } from 'lib/address';\nimport { buildCatalystItemURN, isThirdParty } from '../../lib/urn';\nimport { DOWNLOAD_ITEM_REQUEST } from './actions';\nimport { SyncStatus } from './types';\nimport { areSynced, canSeeItem, isOwner } from './utils';\nexport var getState = function getState(state) {\n  return state.item;\n};\nexport var getData = function getData(state) {\n  return getState(state).data;\n};\nexport var getLoading = function getLoading(state) {\n  return getState(state).loading;\n};\nexport var getPaginationData = function getPaginationData(state, collectionId) {\n  var _getState$pagination;\n\n  return (_getState$pagination = getState(state).pagination) === null || _getState$pagination === void 0 ? void 0 : _getState$pagination[collectionId];\n};\nexport var getError = function getError(state) {\n  return getState(state).error;\n};\nexport var getItems = createSelector(getData, function (itemData) {\n  return Object.values(itemData);\n});\nexport var getItem = function getItem(state, itemId) {\n  var items = getItems(state);\n  return items.find(function (item) {\n    return item.id === itemId;\n  }) || null;\n};\nexport var getWalletItems = createSelector(getItems, getAddress, function (items, address) {\n  return items.filter(function (item) {\n    return address && isEqual(item.owner, address);\n  });\n});\nexport var getAuthorizedItems = createSelector(function (state) {\n  return getAuthorizedCollections(state);\n}, function (state) {\n  return getItems(state);\n}, function (state) {\n  return getAddress(state);\n}, function (collections, items, address) {\n  if (!address) {\n    return [];\n  }\n\n  return items.filter(function (item) {\n    var collection = collections.filter(function (collection) {\n      return collection.id === item.collectionId;\n    })[0];\n    return canSeeItem(collection, item, address);\n  });\n});\nexport var getWalletOrphanItems = createSelector(getAuthorizedItems, function (items) {\n  return items.filter(function (item) {\n    return item.collectionId === undefined;\n  });\n});\nexport var getPaginatedWalletOrphanItems = function getPaginatedWalletOrphanItems(state, address, pageSize) {\n  var paginationData = getPaginationData(state, address);\n  var allItems = getData(state);\n  var ids = paginationData ? pageSize ? paginationData.ids.slice(0, pageSize) : paginationData.ids : [];\n  return ids.map(function (itemId) {\n    return allItems[itemId];\n  }).filter(Boolean);\n};\nexport var getCollectionItems = function getCollectionItems(state, collectionId) {\n  var allItems = getItems(state);\n  return allItems.filter(function (item) {\n    return item.collectionId === collectionId;\n  });\n};\nexport var getPaginatedCollectionItems = function getPaginatedCollectionItems(state, collectionId, pageSize) {\n  var paginationData = getPaginationData(state, collectionId);\n  var allItems = getData(state);\n  var ids = paginationData ? pageSize ? paginationData.ids.slice(0, pageSize) : paginationData.ids : [];\n  return ids.map(function (itemId) {\n    return allItems[itemId];\n  }).filter(Boolean);\n};\nexport var getRarities = function getRarities(state) {\n  return getState(state).rarities;\n};\nexport var getItemsByURN = createSelector(function (state) {\n  return getItems(state);\n}, function (state) {\n  return getCollectionData(state);\n}, function (items, collectionsById) {\n  var itemsByURN = {};\n\n  var _iterator = _createForOfIteratorHelper(items.filter(function (item) {\n    return item.isPublished;\n  })),\n      _step;\n\n  try {\n    for (_iterator.s(); !(_step = _iterator.n()).done;) {\n      var item = _step.value;\n      var collection = collectionsById[item.collectionId];\n\n      if (collection) {\n        var urn = buildCatalystItemURN(collection.contractAddress, item.tokenId);\n        itemsByURN[urn] = item;\n      }\n    }\n  } catch (err) {\n    _iterator.e(err);\n  } finally {\n    _iterator.f();\n  }\n\n  return itemsByURN;\n});\nexport var getEntityByItemId = createSelector(function (state) {\n  return getEntities(state);\n}, function (state) {\n  return getItemsByURN(state);\n}, function (entities, itemsByURN) {\n  return entities.reduce(function (obj, entity) {\n    var urn = entity.metadata.id;\n    var item = itemsByURN[urn];\n\n    if (item) {\n      obj[item.id] = entity;\n    }\n\n    return obj;\n  }, {});\n});\n\nvar getStatusForTP = function getStatusForTP(item, itemCuration) {\n  if (!item.isPublished && !itemCuration) {\n    return SyncStatus.UNPUBLISHED;\n  } else if (itemCuration && itemCuration.status === CurationStatus.PENDING) {\n    return SyncStatus.UNDER_REVIEW;\n  } else if (itemCuration && itemCuration.status === CurationStatus.APPROVED) {\n    // Blockchain content hash contains the hash in the catalyst for TP items\n    return item.currentContentHash !== item.catalystContentHash ? SyncStatus.UNSYNCED : SyncStatus.SYNCED;\n  }\n\n  return SyncStatus.UNPUBLISHED;\n};\n\nvar getStatusForStandard = function getStatusForStandard(item, collectionCuration, entity) {\n  var status;\n\n  if (!item.isPublished) {\n    status = SyncStatus.UNPUBLISHED;\n  } else if (!item.isApproved || collectionCuration && collectionCuration.status === CurationStatus.PENDING) {\n    status = SyncStatus.UNDER_REVIEW;\n  } else {\n    if (!entity) {\n      status = SyncStatus.LOADING;\n    } else if (areSynced(item, entity)) {\n      status = SyncStatus.SYNCED;\n    } else {\n      status = SyncStatus.UNSYNCED;\n    }\n  }\n\n  return status;\n};\n\nexport var getStatusByItemId = createSelector(function (state) {\n  return getItems(state);\n}, function (state) {\n  return getEntityByItemId(state);\n}, function (state) {\n  return getCurationsByCollectionId(state);\n}, getItemCurationsByItemId, function (items, entitiesByItemId, curationsByCollectionId, itemCurationByItemId) {\n  var statusByItemId = {};\n\n  var _iterator2 = _createForOfIteratorHelper(items),\n      _step2;\n\n  try {\n    for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n      var item = _step2.value;\n      statusByItemId[item.id] = isThirdParty(item.urn) ? getStatusForTP(item, itemCurationByItemId[item.id]) : getStatusForStandard(item, item.collectionId ? curationsByCollectionId[item.collectionId] : null, entitiesByItemId[item.id]);\n    }\n  } catch (err) {\n    _iterator2.e(err);\n  } finally {\n    _iterator2.f();\n  }\n\n  return statusByItemId;\n});\nexport var getStatusForItemIds = createSelector(function (_state, itemIds) {\n  return itemIds;\n}, getStatusByItemId, function (itemIds, statusByItemId) {\n  return itemIds.reduce(function (acc, currItemId) {\n    acc[currItemId] = statusByItemId[currItemId];\n    return acc;\n  }, {});\n});\nexport var isDownloading = function isDownloading(state) {\n  return isLoadingType(getLoading(state), DOWNLOAD_ITEM_REQUEST);\n};\nexport var hasViewAndEditRights = function hasViewAndEditRights(state, address, collection, item) {\n  var thirdPartyItem = isThirdParty(item.urn) ? getItemThirdParty(state, item) : null;\n  return thirdPartyItem !== null && isUserManagerOfThirdParty(address, thirdPartyItem) || (collection !== null ? canSeeItem(collection, item, address) : isOwner(item, address));\n};","map":{"version":3,"sources":["/opt/work/NZ_test/src/modules/item/selectors.ts"],"names":["createSelector","isLoadingType","getAddress","getAuthorizedCollections","getData","getCollectionData","getEntities","getCurationsByCollectionId","getItemCurationsByItemId","CurationStatus","getItemThirdParty","isUserManagerOfThirdParty","isEqual","buildCatalystItemURN","isThirdParty","DOWNLOAD_ITEM_REQUEST","SyncStatus","areSynced","canSeeItem","isOwner","getState","state","item","data","getLoading","loading","getPaginationData","collectionId","pagination","getError","error","getItems","itemData","Object","values","getItem","itemId","items","find","id","getWalletItems","address","filter","owner","getAuthorizedItems","collections","collection","getWalletOrphanItems","undefined","getPaginatedWalletOrphanItems","pageSize","paginationData","allItems","ids","slice","map","Boolean","getCollectionItems","getPaginatedCollectionItems","getRarities","rarities","getItemsByURN","collectionsById","itemsByURN","isPublished","urn","contractAddress","tokenId","getEntityByItemId","entities","reduce","obj","entity","metadata","getStatusForTP","itemCuration","UNPUBLISHED","status","PENDING","UNDER_REVIEW","APPROVED","currentContentHash","catalystContentHash","UNSYNCED","SYNCED","getStatusForStandard","collectionCuration","isApproved","LOADING","getStatusByItemId","entitiesByItemId","curationsByCollectionId","itemCurationByItemId","statusByItemId","getStatusForItemIds","_state","itemIds","acc","currItemId","isDownloading","hasViewAndEditRights","thirdPartyItem"],"mappings":"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","sourcesContent":["import { Entity } from 'dcl-catalyst-commons'\nimport { createSelector } from 'reselect'\nimport { isLoadingType } from 'decentraland-dapps/dist/modules/loading/selectors'\nimport { getAddress } from 'decentraland-dapps/dist/modules/wallet/selectors'\nimport { RootState } from 'modules/common/types'\nimport { Collection } from 'modules/collection/types'\nimport { getAuthorizedCollections, getData as getCollectionData } from 'modules/collection/selectors'\nimport { getEntities } from 'modules/entity/selectors'\nimport { EntityState } from 'modules/entity/reducer'\nimport { CollectionCuration } from 'modules/curations/collectionCuration/types'\nimport { getCurationsByCollectionId } from 'modules/curations/collectionCuration/selectors'\nimport { ItemCuration } from 'modules/curations/itemCuration/types'\nimport { getItemCurationsByItemId } from 'modules/curations/itemCuration/selectors'\nimport { CurationStatus } from 'modules/curations/types'\nimport { getItemThirdParty } from 'modules/thirdParty/selectors'\nimport { isUserManagerOfThirdParty } from 'modules/thirdParty/utils'\nimport { isEqual } from 'lib/address'\nimport { buildCatalystItemURN, isThirdParty } from '../../lib/urn'\nimport { DOWNLOAD_ITEM_REQUEST } from './actions'\nimport { ItemState } from './reducer'\nimport { Item, SyncStatus, Rarity, CatalystItem } from './types'\nimport { areSynced, canSeeItem, isOwner } from './utils'\n\nexport const getState = (state: RootState) => state.item\nexport const getData = (state: RootState) => getState(state).data\nexport const getLoading = (state: RootState) => getState(state).loading\nexport const getPaginationData = (state: RootState, collectionId: string) => getState(state).pagination?.[collectionId]\nexport const getError = (state: RootState) => getState(state).error\n\nexport const getItems = createSelector<RootState, ItemState['data'], Item[]>(getData, itemData => Object.values(itemData))\n\nexport const getItem = (state: RootState, itemId: string) => {\n  const items = getItems(state)\n  return items.find(item => item.id === itemId) || null\n}\n\nexport const getWalletItems = createSelector<RootState, Item[], string | undefined, Item[]>(getItems, getAddress, (items, address) =>\n  items.filter(item => address && isEqual(item.owner, address))\n)\n\nexport const getAuthorizedItems = createSelector<RootState, Collection[], Item[], string | undefined, Item[]>(\n  state => getAuthorizedCollections(state),\n  state => getItems(state),\n  state => getAddress(state),\n  (collections, items, address) => {\n    if (!address) {\n      return []\n    }\n\n    return items.filter(item => {\n      const collection = collections.filter(collection => collection.id === item.collectionId)[0]\n      return canSeeItem(collection, item, address)\n    })\n  }\n)\n\nexport const getWalletOrphanItems = createSelector<RootState, Item[], Item[]>(getAuthorizedItems, items =>\n  items.filter(item => item.collectionId === undefined)\n)\n\nexport const getPaginatedWalletOrphanItems = (state: RootState, address: string, pageSize?: number) => {\n  const paginationData = getPaginationData(state, address)\n  const allItems = getData(state)\n  const ids = paginationData ? (pageSize ? paginationData.ids.slice(0, pageSize) : paginationData.ids) : []\n  return ids.map(itemId => allItems[itemId]).filter(Boolean)\n}\n\nexport const getCollectionItems = (state: RootState, collectionId: string) => {\n  const allItems = getItems(state)\n  return allItems.filter(item => item.collectionId === collectionId)\n}\n\nexport const getPaginatedCollectionItems = (state: RootState, collectionId: string, pageSize?: number) => {\n  const paginationData = getPaginationData(state, collectionId)\n  const allItems = getData(state)\n  const ids = paginationData ? (pageSize ? paginationData.ids.slice(0, pageSize) : paginationData.ids) : []\n  return ids.map(itemId => allItems[itemId]).filter(Boolean)\n}\n\nexport const getRarities = (state: RootState): Rarity[] => {\n  return getState(state).rarities\n}\n\nexport const getItemsByURN = createSelector<RootState, Item[], Record<string, Collection>, Record<string, Item>>(\n  state => getItems(state),\n  state => getCollectionData(state),\n  (items, collectionsById) => {\n    const itemsByURN: Record<string, Item> = {}\n    for (const item of items.filter(item => item.isPublished)) {\n      const collection = collectionsById[item.collectionId!]\n      if (collection) {\n        const urn = buildCatalystItemURN(collection.contractAddress!, item.tokenId!)\n        itemsByURN[urn] = item\n      }\n    }\n    return itemsByURN\n  }\n)\n\nexport const getEntityByItemId = createSelector<RootState, Entity[], Record<string, Item>, Record<string, Entity>>(\n  state => getEntities(state),\n  state => getItemsByURN(state),\n  (entities, itemsByURN) =>\n    entities.reduce((obj, entity) => {\n      const urn: string = (entity.metadata as CatalystItem).id\n      const item = itemsByURN[urn]\n      if (item) {\n        obj[item.id] = entity\n      }\n      return obj\n    }, {} as Record<string, Entity>)\n)\n\nconst getStatusForTP = (item: Item, itemCuration: ItemCuration | null): SyncStatus => {\n  if (!item.isPublished && !itemCuration) {\n    return SyncStatus.UNPUBLISHED\n  } else if (itemCuration && itemCuration.status === CurationStatus.PENDING) {\n    return SyncStatus.UNDER_REVIEW\n  } else if (itemCuration && itemCuration.status === CurationStatus.APPROVED) {\n    // Blockchain content hash contains the hash in the catalyst for TP items\n    return item.currentContentHash !== item.catalystContentHash ? SyncStatus.UNSYNCED : SyncStatus.SYNCED\n  }\n  return SyncStatus.UNPUBLISHED\n}\n\nconst getStatusForStandard = (item: Item, collectionCuration: CollectionCuration | null, entity: Entity): SyncStatus => {\n  let status: SyncStatus\n  if (!item.isPublished) {\n    status = SyncStatus.UNPUBLISHED\n  } else if (!item.isApproved || (collectionCuration && collectionCuration.status === CurationStatus.PENDING)) {\n    status = SyncStatus.UNDER_REVIEW\n  } else {\n    if (!entity) {\n      status = SyncStatus.LOADING\n    } else if (areSynced(item, entity)) {\n      status = SyncStatus.SYNCED\n    } else {\n      status = SyncStatus.UNSYNCED\n    }\n  }\n  return status\n}\n\nexport const getStatusByItemId = createSelector<\n  RootState,\n  Item[],\n  EntityState['data'],\n  Record<string, CollectionCuration>,\n  Record<string, ItemCuration>,\n  Record<string, SyncStatus>\n>(\n  state => getItems(state),\n  state => getEntityByItemId(state),\n  state => getCurationsByCollectionId(state),\n  getItemCurationsByItemId,\n  (items, entitiesByItemId, curationsByCollectionId, itemCurationByItemId) => {\n    const statusByItemId: Record<string, SyncStatus> = {}\n    for (const item of items) {\n      statusByItemId[item.id] = isThirdParty(item.urn)\n        ? getStatusForTP(item, itemCurationByItemId[item.id])\n        : getStatusForStandard(item, item.collectionId ? curationsByCollectionId[item.collectionId] : null, entitiesByItemId[item.id])\n    }\n    return statusByItemId\n  }\n)\n\nexport const getStatusForItemIds = createSelector<\n  RootState,\n  Item['id'][],\n  Item['id'][],\n  Record<string, SyncStatus>,\n  Record<string, SyncStatus>\n>(\n  (_state: RootState, itemIds: Item['id'][]) => itemIds,\n  getStatusByItemId,\n  (itemIds, statusByItemId) => {\n    return itemIds.reduce((acc, currItemId) => {\n      acc[currItemId] = statusByItemId[currItemId]\n      return acc\n    }, {} as Record<string, SyncStatus>)\n  }\n)\n\nexport const isDownloading = (state: RootState) => isLoadingType(getLoading(state), DOWNLOAD_ITEM_REQUEST)\n\nexport const hasViewAndEditRights = (state: RootState, address: string, collection: Collection | null, item: Item): boolean => {\n  const thirdPartyItem = isThirdParty(item.urn) ? getItemThirdParty(state, item) : null\n\n  return (\n    (thirdPartyItem !== null && isUserManagerOfThirdParty(address, thirdPartyItem)) ||\n    (collection !== null ? canSeeItem(collection, item, address) : isOwner(item, address))\n  )\n}\n"]},"metadata":{},"sourceType":"module"}