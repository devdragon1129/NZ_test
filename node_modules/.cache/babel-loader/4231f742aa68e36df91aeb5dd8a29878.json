{"ast":null,"code":"import _regeneratorRuntime from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _objectWithoutProperties from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport _defineProperty from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"]; if (!it) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it.return != null) it.return(); } finally { if (didErr) throw err; } } }; }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nimport { Address } from 'web3x/address';\nimport { constants } from 'ethers';\nimport { WearableBodyShape, WearableCategory } from '@dcl/schemas';\nimport future from 'fp-future';\nimport { getContentsStorageUrl } from 'lib/api/builder';\nimport { computeHashFromContent } from 'modules/deployment/contentUtils';\nimport { canSeeCollection, canMintCollectionItems, canManageCollectionItems } from 'modules/collection/utils';\nimport { isEqual } from 'lib/address';\nimport { sortByCreatedAt } from 'lib/sort';\nimport { extractThirdPartyTokenId, decodeURN } from 'lib/urn';\nimport { NO_CACHE_HEADERS } from 'lib/headers';\nimport { ItemRarity, ItemType, BodyShapeType, RARITY_MAX_SUPPLY, RARITY_COLOR_LIGHT, RARITY_COLOR, IMAGE_CATEGORIES, THUMBNAIL_PATH, SyncStatus, ItemMetadataType, EmoteCategory } from './types';\nexport var MAX_FILE_SIZE = 2097152; // 2MB\n\nexport var MAX_NFTS_PER_MINT = 50;\nexport var UNSYNCED_STATES = new Set([SyncStatus.UNSYNCED, SyncStatus.UNDER_REVIEW]);\nexport function getMaxSupply(item) {\n  return getMaxSupplyForRarity(item.rarity);\n}\nexport function getMaxSupplyForRarity(rarity) {\n  return RARITY_MAX_SUPPLY[rarity];\n}\nexport function getBodyShapeType(item) {\n  var bodyShapes = getBodyShapes(item);\n  var hasMale = bodyShapes.includes(WearableBodyShape.MALE);\n  var hasFemale = bodyShapes.includes(WearableBodyShape.FEMALE);\n\n  if (hasMale && hasFemale) {\n    return BodyShapeType.BOTH;\n  } else if (hasMale) {\n    return BodyShapeType.MALE;\n  } else if (hasFemale) {\n    return BodyShapeType.FEMALE;\n  } else {\n    throw new Error(\"Couldn't find a valid representation: \".concat(JSON.stringify(item.data.representations, null, 2)));\n  }\n}\nexport function getBodyShapes(item) {\n  var bodyShapes = new Set();\n\n  var _iterator = _createForOfIteratorHelper(item.data.representations),\n      _step;\n\n  try {\n    for (_iterator.s(); !(_step = _iterator.n()).done;) {\n      var representation = _step.value;\n\n      var _iterator2 = _createForOfIteratorHelper(representation.bodyShapes),\n          _step2;\n\n      try {\n        for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n          var bodyShape = _step2.value;\n          bodyShapes.add(bodyShape);\n        }\n      } catch (err) {\n        _iterator2.e(err);\n      } finally {\n        _iterator2.f();\n      }\n    }\n  } catch (err) {\n    _iterator.e(err);\n  } finally {\n    _iterator.f();\n  }\n\n  return Array.from(bodyShapes);\n}\nexport function getMissingBodyShapeType(item) {\n  var existingBodyShapeType = getBodyShapeType(item);\n\n  if (existingBodyShapeType === BodyShapeType.MALE) {\n    return BodyShapeType.FEMALE;\n  }\n\n  if (existingBodyShapeType === BodyShapeType.FEMALE) {\n    return BodyShapeType.MALE;\n  }\n\n  return null;\n}\nexport function hasBodyShape(item, bodyShape) {\n  return item.data.representations.some(function (representation) {\n    return representation.bodyShapes.includes(bodyShape);\n  });\n}\nexport function toWearableBodyShapeType(wearableBodyShape) {\n  // wearableBodyShape looks like \"urn:decentraland:off-chain:base-avatars:BaseMale\" (WearableBodyShape.MALE) and we just want the \"BaseMale\" part\n  return decodeURN(wearableBodyShape).suffix;\n}\nexport function toBodyShapeType(wearableBodyShape) {\n  switch (wearableBodyShape) {\n    case WearableBodyShape.MALE:\n      return BodyShapeType.MALE;\n\n    case WearableBodyShape.FEMALE:\n      return BodyShapeType.FEMALE;\n  }\n}\nexport function getRarityIndex(rarity) {\n  var _ItemRarity$COMMON$It;\n\n  return (_ItemRarity$COMMON$It = {}, _defineProperty(_ItemRarity$COMMON$It, ItemRarity.COMMON, 0), _defineProperty(_ItemRarity$COMMON$It, ItemRarity.UNCOMMON, 1), _defineProperty(_ItemRarity$COMMON$It, ItemRarity.RARE, 2), _defineProperty(_ItemRarity$COMMON$It, ItemRarity.EPIC, 3), _defineProperty(_ItemRarity$COMMON$It, ItemRarity.LEGENDARY, 4), _defineProperty(_ItemRarity$COMMON$It, ItemRarity.MYTHIC, 5), _defineProperty(_ItemRarity$COMMON$It, ItemRarity.UNIQUE, 6), _ItemRarity$COMMON$It)[rarity];\n}\nexport function getBackgroundStyle(rarity) {\n  return rarity ? {\n    backgroundImage: \"radial-gradient(\".concat(RARITY_COLOR_LIGHT[rarity], \", \").concat(RARITY_COLOR[rarity], \")\")\n  } : {\n    backgroundColor: 'var(--secondary)'\n  };\n}\nexport function getItemMetadataType(item) {\n  switch (item.type) {\n    case ItemType.WEARABLE:\n      {\n        if (Object.keys(item.contents).some(function (path) {\n          return path.endsWith('.js');\n        })) {\n          return ItemMetadataType.SMART_WEARABLE;\n        }\n\n        return ItemMetadataType.WEARABLE;\n      }\n\n    case ItemType.EMOTE:\n      {\n        return ItemMetadataType.EMOTE;\n      }\n  }\n}\nexport function buildItemMetadata(version, type, name, description, category, bodyShapeTypes) {\n  return \"\".concat(version, \":\").concat(type, \":\").concat(name, \":\").concat(description, \":\").concat(category, \":\").concat(bodyShapeTypes);\n} // Metadata looks like this:\n// - Common: version:item_type:representation_id\n// - Wearables: version:item_type:representation_id:category:bodyshapes\n\nexport function getMetadata(item) {\n  switch (item.type) {\n    case ItemType.WEARABLE:\n      {\n        var data = item.data;\n        var bodyShapeTypes = getBodyShapes(item).map(toWearableBodyShapeType).join(',');\n\n        if (!data.category) {\n          throw new Error(\"Unknown item category \\\"\".concat(item.data, \"\\\"\"));\n        }\n\n        return buildItemMetadata(1, getItemMetadataType(item), item.name, item.description, data.category, bodyShapeTypes);\n      }\n\n    case ItemType.EMOTE:\n      {\n        var _data = item.data;\n\n        var _bodyShapeTypes = getBodyShapes(item).map(toWearableBodyShapeType).join(',');\n\n        if (!_data.category) {\n          throw new Error(\"Unknown item category \\\"\".concat(item.data, \"\\\"\"));\n        }\n\n        return buildItemMetadata(1, getItemMetadataType(item), item.name, item.description, _data.category, _bodyShapeTypes);\n      }\n\n    default:\n      throw new Error(\"Unknown item.type \\\"\".concat(item.type, \"\\\"\"));\n  }\n}\nexport function toItemObject(items) {\n  return items.reduce(function (obj, item) {\n    var _ref = item,\n        collection = _ref.collection,\n        itemWithoutCollection = _objectWithoutProperties(_ref, [\"collection\"]);\n\n    obj[item.id] = itemWithoutCollection;\n    return obj;\n  }, {});\n}\nexport function generateCatalystImage(_x, _x2) {\n  return _generateCatalystImage.apply(this, arguments);\n}\n\nfunction _generateCatalystImage() {\n  _generateCatalystImage = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(item, options) {\n    var catalystImage, catalystImageHash;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return generateImage(item, options);\n\n          case 2:\n            catalystImage = _context.sent;\n            _context.next = 5;\n            return computeHashFromContent(catalystImage);\n\n          case 5:\n            catalystImageHash = _context.sent;\n            return _context.abrupt(\"return\", {\n              content: catalystImage,\n              hash: catalystImageHash\n            });\n\n          case 7:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n  return _generateCatalystImage.apply(this, arguments);\n}\n\nexport function generateImage(_x3, _x4) {\n  return _generateImage.apply(this, arguments);\n}\n\nfunction _generateImage() {\n  _generateImage = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(item, options) {\n    var _options$width, _options$height;\n\n    var width, height, thumbnail, response, canvas, context, gradient, img, url, load, blob;\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            // Set default width and height\n            width = (_options$width = options === null || options === void 0 ? void 0 : options.width) !== null && _options$width !== void 0 ? _options$width : 512;\n            height = (_options$height = options === null || options === void 0 ? void 0 : options.height) !== null && _options$height !== void 0 ? _options$height : 512;\n\n            if (!(options !== null && options !== void 0 && options.thumbnail)) {\n              _context2.next = 6;\n              break;\n            }\n\n            thumbnail = options.thumbnail;\n            _context2.next = 14;\n            break;\n\n          case 6:\n            _context2.next = 8;\n            return fetch(getContentsStorageUrl(item.contents[item.thumbnail]), {\n              headers: NO_CACHE_HEADERS\n            });\n\n          case 8:\n            response = _context2.sent;\n\n            if (response.ok) {\n              _context2.next = 11;\n              break;\n            }\n\n            throw new Error(\"Error generating the image: \".concat(response.statusText));\n\n          case 11:\n            _context2.next = 13;\n            return response.blob();\n\n          case 13:\n            thumbnail = _context2.sent;\n\n          case 14:\n            // create canvas\n            canvas = document.createElement('canvas');\n            canvas.width = width;\n            canvas.height = height;\n            context = canvas.getContext('2d'); // fail\n\n            if (!(!context || !item.rarity)) {\n              _context2.next = 20;\n              break;\n            }\n\n            return _context2.abrupt(\"return\", thumbnail);\n\n          case 20:\n            // render gradient\n            gradient = context.createRadialGradient(width / 2, height / 2, 0, width / 2, height / 2, width / 1.75);\n            gradient.addColorStop(0, RARITY_COLOR_LIGHT[item.rarity]);\n            gradient.addColorStop(1, RARITY_COLOR[item.rarity]);\n            context.fillStyle = gradient;\n            context.fillRect(0, 0, width, height); // render item\n\n            img = document.createElement('img');\n            url = URL.createObjectURL(thumbnail);\n            load = future();\n            img.onload = load.resolve;\n            img.src = url;\n            _context2.next = 32;\n            return load;\n\n          case 32:\n            // wait for image to load\n            URL.revokeObjectURL(url);\n            context.drawImage(img, 0, 0, width, height);\n            blob = future();\n            canvas.toBlob(function (result) {\n              return result ? blob.resolve(result) : blob.reject(new Error('Error generating image blob'));\n            });\n            return _context2.abrupt(\"return\", blob);\n\n          case 37:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n  return _generateImage.apply(this, arguments);\n}\n\nexport function resizeImage(_x5) {\n  return _resizeImage.apply(this, arguments);\n}\n\nfunction _resizeImage() {\n  _resizeImage = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(image) {\n    var width,\n        height,\n        canvas,\n        context,\n        img,\n        url,\n        load,\n        blob,\n        _args3 = arguments;\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            width = _args3.length > 1 && _args3[1] !== undefined ? _args3[1] : 256;\n            height = _args3.length > 2 && _args3[2] !== undefined ? _args3[2] : 256;\n            // create canvas\n            canvas = document.createElement('canvas');\n            canvas.width = width;\n            canvas.height = height;\n            context = canvas.getContext('2d'); // fail\n\n            if (context) {\n              _context3.next = 8;\n              break;\n            }\n\n            return _context3.abrupt(\"return\", image);\n\n          case 8:\n            // render item\n            img = document.createElement('img');\n            url = URL.createObjectURL(image);\n            load = future();\n            img.onload = load.resolve;\n            img.src = url;\n            _context3.next = 15;\n            return load;\n\n          case 15:\n            // wait for image to load\n            URL.revokeObjectURL(url);\n            context.drawImage(img, 0, 0, width, height);\n            blob = future();\n            canvas.toBlob(function (result) {\n              return result ? blob.resolve(result) : blob.reject(new Error('Error generating image blob'));\n            });\n            return _context3.abrupt(\"return\", blob);\n\n          case 20:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n  return _resizeImage.apply(this, arguments);\n}\n\nexport function isComplete(item) {\n  return item.beneficiary !== undefined && item.price !== undefined;\n}\nexport function isOwner(item, address) {\n  return !!address && isEqual(item.owner, address);\n}\nexport function canSeeItem(collection, item, address) {\n  return canSeeCollection(collection, address) || isOwner(item, address);\n}\nexport function canMintItem(collection, item, address) {\n  var totalSupply = item.totalSupply || 0;\n  return !!address && item.isPublished && item.isApproved && totalSupply < getMaxSupply(item) && (isOwner(item, address) || canMintCollectionItems(collection, address));\n}\nexport function canManageItem(collection, item, address) {\n  return isOwner(item, address) || canManageCollectionItems(collection, address);\n}\nexport function getThumbnailURL(item) {\n  return getContentsStorageUrl(item.contents[item.thumbnail]);\n}\nexport function getRarities() {\n  return Object.values(ItemRarity);\n}\nexport function isImageCategory(category) {\n  return IMAGE_CATEGORIES.includes(category);\n}\nexport function isModelCategory(category) {\n  return !isImageCategory(category);\n}\nexport function getModelCategories() {\n  return WearableCategory.schema.enum.filter(function (category) {\n    return isModelCategory(category);\n  });\n}\nexport function getSkinHiddenCategories() {\n  return [WearableCategory.HEAD, WearableCategory.HAIR, WearableCategory.FACIAL_HAIR, WearableCategory.MOUTH, WearableCategory.EYEBROWS, WearableCategory.EYES, WearableCategory.UPPER_BODY, WearableCategory.LOWER_BODY, WearableCategory.FEET];\n}\n\nfunction getCategories() {\n  var contents = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var fileNames = Object.keys(contents);\n  return fileNames.some(isModelFile) ? getModelCategories() : IMAGE_CATEGORIES;\n}\n\nexport function getWearableCategories() {\n  var contents = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var ignoreCategories = new Set([WearableCategory.HEAD, WearableCategory.BODY_SHAPE]);\n  return getCategories(contents).filter(function (category) {\n    return !ignoreCategories.has(category);\n  });\n}\nexport function getEmoteCategories() {\n  return Object.values(EmoteCategory);\n}\nexport function getOverridesCategories() {\n  var contents = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var category = arguments.length > 1 ? arguments[1] : undefined;\n  var overrideCategories = getCategories(contents);\n\n  if (category === WearableCategory.SKIN) {\n    overrideCategories = overrideCategories.filter(function (overrideCategory) {\n      return !getSkinHiddenCategories().includes(overrideCategory) && overrideCategory !== WearableCategory.SKIN;\n    });\n  }\n\n  return overrideCategories;\n}\nexport function isFree(item) {\n  return item.price === '0' && item.beneficiary === Address.ZERO.toString();\n}\nexport function isImageFile(fileName) {\n  return fileName.toLowerCase().endsWith('.png');\n}\nexport function isModelFile(fileName) {\n  fileName = fileName.toLowerCase();\n  return fileName.endsWith('.gltf') || fileName.endsWith('.glb');\n}\nexport function isModelPath(fileName) {\n  fileName = fileName.toLowerCase(); // we ignore PNG files that end with \"_mask\", since those are auxiliary\n\n  var isMask = fileName.includes('_mask');\n  return isModelFile(fileName) || fileName.indexOf(THUMBNAIL_PATH) === -1 && !isMask && isImageFile(fileName);\n}\nexport function isValidText(text) {\n  var invalidCharacters = [':'];\n  var invalidCharactersRegex = new RegExp(invalidCharacters.join('|'));\n  return text.search(invalidCharactersRegex) === -1;\n}\nexport function isItemSizeError(error) {\n  return error.search('The deployment is too big. The maximum allowed size per pointer is') !== -1;\n}\nexport function toThirdPartyContractItems(items) {\n  return items.sort(sortByCreatedAt).map(function (item) {\n    return [extractThirdPartyTokenId(item.urn), getMetadata(item)];\n  });\n}\nexport function toInitializeItems(items) {\n  return items.sort(sortByCreatedAt).map(toInitializeItem);\n}\nexport function toInitializeItem(item) {\n  var _item$beneficiary;\n\n  return [item.rarity.toLowerCase(), item.price || '0', (_item$beneficiary = item.beneficiary) !== null && _item$beneficiary !== void 0 ? _item$beneficiary : constants.AddressZero, getMetadata(item)];\n}\nexport function areEqualArrays(a, b) {\n  var setA = new Set(a);\n  var setB = new Set(b);\n  return setA.size === setB.size && a.every(function (elemA) {\n    return setB.has(elemA);\n  }) && b.every(function (elemB) {\n    return setA.has(elemB);\n  });\n}\nexport function areEqualRepresentations(a, b) {\n  if (a.length !== b.length) {\n    return false;\n  }\n\n  for (var i = 0; i < a.length; i++) {\n    var repA = a[i];\n    var repB = b[i];\n    var areEqual = areEqualArrays(repA.bodyShapes, repB.bodyShapes) && areEqualArrays(repA.contents, repB.contents) && repA.mainFile === repB.mainFile;\n\n    if (!areEqual) {\n      return false;\n    }\n\n    if (repA.overrideHides && repB.overrideHides && repA.overrideReplaces && repB.overrideReplaces) {\n      var areEqualOverrides = areEqualArrays(repA.overrideHides, repB.overrideHides) && areEqualArrays(repA.overrideReplaces, repB.overrideReplaces);\n\n      if (!areEqualOverrides) {\n        return false;\n      }\n    }\n  }\n\n  return true;\n}\nexport function areSynced(item, entity) {\n  // check if metadata is synced\n  var catalystItem = entity.metadata;\n  var hasMetadataChanged = item.type === ItemType.WEARABLE ? item.name !== catalystItem.name || item.description !== catalystItem.description || item.data.category !== catalystItem.data.category || item.data.hides.toString() !== catalystItem.data.hides.toString() || item.data.replaces.toString() !== catalystItem.data.replaces.toString() || item.data.tags.toString() !== catalystItem.data.tags.toString() : item.name !== catalystItem.name || item.description !== catalystItem.description || item.data.category !== catalystItem.data.category || item.data.tags.toString() !== catalystItem.data.tags.toString();\n\n  if (hasMetadataChanged) {\n    return false;\n  } // check if representations are synced\n\n\n  if (!areEqualRepresentations(item.data.representations, catalystItem.data.representations)) {\n    return false;\n  } // check if contents are synced\n\n\n  var contents = entity.content.reduce(function (map, entry) {\n    return map.set(entry.file, entry.hash);\n  }, new Map());\n\n  for (var path in item.contents) {\n    var hash = item.contents[path];\n\n    if (contents.get(path) !== hash) {\n      return false;\n    }\n  }\n\n  return true;\n}\nexport function isAllowedToPushChanges(item, status, itemCuration) {\n  if (!item.isApproved) {\n    return false; // push changes mechanism makes sense after they're in the blockchain\n  }\n\n  var isUnsynced = status === SyncStatus.UNSYNCED;\n  var curationHasAnotherContentHash = itemCuration && itemCuration.contentHash !== item.currentContentHash;\n  return isUnsynced || (status === SyncStatus.UNDER_REVIEW || status === SyncStatus.SYNCED || status === SyncStatus.LOADING) && curationHasAnotherContentHash;\n}\nexport function buildZipContents(contents, areEqual) {\n  var newContents = {};\n  var paths = Object.keys(contents);\n\n  for (var _i = 0, _paths = paths; _i < _paths.length; _i++) {\n    var path = _paths[_i];\n    var newPath = areEqual ? path.replace(BodyShapeType.FEMALE + '/', '').replace(BodyShapeType.MALE + '/', '') : path;\n    newContents[newPath] = contents[path];\n  }\n\n  return newContents;\n}\n/**\n * Builds an array of arrays by taking chunks of an specified size of an array.\n * @param array - The array to get the groups of.\n * @param size - The size of the groups of the array.\n */\n\nexport function groupsOf(array, size) {\n  if (size === 0) {\n    throw new Error('The groups size must be greater than 0');\n  }\n\n  var arrays = [];\n\n  for (var i = 0; i < array.length; i += size) {\n    arrays.push(array.slice(i, i + size));\n  }\n\n  return arrays;\n}\nexport var getItemsToPublish = function getItemsToPublish(items, itemsStatus) {\n  return items.filter(function (item) {\n    return itemsStatus[item.id] === SyncStatus.UNPUBLISHED;\n  });\n};\nexport var getItemsWithChanges = function getItemsWithChanges(items, itemsStatus, itemCurations) {\n  return items.filter(function (item) {\n    return isAllowedToPushChanges(item, itemsStatus[item.id], itemCurations === null || itemCurations === void 0 ? void 0 : itemCurations.find(function (itemCuration) {\n      return itemCuration.itemId === item.id;\n    }));\n  });\n};","map":{"version":3,"sources":["/opt/work/NZ_test/src/modules/item/utils.ts"],"names":["Address","constants","WearableBodyShape","WearableCategory","future","getContentsStorageUrl","computeHashFromContent","canSeeCollection","canMintCollectionItems","canManageCollectionItems","isEqual","sortByCreatedAt","extractThirdPartyTokenId","decodeURN","NO_CACHE_HEADERS","ItemRarity","ItemType","BodyShapeType","RARITY_MAX_SUPPLY","RARITY_COLOR_LIGHT","RARITY_COLOR","IMAGE_CATEGORIES","THUMBNAIL_PATH","SyncStatus","ItemMetadataType","EmoteCategory","MAX_FILE_SIZE","MAX_NFTS_PER_MINT","UNSYNCED_STATES","Set","UNSYNCED","UNDER_REVIEW","getMaxSupply","item","getMaxSupplyForRarity","rarity","getBodyShapeType","bodyShapes","getBodyShapes","hasMale","includes","MALE","hasFemale","FEMALE","BOTH","Error","JSON","stringify","data","representations","representation","bodyShape","add","Array","from","getMissingBodyShapeType","existingBodyShapeType","hasBodyShape","some","toWearableBodyShapeType","wearableBodyShape","suffix","toBodyShapeType","getRarityIndex","COMMON","UNCOMMON","RARE","EPIC","LEGENDARY","MYTHIC","UNIQUE","getBackgroundStyle","backgroundImage","backgroundColor","getItemMetadataType","type","WEARABLE","Object","keys","contents","path","endsWith","SMART_WEARABLE","EMOTE","buildItemMetadata","version","name","description","category","bodyShapeTypes","getMetadata","map","join","toItemObject","items","reduce","obj","collection","itemWithoutCollection","id","generateCatalystImage","options","generateImage","catalystImage","catalystImageHash","content","hash","width","height","thumbnail","fetch","headers","response","ok","statusText","blob","canvas","document","createElement","context","getContext","gradient","createRadialGradient","addColorStop","fillStyle","fillRect","img","url","URL","createObjectURL","load","onload","resolve","src","revokeObjectURL","drawImage","toBlob","result","reject","resizeImage","image","isComplete","beneficiary","undefined","price","isOwner","address","owner","canSeeItem","canMintItem","totalSupply","isPublished","isApproved","canManageItem","getThumbnailURL","getRarities","values","isImageCategory","isModelCategory","getModelCategories","schema","enum","filter","getSkinHiddenCategories","HEAD","HAIR","FACIAL_HAIR","MOUTH","EYEBROWS","EYES","UPPER_BODY","LOWER_BODY","FEET","getCategories","fileNames","isModelFile","getWearableCategories","ignoreCategories","BODY_SHAPE","has","getEmoteCategories","getOverridesCategories","overrideCategories","SKIN","overrideCategory","isFree","ZERO","toString","isImageFile","fileName","toLowerCase","isModelPath","isMask","indexOf","isValidText","text","invalidCharacters","invalidCharactersRegex","RegExp","search","isItemSizeError","error","toThirdPartyContractItems","sort","urn","toInitializeItems","toInitializeItem","AddressZero","areEqualArrays","a","b","setA","setB","size","every","elemA","elemB","areEqualRepresentations","length","i","repA","repB","areEqual","mainFile","overrideHides","overrideReplaces","areEqualOverrides","areSynced","entity","catalystItem","metadata","hasMetadataChanged","hides","replaces","tags","entry","set","file","Map","get","isAllowedToPushChanges","status","itemCuration","isUnsynced","curationHasAnotherContentHash","contentHash","currentContentHash","SYNCED","LOADING","buildZipContents","newContents","paths","newPath","replace","groupsOf","array","arrays","push","slice","getItemsToPublish","itemsStatus","UNPUBLISHED","getItemsWithChanges","itemCurations","find","itemId"],"mappings":"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","sourcesContent":["import { Address } from 'web3x/address'\nimport { constants } from 'ethers'\nimport { LocalItem } from '@dcl/builder-client'\nimport { WearableBodyShape, WearableCategory } from '@dcl/schemas'\nimport { Entity } from 'dcl-catalyst-commons'\nimport future from 'fp-future'\nimport { getContentsStorageUrl } from 'lib/api/builder'\nimport { Collection } from 'modules/collection/types'\nimport { ItemCuration } from 'modules/curations/itemCuration/types'\nimport { computeHashFromContent } from 'modules/deployment/contentUtils'\nimport { canSeeCollection, canMintCollectionItems, canManageCollectionItems } from 'modules/collection/utils'\nimport { isEqual } from 'lib/address'\nimport { sortByCreatedAt } from 'lib/sort'\nimport { extractThirdPartyTokenId, decodeURN } from 'lib/urn'\nimport { NO_CACHE_HEADERS } from 'lib/headers'\nimport {\n  Item,\n  ItemRarity,\n  ItemType,\n  WearableData,\n  BodyShapeType,\n  RARITY_MAX_SUPPLY,\n  RARITY_COLOR_LIGHT,\n  RARITY_COLOR,\n  WearableBodyShapeType,\n  IMAGE_CATEGORIES,\n  THUMBNAIL_PATH,\n  InitializeItem,\n  CatalystItem,\n  SyncStatus,\n  ThirdPartyContractItem,\n  ItemMetadataType,\n  WearableRepresentation,\n  GenerateImageOptions,\n  EmoteCategory,\n  EmoteData\n} from './types'\n\nexport const MAX_FILE_SIZE = 2097152 // 2MB\nexport const MAX_NFTS_PER_MINT = 50\nexport const UNSYNCED_STATES = new Set([SyncStatus.UNSYNCED, SyncStatus.UNDER_REVIEW])\n\nexport function getMaxSupply(item: Item) {\n  return getMaxSupplyForRarity(item.rarity!)\n}\n\nexport function getMaxSupplyForRarity(rarity: ItemRarity) {\n  return RARITY_MAX_SUPPLY[rarity]\n}\n\nexport function getBodyShapeType(item: Item): BodyShapeType {\n  const bodyShapes = getBodyShapes(item)\n  const hasMale = bodyShapes.includes(WearableBodyShape.MALE)\n  const hasFemale = bodyShapes.includes(WearableBodyShape.FEMALE)\n  if (hasMale && hasFemale) {\n    return BodyShapeType.BOTH\n  } else if (hasMale) {\n    return BodyShapeType.MALE\n  } else if (hasFemale) {\n    return BodyShapeType.FEMALE\n  } else {\n    throw new Error(`Couldn\\'t find a valid representation: ${JSON.stringify(item.data.representations, null, 2)}`)\n  }\n}\n\nexport function getBodyShapes(item: Item): WearableBodyShape[] {\n  const bodyShapes = new Set<WearableBodyShape>()\n  for (const representation of item.data.representations) {\n    for (const bodyShape of representation.bodyShapes) {\n      bodyShapes.add(bodyShape)\n    }\n  }\n  return Array.from(bodyShapes)\n}\n\nexport function getMissingBodyShapeType(item: Item) {\n  const existingBodyShapeType = getBodyShapeType(item)\n  if (existingBodyShapeType === BodyShapeType.MALE) {\n    return BodyShapeType.FEMALE\n  }\n  if (existingBodyShapeType === BodyShapeType.FEMALE) {\n    return BodyShapeType.MALE\n  }\n\n  return null\n}\n\nexport function hasBodyShape(item: Item, bodyShape: WearableBodyShape) {\n  return item.data.representations.some(representation => representation.bodyShapes.includes(bodyShape))\n}\n\nexport function toWearableBodyShapeType(wearableBodyShape: WearableBodyShape) {\n  // wearableBodyShape looks like \"urn:decentraland:off-chain:base-avatars:BaseMale\" (WearableBodyShape.MALE) and we just want the \"BaseMale\" part\n  return decodeURN(wearableBodyShape).suffix as WearableBodyShapeType\n}\n\nexport function toBodyShapeType(wearableBodyShape: WearableBodyShape): BodyShapeType {\n  switch (wearableBodyShape) {\n    case WearableBodyShape.MALE:\n      return BodyShapeType.MALE\n    case WearableBodyShape.FEMALE:\n      return BodyShapeType.FEMALE\n  }\n}\n\nexport function getRarityIndex(rarity: ItemRarity) {\n  return {\n    [ItemRarity.COMMON]: 0,\n    [ItemRarity.UNCOMMON]: 1,\n    [ItemRarity.RARE]: 2,\n    [ItemRarity.EPIC]: 3,\n    [ItemRarity.LEGENDARY]: 4,\n    [ItemRarity.MYTHIC]: 5,\n    [ItemRarity.UNIQUE]: 6\n  }[rarity]\n}\n\nexport function getBackgroundStyle(rarity?: ItemRarity) {\n  return rarity\n    ? { backgroundImage: `radial-gradient(${RARITY_COLOR_LIGHT[rarity]}, ${RARITY_COLOR[rarity]})` }\n    : { backgroundColor: 'var(--secondary)' }\n}\n\nexport function getItemMetadataType(item: Item) {\n  switch (item.type) {\n    case ItemType.WEARABLE: {\n      if (Object.keys(item.contents).some(path => path.endsWith('.js'))) {\n        return ItemMetadataType.SMART_WEARABLE\n      }\n      return ItemMetadataType.WEARABLE\n    }\n    case ItemType.EMOTE: {\n      return ItemMetadataType.EMOTE\n    }\n  }\n}\n\nexport function buildItemMetadata(\n  version: number,\n  type: ItemMetadataType,\n  name: string,\n  description: string,\n  category: string,\n  bodyShapeTypes: string\n): string {\n  return `${version}:${type}:${name}:${description}:${category}:${bodyShapeTypes}`\n}\n\n// Metadata looks like this:\n// - Common: version:item_type:representation_id\n// - Wearables: version:item_type:representation_id:category:bodyshapes\nexport function getMetadata(item: Item) {\n  switch (item.type) {\n    case ItemType.WEARABLE: {\n      const data = item.data as WearableData\n      const bodyShapeTypes = getBodyShapes(item)\n        .map(toWearableBodyShapeType)\n        .join(',')\n\n      if (!data.category) {\n        throw new Error(`Unknown item category \"${item.data}\"`)\n      }\n      return buildItemMetadata(1, getItemMetadataType(item), item.name, item.description, data.category, bodyShapeTypes)\n    }\n    case ItemType.EMOTE: {\n      const data = item.data as EmoteData\n      const bodyShapeTypes = getBodyShapes(item)\n        .map(toWearableBodyShapeType)\n        .join(',')\n      if (!data.category) {\n        throw new Error(`Unknown item category \"${item.data}\"`)\n      }\n      return buildItemMetadata(1, getItemMetadataType(item), item.name, item.description, data.category, bodyShapeTypes)\n    }\n    default:\n      throw new Error(`Unknown item.type \"${item.type}\"`)\n  }\n}\n\nexport function toItemObject(items: Item[]) {\n  return items.reduce((obj, item) => {\n    const { collection, ...itemWithoutCollection } = item as Item & { collection?: Collection }\n    obj[item.id] = itemWithoutCollection\n    return obj\n  }, {} as Record<string, Item>)\n}\n\nexport async function generateCatalystImage(item: Item | LocalItem, options?: GenerateImageOptions) {\n  const catalystImage = await generateImage(item, options)\n  const catalystImageHash = await computeHashFromContent(catalystImage)\n  return {\n    content: catalystImage,\n    hash: catalystImageHash\n  }\n}\n\nexport async function generateImage(item: Item | LocalItem, options?: GenerateImageOptions): Promise<Blob> {\n  // Set default width and height\n  const width: number = options?.width ?? 512\n  const height: number = options?.height ?? 512\n\n  let thumbnail: Blob\n\n  if (options?.thumbnail) {\n    thumbnail = options.thumbnail\n  } else {\n    // fetch thumbnail\n    const response = await fetch(getContentsStorageUrl(item.contents[item.thumbnail]), { headers: NO_CACHE_HEADERS })\n    if (!response.ok) throw new Error(`Error generating the image: ${response.statusText}`)\n\n    thumbnail = await response.blob()\n  }\n\n  // create canvas\n  const canvas = document.createElement('canvas')\n  canvas.width = width\n  canvas.height = height\n  const context = canvas.getContext('2d')\n\n  // fail\n  if (!context || !item.rarity) return thumbnail\n\n  // render gradient\n  const gradient = context.createRadialGradient(width / 2, height / 2, 0, width / 2, height / 2, width / 1.75)\n  gradient.addColorStop(0, RARITY_COLOR_LIGHT[item.rarity!])\n  gradient.addColorStop(1, RARITY_COLOR[item.rarity!])\n  context.fillStyle = gradient\n  context.fillRect(0, 0, width, height)\n\n  // render item\n  const img = document.createElement('img')\n  const url = URL.createObjectURL(thumbnail)\n  const load = future()\n  img.onload = load.resolve\n  img.src = url\n  await load // wait for image to load\n  URL.revokeObjectURL(url)\n  context.drawImage(img, 0, 0, width, height)\n\n  const blob = future<Blob>()\n  canvas.toBlob(result => (result ? blob.resolve(result) : blob.reject(new Error('Error generating image blob'))))\n  return blob\n}\n\nexport async function resizeImage(image: Blob, width = 256, height = 256) {\n  // create canvas\n  const canvas = document.createElement('canvas')\n  canvas.width = width\n  canvas.height = height\n  const context = canvas.getContext('2d')\n\n  // fail\n  if (!context) return image\n\n  // render item\n  const img = document.createElement('img')\n  const url = URL.createObjectURL(image)\n  const load = future()\n  img.onload = load.resolve\n  img.src = url\n  await load // wait for image to load\n  URL.revokeObjectURL(url)\n  context.drawImage(img, 0, 0, width, height)\n\n  const blob = future<Blob>()\n  canvas.toBlob(result => (result ? blob.resolve(result) : blob.reject(new Error('Error generating image blob'))))\n  return blob\n}\n\nexport function isComplete(item: Item) {\n  return item.beneficiary !== undefined && item.price !== undefined\n}\n\nexport function isOwner(item: Item, address?: string) {\n  return !!address && isEqual(item.owner, address)\n}\n\nexport function canSeeItem(collection: Collection, item: Item, address: string): boolean {\n  return canSeeCollection(collection, address) || isOwner(item, address)\n}\n\nexport function canMintItem(collection: Collection, item: Item, address?: string): boolean {\n  const totalSupply = item.totalSupply || 0\n  return (\n    !!address &&\n    item.isPublished &&\n    item.isApproved &&\n    totalSupply < getMaxSupply(item) &&\n    (isOwner(item, address) || canMintCollectionItems(collection, address))\n  )\n}\n\nexport function canManageItem(collection: Collection, item: Item, address?: string): boolean {\n  return isOwner(item, address) || canManageCollectionItems(collection, address)\n}\n\nexport function getThumbnailURL(item: Item) {\n  return getContentsStorageUrl(item.contents[item.thumbnail])\n}\n\nexport function getRarities() {\n  return Object.values(ItemRarity)\n}\n\nexport function isImageCategory(category: WearableCategory) {\n  return IMAGE_CATEGORIES.includes(category)\n}\n\nexport function isModelCategory(category: WearableCategory) {\n  return !isImageCategory(category)\n}\n\nexport function getModelCategories() {\n  return (WearableCategory.schema.enum as WearableCategory[]).filter(category => isModelCategory(category))\n}\n\nexport function getSkinHiddenCategories() {\n  return [\n    WearableCategory.HEAD,\n    WearableCategory.HAIR,\n    WearableCategory.FACIAL_HAIR,\n    WearableCategory.MOUTH,\n    WearableCategory.EYEBROWS,\n    WearableCategory.EYES,\n    WearableCategory.UPPER_BODY,\n    WearableCategory.LOWER_BODY,\n    WearableCategory.FEET\n  ]\n}\n\nfunction getCategories(contents: Record<string, any> | undefined = {}) {\n  const fileNames = Object.keys(contents)\n  return fileNames.some(isModelFile) ? getModelCategories() : IMAGE_CATEGORIES\n}\n\nexport function getWearableCategories(contents: Record<string, any> | undefined = {}) {\n  const ignoreCategories = new Set([WearableCategory.HEAD, WearableCategory.BODY_SHAPE])\n\n  return getCategories(contents).filter(category => !ignoreCategories.has(category))\n}\n\nexport function getEmoteCategories() {\n  return Object.values(EmoteCategory)\n}\n\nexport function getOverridesCategories(contents: Record<string, any> | undefined = {}, category?: WearableCategory) {\n  let overrideCategories = getCategories(contents)\n\n  if (category === WearableCategory.SKIN) {\n    overrideCategories = overrideCategories.filter(\n      overrideCategory => !getSkinHiddenCategories().includes(overrideCategory) && overrideCategory !== WearableCategory.SKIN\n    )\n  }\n\n  return overrideCategories\n}\n\nexport function isFree(item: Item) {\n  return item.price === '0' && item.beneficiary === Address.ZERO.toString()\n}\n\nexport function isImageFile(fileName: string) {\n  return fileName.toLowerCase().endsWith('.png')\n}\n\nexport function isModelFile(fileName: string) {\n  fileName = fileName.toLowerCase()\n  return fileName.endsWith('.gltf') || fileName.endsWith('.glb')\n}\n\nexport function isModelPath(fileName: string) {\n  fileName = fileName.toLowerCase()\n  // we ignore PNG files that end with \"_mask\", since those are auxiliary\n  const isMask = fileName.includes('_mask')\n  return isModelFile(fileName) || (fileName.indexOf(THUMBNAIL_PATH) === -1 && !isMask && isImageFile(fileName))\n}\n\nexport function isValidText(text: string) {\n  const invalidCharacters = [':']\n  const invalidCharactersRegex = new RegExp(invalidCharacters.join('|'))\n  return text.search(invalidCharactersRegex) === -1\n}\n\nexport function isItemSizeError(error: string) {\n  return error.search('The deployment is too big. The maximum allowed size per pointer is') !== -1\n}\n\nexport function toThirdPartyContractItems(items: Item[]): ThirdPartyContractItem[] {\n  return items.sort(sortByCreatedAt).map(item => [extractThirdPartyTokenId(item.urn!), getMetadata(item)])\n}\n\nexport function toInitializeItems(items: Item[]): InitializeItem[] {\n  return items.sort(sortByCreatedAt).map(toInitializeItem)\n}\n\nexport function toInitializeItem(item: Item): InitializeItem {\n  return [item.rarity!.toLowerCase(), item.price || '0', item.beneficiary ?? constants.AddressZero, getMetadata(item)]\n}\n\nexport function areEqualArrays<T>(a: T[], b: T[]) {\n  const setA = new Set(a)\n  const setB = new Set(b)\n  return setA.size === setB.size && a.every(elemA => setB.has(elemA)) && b.every(elemB => setA.has(elemB))\n}\n\nexport function areEqualRepresentations(a: WearableRepresentation[], b: WearableRepresentation[]) {\n  if (a.length !== b.length) {\n    return false\n  }\n  for (let i = 0; i < a.length; i++) {\n    const repA = a[i]\n    const repB = b[i]\n    const areEqual =\n      areEqualArrays(repA.bodyShapes, repB.bodyShapes) && areEqualArrays(repA.contents, repB.contents) && repA.mainFile === repB.mainFile\n    if (!areEqual) {\n      return false\n    }\n    if (repA.overrideHides && repB.overrideHides && repA.overrideReplaces && repB.overrideReplaces) {\n      const areEqualOverrides =\n        areEqualArrays(repA.overrideHides, repB.overrideHides) && areEqualArrays(repA.overrideReplaces, repB.overrideReplaces)\n      if (!areEqualOverrides) {\n        return false\n      }\n    }\n  }\n  return true\n}\n\nexport function areSynced(item: Item, entity: Entity) {\n  // check if metadata is synced\n  const catalystItem = entity.metadata! as CatalystItem\n  const hasMetadataChanged =\n    item.type === ItemType.WEARABLE\n      ? item.name !== catalystItem.name ||\n        item.description !== catalystItem.description ||\n        item.data.category !== catalystItem.data.category ||\n        item.data.hides.toString() !== catalystItem.data.hides.toString() ||\n        item.data.replaces.toString() !== catalystItem.data.replaces.toString() ||\n        item.data.tags.toString() !== catalystItem.data.tags.toString()\n      : item.name !== catalystItem.name ||\n        item.description !== catalystItem.description ||\n        item.data.category !== catalystItem.data.category ||\n        item.data.tags.toString() !== catalystItem.data.tags.toString()\n  if (hasMetadataChanged) {\n    return false\n  }\n\n  // check if representations are synced\n  if (!areEqualRepresentations(item.data.representations, catalystItem.data.representations)) {\n    return false\n  }\n\n  // check if contents are synced\n  const contents = entity.content!.reduce((map, entry) => map.set(entry.file, entry.hash), new Map<string, string>())\n  for (const path in item.contents) {\n    const hash = item.contents[path]\n    if (contents.get(path) !== hash) {\n      return false\n    }\n  }\n\n  return true\n}\n\nexport function isAllowedToPushChanges(item: Item, status: SyncStatus, itemCuration: ItemCuration | undefined) {\n  if (!item.isApproved) {\n    return false // push changes mechanism makes sense after they're in the blockchain\n  }\n  const isUnsynced = status === SyncStatus.UNSYNCED\n  const curationHasAnotherContentHash = itemCuration && itemCuration.contentHash !== item.currentContentHash\n  return (\n    isUnsynced ||\n    ((status === SyncStatus.UNDER_REVIEW || status === SyncStatus.SYNCED || status === SyncStatus.LOADING) && curationHasAnotherContentHash)\n  )\n}\n\nexport function buildZipContents(contents: Record<string, Blob | string>, areEqual: boolean) {\n  const newContents: Record<string, Blob | string> = {}\n  const paths = Object.keys(contents)\n  for (const path of paths) {\n    const newPath = areEqual ? path.replace(BodyShapeType.FEMALE + '/', '').replace(BodyShapeType.MALE + '/', '') : path\n    newContents[newPath] = contents[path]\n  }\n  return newContents\n}\n\n/**\n * Builds an array of arrays by taking chunks of an specified size of an array.\n * @param array - The array to get the groups of.\n * @param size - The size of the groups of the array.\n */\nexport function groupsOf<T>(array: T[], size: number): Array<Array<T>> {\n  if (size === 0) {\n    throw new Error('The groups size must be greater than 0')\n  }\n\n  const arrays = []\n  for (let i = 0; i < array.length; i += size) {\n    arrays.push(array.slice(i, i + size))\n  }\n  return arrays\n}\n\nexport const getItemsToPublish = (items: Item[], itemsStatus: Record<string, SyncStatus>) => {\n  return items.filter(item => itemsStatus[item.id] === SyncStatus.UNPUBLISHED)\n}\n\nexport const getItemsWithChanges = (items: Item[], itemsStatus: Record<string, SyncStatus>, itemCurations: ItemCuration[]) => {\n  return items.filter(item =>\n    isAllowedToPushChanges(\n      item,\n      itemsStatus[item.id],\n      itemCurations?.find(itemCuration => itemCuration.itemId === item.id)\n    )\n  )\n}\n"]},"metadata":{},"sourceType":"module"}