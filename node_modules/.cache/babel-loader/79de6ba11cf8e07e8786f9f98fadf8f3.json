{"ast":null,"code":"import _defineProperty from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _classCallCheck from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"/opt/work/NZ_test/src/components/ItemEditorPage/TopPanel/TopPanel.tsx\";\nimport React from 'react';\nimport { Button, Header, Icon, Loader, Popup } from 'decentraland-ui';\nimport { t } from 'decentraland-dapps/dist/modules/translation/utils';\nimport { locations } from 'routing/locations';\nimport { CurationStatus } from 'modules/curations/types';\nimport { getCollectionType, getTPThresholdToReview, hasReviews, isTPCollection } from 'modules/collection/utils';\nimport JumpIn from 'components/JumpIn';\nimport ConfirmApprovalModal from './ConfirmApprovalModal';\nimport RejectionModal from './RejectionModal';\nimport { RejectionType } from './RejectionModal/RejectionModal.types';\nimport { ButtonType } from './TopPanel.types';\nimport './TopPanel.css';\n\nvar TopPanel = /*#__PURE__*/function (_React$PureComponent) {\n  _inherits(TopPanel, _React$PureComponent);\n\n  function TopPanel() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, TopPanel);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(TopPanel)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      currentVeredict: undefined,\n      showRejectionModal: null,\n      showApproveConfirmModal: false\n    };\n\n    _this.handleBack = function () {\n      _this.props.onNavigate(locations.curation());\n    };\n\n    _this.handleConfirmApprovalModal = function (collection, curation) {\n      var _this$props = _this.props,\n          address = _this$props.address,\n          onInitiateApprovalFlow = _this$props.onInitiateApprovalFlow,\n          onInitiateTPApprovalFlow = _this$props.onInitiateTPApprovalFlow,\n          onSetAssignee = _this$props.onSetAssignee;\n\n      _this.setState({\n        showApproveConfirmModal: false\n      });\n\n      address && onSetAssignee(collection.id, address, curation);\n      isTPCollection(collection) ? onInitiateTPApprovalFlow(collection) : onInitiateApprovalFlow(collection);\n    };\n\n    _this.setShowRejectionModal = function (showRejectionModal) {\n      return _this.setState({\n        showRejectionModal: showRejectionModal\n      });\n    };\n\n    _this.renderPage = function (collection) {\n      var _this$props2 = _this.props,\n          items = _this$props2.items,\n          itemCurations = _this$props2.itemCurations,\n          curation = _this$props2.curation,\n          totalItems = _this$props2.totalItems;\n      var _this$state = _this.state,\n          showRejectionModal = _this$state.showRejectionModal,\n          showApproveConfirmModal = _this$state.showApproveConfirmModal;\n      var chainId = _this.props.chainId;\n      var type = getCollectionType(collection);\n      return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"actions\",\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 45,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"back\",\n        onClick: _this.handleBack,\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 46,\n          columnNumber: 11\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"title\",\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 48,\n          columnNumber: 9\n        }\n      }, collection.name, \"\\xA0\\xB7\\xA0\", t(\"collection.type.\".concat(type)), /*#__PURE__*/React.createElement(JumpIn, {\n        size: \"small\",\n        collection: collection,\n        chainId: chainId,\n        items: isTPCollection(collection) ? items : undefined,\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 52,\n          columnNumber: 11\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"actions\",\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 54,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"span\", {\n        className: \"button-container\",\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 55,\n          columnNumber: 11\n        }\n      }, isTPCollection(collection) && totalItems !== undefined ? _this.renderTPButtons(collection, curation, itemCurations) : _this.renderButtons(collection, curation))), showRejectionModal && /*#__PURE__*/React.createElement(RejectionModal, {\n        type: showRejectionModal,\n        open: true,\n        collection: collection,\n        curation: curation,\n        onClose: function onClose() {\n          return _this.setShowRejectionModal(null);\n        },\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 62,\n          columnNumber: 11\n        }\n      }), (curation === null || curation === void 0 ? void 0 : curation.assignee) && showApproveConfirmModal && /*#__PURE__*/React.createElement(ConfirmApprovalModal, {\n        open: true,\n        assignee: curation.assignee,\n        onConfirm: function onConfirm() {\n          return _this.handleConfirmApprovalModal(collection, curation);\n        },\n        onClose: function onClose() {\n          return _this.setState({\n            showApproveConfirmModal: false\n          });\n        },\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 71,\n          columnNumber: 11\n        }\n      }));\n    };\n\n    _this.renderButton = function (type, collection, curation) {\n      var _onClickMap, _i18nKeyByButtonType;\n\n      var _this$props3 = _this.props,\n          address = _this$props3.address,\n          onInitiateApprovalFlow = _this$props3.onInitiateApprovalFlow,\n          onInitiateTPApprovalFlow = _this$props3.onInitiateTPApprovalFlow,\n          reviewedItems = _this$props3.reviewedItems,\n          totalItems = _this$props3.totalItems;\n      var onClickMap = (_onClickMap = {}, _defineProperty(_onClickMap, ButtonType.APPROVE, function () {\n        return curation !== null && curation !== void 0 && curation.assignee && address !== (curation === null || curation === void 0 ? void 0 : curation.assignee) ? _this.setState({\n          showApproveConfirmModal: true\n        }) : isTPCollection(collection) ? onInitiateTPApprovalFlow(collection) : onInitiateApprovalFlow(collection);\n      }), _defineProperty(_onClickMap, ButtonType.ENABLE, function () {\n        return onInitiateApprovalFlow(collection);\n      }), _defineProperty(_onClickMap, ButtonType.DISABLE, function () {\n        return _this.setShowRejectionModal(RejectionType.DISABLE_COLLECTION);\n      }), _defineProperty(_onClickMap, ButtonType.REJECT, function () {\n        if ((curation === null || curation === void 0 ? void 0 : curation.status) === CurationStatus.PENDING) {\n          _this.setShowRejectionModal(RejectionType.REJECT_CURATION);\n        } else {\n          _this.setShowRejectionModal(RejectionType.REJECT_COLLECTION);\n        }\n      }), _onClickMap);\n      var i18nKeyByButtonType = (_i18nKeyByButtonType = {}, _defineProperty(_i18nKeyByButtonType, ButtonType.APPROVE, 'approve'), _defineProperty(_i18nKeyByButtonType, ButtonType.ENABLE, 'enable'), _defineProperty(_i18nKeyByButtonType, ButtonType.DISABLE, 'disable'), _defineProperty(_i18nKeyByButtonType, ButtonType.REJECT, 'reject'), _i18nKeyByButtonType);\n      var isPrimary = type === ButtonType.APPROVE || type === ButtonType.ENABLE;\n      var isApproveButtonPopupDisabled = !isTPCollection(collection) || !!totalItems && reviewedItems.length >= getTPThresholdToReview(totalItems);\n      return /*#__PURE__*/React.createElement(Popup, {\n        content: t('item_editor.top_panel.items_pending_to_review'),\n        disabled: isApproveButtonPopupDisabled,\n        position: \"bottom center\",\n        trigger: /*#__PURE__*/React.createElement(\"div\", {\n          __self: _assertThisInitialized(_assertThisInitialized(_this)),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 119,\n            columnNumber: 11\n          }\n        }, /*#__PURE__*/React.createElement(Button, {\n          primary: isPrimary,\n          onClick: function onClick() {\n            return onClickMap[type]();\n          },\n          disabled: isTPCollection(collection) && type === ButtonType.APPROVE && !!totalItems && reviewedItems.length < getTPThresholdToReview(totalItems),\n          __self: _assertThisInitialized(_assertThisInitialized(_this)),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 120,\n            columnNumber: 13\n          }\n        }, t(\"item_editor.top_panel.\".concat(i18nKeyByButtonType[type])))),\n        hideOnScroll: true,\n        on: \"hover\",\n        inverted: true,\n        flowing: true,\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 114,\n          columnNumber: 7\n        }\n      });\n    };\n\n    _this.renderTPButtons = function (collection, collectionCuration, itemCurations) {\n      var _this$props4 = _this.props,\n          reviewedItems = _this$props4.reviewedItems,\n          totalItems = _this$props4.totalItems;\n      var shouldShowApproveButton = itemCurations === null || itemCurations === void 0 ? void 0 : itemCurations.some(function (itemCuration) {\n        return itemCuration.status === CurationStatus.PENDING;\n      });\n      return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Header, {\n        sub: true,\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 147,\n          columnNumber: 9\n        }\n      }, t('item_editor.top_panel.reviewed_counter', {\n        count: reviewedItems.length,\n        threshold: getTPThresholdToReview(totalItems)\n      }), reviewedItems.length >= getTPThresholdToReview(totalItems) ? /*#__PURE__*/React.createElement(Icon, {\n        name: \"check circle\",\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 149,\n          columnNumber: 74\n        }\n      }) : null), shouldShowApproveButton ? _this.renderButton(ButtonType.APPROVE, collection, collectionCuration) : null, _this.renderButton(ButtonType.REJECT, collection, collectionCuration));\n    };\n\n    _this.renderButtons = function (collection, curation) {\n      if (curation && collection.isApproved) {\n        switch (curation.status) {\n          case 'pending':\n            return /*#__PURE__*/React.createElement(React.Fragment, null, _this.renderButton(ButtonType.APPROVE, collection, curation), _this.renderButton(ButtonType.REJECT, collection, curation));\n\n          case 'approved':\n          case 'rejected':\n            return _this.renderButton(ButtonType.DISABLE, collection, curation);\n        }\n      }\n\n      if (hasReviews(collection)) {\n        if (collection.isApproved) {\n          return _this.renderButton(ButtonType.DISABLE, collection, curation);\n        } else {\n          return _this.renderButton(ButtonType.ENABLE, collection, curation);\n        }\n      }\n\n      return /*#__PURE__*/React.createElement(React.Fragment, null, _this.renderButton(ButtonType.APPROVE, collection, curation), _this.renderButton(ButtonType.REJECT, collection, curation));\n    };\n\n    return _this;\n  }\n\n  _createClass(TopPanel, [{\n    key: \"render\",\n    value: function render() {\n      var _this$props5 = this.props,\n          collection = _this$props5.collection,\n          items = _this$props5.items,\n          isCommitteeMember = _this$props5.isCommitteeMember,\n          isReviewing = _this$props5.isReviewing,\n          isConnected = _this$props5.isConnected,\n          isLoading = _this$props5.isLoading; // Show loader only while loading the first page of items\n\n      var showLoader = !collection || isLoading && !items.length;\n      return isCommitteeMember && isReviewing && isConnected ? /*#__PURE__*/React.createElement(\"div\", {\n        className: \"TopPanel\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 196,\n          columnNumber: 7\n        }\n      }, showLoader ? /*#__PURE__*/React.createElement(Loader, {\n        size: \"small\",\n        active: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 196,\n          columnNumber: 47\n        }\n      }) : this.renderPage(collection)) : null;\n    }\n  }]);\n\n  return TopPanel;\n}(React.PureComponent);\n\nexport { TopPanel as default };","map":{"version":3,"sources":["/opt/work/NZ_test/src/components/ItemEditorPage/TopPanel/TopPanel.tsx"],"names":["React","Button","Header","Icon","Loader","Popup","t","locations","CurationStatus","getCollectionType","getTPThresholdToReview","hasReviews","isTPCollection","JumpIn","ConfirmApprovalModal","RejectionModal","RejectionType","ButtonType","TopPanel","state","currentVeredict","undefined","showRejectionModal","showApproveConfirmModal","handleBack","props","onNavigate","curation","handleConfirmApprovalModal","collection","address","onInitiateApprovalFlow","onInitiateTPApprovalFlow","onSetAssignee","setState","id","setShowRejectionModal","renderPage","items","itemCurations","totalItems","chainId","type","name","renderTPButtons","renderButtons","assignee","renderButton","reviewedItems","onClickMap","APPROVE","ENABLE","DISABLE","DISABLE_COLLECTION","REJECT","status","PENDING","REJECT_CURATION","REJECT_COLLECTION","i18nKeyByButtonType","isPrimary","isApproveButtonPopupDisabled","length","collectionCuration","shouldShowApproveButton","some","itemCuration","count","threshold","isApproved","isCommitteeMember","isReviewing","isConnected","isLoading","showLoader","PureComponent"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { Button, Header, Icon, Loader, Popup } from 'decentraland-ui'\nimport { t } from 'decentraland-dapps/dist/modules/translation/utils'\nimport { locations } from 'routing/locations'\nimport { Collection } from 'modules/collection/types'\nimport { CollectionCuration } from 'modules/curations/collectionCuration/types'\nimport { ItemCuration } from 'modules/curations/itemCuration/types'\nimport { CurationStatus } from 'modules/curations/types'\nimport { getCollectionType, getTPThresholdToReview, hasReviews, isTPCollection } from 'modules/collection/utils'\nimport JumpIn from 'components/JumpIn'\nimport ConfirmApprovalModal from './ConfirmApprovalModal'\nimport RejectionModal from './RejectionModal'\nimport { RejectionType } from './RejectionModal/RejectionModal.types'\nimport { ButtonType, Props, State } from './TopPanel.types'\nimport './TopPanel.css'\n\nexport default class TopPanel extends React.PureComponent<Props, State> {\n  state: State = {\n    currentVeredict: undefined,\n    showRejectionModal: null,\n    showApproveConfirmModal: false\n  }\n\n  handleBack = () => {\n    this.props.onNavigate(locations.curation())\n  }\n\n  handleConfirmApprovalModal = (collection: Collection, curation: CollectionCuration | null) => {\n    const { address, onInitiateApprovalFlow, onInitiateTPApprovalFlow, onSetAssignee } = this.props\n    this.setState({ showApproveConfirmModal: false })\n    address && onSetAssignee(collection.id, address, curation)\n    isTPCollection(collection) ? onInitiateTPApprovalFlow(collection) : onInitiateApprovalFlow(collection)\n  }\n\n  setShowRejectionModal = (showRejectionModal: RejectionType | null) => this.setState({ showRejectionModal })\n\n  renderPage = (collection: Collection) => {\n    const { items, itemCurations, curation, totalItems } = this.props\n    const { showRejectionModal, showApproveConfirmModal } = this.state\n    const { chainId } = this.props\n    const type = getCollectionType(collection)\n\n    return (\n      <>\n        <div className=\"actions\">\n          <div className=\"back\" onClick={this.handleBack} />\n        </div>\n        <div className=\"title\">\n          {collection.name}\n          &nbsp;·&nbsp;\n          {t(`collection.type.${type}`)}\n          <JumpIn size=\"small\" collection={collection} chainId={chainId} items={isTPCollection(collection) ? items : undefined} />\n        </div>\n        <div className=\"actions\">\n          <span className=\"button-container\">\n            {isTPCollection(collection) && totalItems !== undefined\n              ? this.renderTPButtons(collection, curation, itemCurations)\n              : this.renderButtons(collection, curation)}\n          </span>\n        </div>\n        {showRejectionModal && (\n          <RejectionModal\n            type={showRejectionModal}\n            open={true}\n            collection={collection}\n            curation={curation}\n            onClose={() => this.setShowRejectionModal(null)}\n          />\n        )}\n        {curation?.assignee && showApproveConfirmModal && (\n          <ConfirmApprovalModal\n            open\n            assignee={curation.assignee}\n            onConfirm={() => this.handleConfirmApprovalModal(collection, curation)}\n            onClose={() => this.setState({ showApproveConfirmModal: false })}\n          />\n        )}\n      </>\n    )\n  }\n\n  renderButton = (type: ButtonType, collection: Collection, curation: CollectionCuration | null) => {\n    const { address, onInitiateApprovalFlow, onInitiateTPApprovalFlow, reviewedItems, totalItems } = this.props\n\n    const onClickMap = {\n      [ButtonType.APPROVE]: () =>\n        curation?.assignee && address !== curation?.assignee\n          ? this.setState({ showApproveConfirmModal: true })\n          : isTPCollection(collection)\n          ? onInitiateTPApprovalFlow(collection)\n          : onInitiateApprovalFlow(collection),\n      [ButtonType.ENABLE]: () => onInitiateApprovalFlow(collection),\n      [ButtonType.DISABLE]: () => this.setShowRejectionModal(RejectionType.DISABLE_COLLECTION),\n      [ButtonType.REJECT]: () => {\n        if (curation?.status === CurationStatus.PENDING) {\n          this.setShowRejectionModal(RejectionType.REJECT_CURATION)\n        } else {\n          this.setShowRejectionModal(RejectionType.REJECT_COLLECTION)\n        }\n      }\n    }\n\n    const i18nKeyByButtonType = {\n      [ButtonType.APPROVE]: 'approve',\n      [ButtonType.ENABLE]: 'enable',\n      [ButtonType.DISABLE]: 'disable',\n      [ButtonType.REJECT]: 'reject'\n    }\n\n    const isPrimary = type === ButtonType.APPROVE || type === ButtonType.ENABLE\n    const isApproveButtonPopupDisabled =\n      !isTPCollection(collection) || (!!totalItems && reviewedItems.length >= getTPThresholdToReview(totalItems))\n    return (\n      <Popup\n        content={t('item_editor.top_panel.items_pending_to_review')}\n        disabled={isApproveButtonPopupDisabled}\n        position=\"bottom center\"\n        trigger={\n          <div>\n            <Button\n              primary={isPrimary}\n              onClick={() => onClickMap[type]()}\n              disabled={\n                isTPCollection(collection) &&\n                type === ButtonType.APPROVE &&\n                !!totalItems &&\n                reviewedItems.length < getTPThresholdToReview(totalItems)\n              }\n            >\n              {t(`item_editor.top_panel.${i18nKeyByButtonType[type]}`)}\n            </Button>\n          </div>\n        }\n        hideOnScroll={true}\n        on=\"hover\"\n        inverted\n        flowing\n      />\n    )\n  }\n\n  renderTPButtons = (collection: Collection, collectionCuration: CollectionCuration | null, itemCurations: ItemCuration[] | null) => {\n    const { reviewedItems, totalItems } = this.props\n    const shouldShowApproveButton = itemCurations?.some(itemCuration => itemCuration.status === CurationStatus.PENDING)\n    return (\n      <>\n        <Header sub>\n          {t('item_editor.top_panel.reviewed_counter', { count: reviewedItems.length, threshold: getTPThresholdToReview(totalItems!) })}\n          {reviewedItems.length >= getTPThresholdToReview(totalItems!) ? <Icon name=\"check circle\" /> : null}\n        </Header>\n        {shouldShowApproveButton ? this.renderButton(ButtonType.APPROVE, collection, collectionCuration) : null}\n        {this.renderButton(ButtonType.REJECT, collection, collectionCuration)}\n        {/* TODO: the disable button from below is not the same as the original disable one, it will be implemented once the sagas are ready */}\n        {/* {this.renderButton(ButtonType.DISABLE, collection, collectionCuration)} */}\n      </>\n    )\n  }\n\n  renderButtons = (collection: Collection, curation: CollectionCuration | null) => {\n    if (curation && collection.isApproved) {\n      switch (curation.status) {\n        case 'pending':\n          return (\n            <>\n              {this.renderButton(ButtonType.APPROVE, collection, curation)}\n              {this.renderButton(ButtonType.REJECT, collection, curation)}\n            </>\n          )\n        case 'approved':\n        case 'rejected':\n          return this.renderButton(ButtonType.DISABLE, collection, curation)\n      }\n    }\n\n    if (hasReviews(collection)) {\n      if (collection.isApproved) {\n        return this.renderButton(ButtonType.DISABLE, collection, curation)\n      } else {\n        return this.renderButton(ButtonType.ENABLE, collection, curation)\n      }\n    }\n\n    return (\n      <>\n        {this.renderButton(ButtonType.APPROVE, collection, curation)}\n        {this.renderButton(ButtonType.REJECT, collection, curation)}\n      </>\n    )\n  }\n\n  render() {\n    const { collection, items, isCommitteeMember, isReviewing, isConnected, isLoading } = this.props\n    // Show loader only while loading the first page of items\n    const showLoader = !collection || (isLoading && !items.length)\n    return isCommitteeMember && isReviewing && isConnected ? (\n      <div className=\"TopPanel\">{showLoader ? <Loader size=\"small\" active /> : this.renderPage(collection)}</div>\n    ) : null\n  }\n}\n"]},"metadata":{},"sourceType":"module"}