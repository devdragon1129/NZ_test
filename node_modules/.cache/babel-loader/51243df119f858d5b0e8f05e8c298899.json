{"ast":null,"code":"'use strict';\n\nvar _require = require('ipld-dag-pb'),\n    cid = _require.util.cid;\n\nvar defaultOptions = {\n  cidVersion: 0,\n  hashAlg: 'sha2-256',\n  codec: 'dag-pb'\n};\n\nvar persist = function persist(node, ipld, options, callback) {\n  var cidVersion = options.cidVersion || defaultOptions.cidVersion;\n  var hashAlg = options.hashAlg || defaultOptions.hashAlg;\n  var codec = options.codec || defaultOptions.codec;\n\n  if (Buffer.isBuffer(node)) {\n    cidVersion = 1;\n    codec = 'raw';\n  }\n\n  if (hashAlg !== 'sha2-256') {\n    cidVersion = 1;\n  }\n\n  if (options.onlyHash) {\n    return cid(node, {\n      version: cidVersion,\n      hashAlg: hashAlg\n    }, function (err, cid) {\n      callback(err, {\n        cid: cid,\n        node: node\n      });\n    });\n  }\n\n  ipld.put(node, {\n    version: cidVersion,\n    hashAlg: hashAlg,\n    format: codec\n  }, function (error, cid) {\n    callback(error, {\n      cid: cid,\n      node: node\n    });\n  });\n};\n\nmodule.exports = persist;","map":null,"metadata":{},"sourceType":"script"}