{"ast":null,"code":"'use strict';\n\nvar BufferList = require('bl');\n\nvar through = require('pull-through');\n\nmodule.exports = function (options) {\n  var maxSize = typeof options === 'number' ? options : options.maxChunkSize;\n  var bl = new BufferList();\n  var currentLength = 0;\n  var emitted = false;\n  return through(function onData(buffer) {\n    bl.append(buffer);\n    currentLength += buffer.length;\n\n    while (currentLength >= maxSize) {\n      this.queue(bl.slice(0, maxSize));\n      emitted = true; // throw away consumed bytes\n\n      if (maxSize === bl.length) {\n        bl = new BufferList();\n        currentLength = 0;\n      } else {\n        var newBl = new BufferList();\n        newBl.append(bl.shallowSlice(maxSize));\n        bl = newBl; // update our offset\n\n        currentLength -= maxSize;\n      }\n    }\n  }, function onEnd() {\n    if (currentLength) {\n      this.queue(bl.slice(0, currentLength));\n      emitted = true;\n    }\n\n    if (!emitted) {\n      this.queue(Buffer.alloc(0));\n    }\n\n    this.queue(null);\n  });\n};","map":null,"metadata":{},"sourceType":"script"}