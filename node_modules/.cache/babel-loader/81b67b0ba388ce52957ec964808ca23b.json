{"ast":null,"code":"import _slicedToArray from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _regeneratorRuntime from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _get from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/get\";\nimport _getPrototypeOf from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _objectWithoutProperties from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport _objectSpread from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport { BaseAPI } from 'decentraland-dapps/dist/lib/api';\nimport { config } from 'config';\nimport { NO_CACHE_HEADERS } from 'lib/headers';\nimport { runMigrations } from 'modules/migrations/utils';\nimport { migrations } from 'modules/migrations/manifest';\nimport { dataURLToBlob, isDataUrl, objectURLToBlob } from 'modules/media/utils';\nimport { createManifest } from 'modules/project/export';\nimport { PreviewType } from 'modules/editor/types';\nimport { DEFAULT_PAGE, DEFAULT_PAGE_SIZE } from './pagination';\nexport var BUILDER_SERVER_URL = config.get('BUILDER_SERVER_URL', '');\nexport var getContentsStorageUrl = function getContentsStorageUrl() {\n  var hash = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n  return \"\".concat(BUILDER_SERVER_URL, \"/storage/contents/\").concat(hash);\n};\nexport var getAssetPackStorageUrl = function getAssetPackStorageUrl() {\n  var hash = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n  return \"\".concat(BUILDER_SERVER_URL, \"/storage/assetPacks/\").concat(hash);\n};\nexport var getPreviewUrl = function getPreviewUrl(projectId) {\n  return \"\".concat(BUILDER_SERVER_URL, \"/projects/\").concat(projectId, \"/media/preview.png\");\n};\n\n/**\n * Transforms a Project into a RemoteProject for saving purposes only.\n * The `thumbnail` is omitted.\n */\nfunction toRemoteProject(project) {\n  return {\n    id: project.id,\n    title: project.title,\n    description: project.description,\n    is_public: project.isPublic,\n    scene_id: project.sceneId,\n    eth_address: project.ethAddress,\n    rows: project.layout.rows,\n    cols: project.layout.cols,\n    created_at: project.createdAt,\n    updated_at: project.updatedAt\n  };\n}\n\nfunction fromRemoteProject(remoteProject) {\n  return {\n    id: remoteProject.id,\n    title: remoteProject.title,\n    description: remoteProject.description,\n    thumbnail: \"\".concat(BUILDER_SERVER_URL, \"/projects/\").concat(remoteProject.id, \"/media/thumbnail.png\"),\n    isPublic: !!remoteProject.is_public,\n    sceneId: remoteProject.scene_id,\n    ethAddress: remoteProject.eth_address,\n    layout: {\n      rows: remoteProject.rows,\n      cols: remoteProject.cols\n    },\n    createdAt: remoteProject.created_at,\n    updatedAt: remoteProject.updated_at\n  };\n}\n\nfunction fromRemotePool(remotePool) {\n  var pool = fromRemoteProject(remotePool);\n  pool.thumbnail = \"\".concat(BUILDER_SERVER_URL, \"/projects/\").concat(remotePool.id, \"/media/preview.png\");\n  pool.isPublic = true;\n  pool.groups = remotePool.groups || [];\n  pool.likes = remotePool.likes || 0;\n  pool.like = !!remotePool.like;\n\n  if (remotePool.parcels) {\n    pool.statistics = {\n      parcels: remotePool.parcels,\n      transforms: remotePool.transforms,\n      gltf_shapes: remotePool.gltf_shapes,\n      nft_shapes: remotePool.nft_shapes,\n      scripts: remotePool.scripts,\n      entities: remotePool.entities\n    };\n  }\n\n  return pool;\n}\n\nfunction toRemoteAssetPack(assetPack) {\n  return {\n    id: assetPack.id,\n    title: assetPack.title,\n    eth_address: assetPack.ethAddress,\n    assets: assetPack.assets.map(function (asset) {\n      return toRemoteAsset(asset);\n    })\n  };\n}\n\nfunction fromRemoteAssetPack(remoteAssetPack) {\n  return {\n    id: remoteAssetPack.id,\n    title: remoteAssetPack.title,\n    thumbnail: getAssetPackStorageUrl(remoteAssetPack.thumbnail),\n    ethAddress: remoteAssetPack.eth_address,\n    assets: remoteAssetPack.assets.map(function (asset) {\n      return fromRemoteAsset(asset);\n    }),\n    createdAt: remoteAssetPack.created_at,\n    updatedAt: remoteAssetPack.updated_at\n  };\n}\n\nfunction toRemoteAsset(asset) {\n  return {\n    id: asset.id,\n    legacy_id: asset.legacyId || null,\n    asset_pack_id: asset.assetPackId,\n    name: asset.name,\n    model: asset.model.replace(\"\".concat(asset.assetPackId, \"/\"), ''),\n    script: asset.script,\n    thumbnail: asset.thumbnail.replace(getContentsStorageUrl(), ''),\n    tags: asset.tags,\n    category: asset.category,\n    contents: asset.contents,\n    metrics: asset.metrics,\n    parameters: asset.parameters,\n    actions: asset.actions\n  };\n}\n\nfunction fromRemoteAsset(remoteAsset) {\n  return {\n    id: remoteAsset.id,\n    legacyId: remoteAsset.legacy_id,\n    assetPackId: remoteAsset.asset_pack_id,\n    name: remoteAsset.name,\n    model: remoteAsset.model,\n    script: remoteAsset.script,\n    thumbnail: getContentsStorageUrl(remoteAsset.thumbnail),\n    tags: remoteAsset.tags,\n    category: remoteAsset.category,\n    contents: remoteAsset.contents,\n    metrics: remoteAsset.metrics,\n    parameters: remoteAsset.parameters,\n    actions: remoteAsset.actions\n  };\n}\n\nfunction fromPoolGroup(poolGroup) {\n  return {\n    id: poolGroup.id,\n    name: poolGroup.name,\n    isActive: poolGroup.is_active,\n    activeFrom: new Date(Date.parse(poolGroup.active_from)),\n    activeUntil: new Date(Date.parse(poolGroup.active_until))\n  };\n}\n\nfunction toRemoteItem(item) {\n  var remoteItem = {\n    id: item.id,\n    name: item.name,\n    description: item.description || '',\n    thumbnail: item.thumbnail,\n    eth_address: item.owner,\n    collection_id: item.collectionId || null,\n    blockchain_item_id: item.tokenId || null,\n    price: item.price || null,\n    urn: item.urn || null,\n    beneficiary: item.beneficiary || null,\n    rarity: item.rarity || null,\n    total_supply: item.totalSupply === undefined ? null : item.totalSupply,\n    is_published: false,\n    is_approved: false,\n    in_catalyst: item.inCatalyst || false,\n    type: item.type,\n    data: item.data,\n    metrics: item.metrics,\n    contents: item.contents,\n    content_hash: item.blockchainContentHash,\n    local_content_hash: item.currentContentHash,\n    catalyst_content_hash: item.catalystContentHash,\n    created_at: new Date(item.createdAt),\n    updated_at: new Date(item.updatedAt)\n  };\n  return remoteItem;\n}\n\nfunction fromRemoteItem(remoteItem) {\n  var item = {\n    id: remoteItem.id,\n    name: remoteItem.name,\n    thumbnail: remoteItem.thumbnail,\n    owner: remoteItem.eth_address,\n    description: remoteItem.description,\n    isPublished: remoteItem.is_published,\n    isApproved: remoteItem.is_approved,\n    inCatalyst: remoteItem.in_catalyst,\n    type: remoteItem.type,\n    data: remoteItem.data,\n    contents: remoteItem.contents,\n    currentContentHash: remoteItem.local_content_hash,\n    blockchainContentHash: remoteItem.content_hash,\n    catalystContentHash: remoteItem.catalyst_content_hash,\n    metrics: remoteItem.metrics,\n    createdAt: +new Date(remoteItem.created_at),\n    updatedAt: +new Date(remoteItem.created_at)\n  };\n  if (remoteItem.collection_id) item.collectionId = remoteItem.collection_id;\n  if (remoteItem.blockchain_item_id) item.tokenId = remoteItem.blockchain_item_id;\n  if (remoteItem.price) item.price = remoteItem.price;\n  if (remoteItem.urn) item.urn = remoteItem.urn;\n  if (remoteItem.beneficiary) item.beneficiary = remoteItem.beneficiary;\n  if (remoteItem.rarity) item.rarity = remoteItem.rarity;\n  if (remoteItem.total_supply !== null) item.totalSupply = remoteItem.total_supply; // 0 is false\n\n  return item;\n}\n\nfunction toRemoteCollection(collection) {\n  var remoteCollection = {\n    id: collection.id,\n    name: collection.name,\n    eth_address: collection.owner,\n    salt: collection.salt || null,\n    contract_address: collection.contractAddress || null,\n    urn: collection.urn,\n    is_published: false,\n    is_approved: false,\n    minters: collection.minters,\n    managers: collection.managers,\n    forum_link: collection.forumLink || null,\n    lock: collection.lock ? new Date(collection.lock) : null,\n    reviewed_at: collection.reviewedAt ? new Date(collection.reviewedAt) : null,\n    created_at: new Date(collection.createdAt),\n    updated_at: new Date(collection.updatedAt)\n  };\n  return remoteCollection;\n}\n\nfunction fromRemoteCollection(remoteCollection) {\n  var collection = {\n    id: remoteCollection.id,\n    name: remoteCollection.name,\n    owner: remoteCollection.eth_address,\n    urn: remoteCollection.urn,\n    isPublished: remoteCollection.is_published,\n    isApproved: remoteCollection.is_approved,\n    itemCount: Number(remoteCollection.item_count),\n    minters: remoteCollection.minters || [],\n    managers: remoteCollection.managers || [],\n    forumLink: remoteCollection.forum_link || undefined,\n    lock: remoteCollection.lock ? +new Date(remoteCollection.lock) : undefined,\n    reviewedAt: remoteCollection.reviewed_at ? +new Date(remoteCollection.reviewed_at) : undefined,\n    createdAt: +new Date(remoteCollection.created_at),\n    updatedAt: +new Date(remoteCollection.updated_at)\n  };\n  if (remoteCollection.salt) collection.salt = remoteCollection.salt;\n  if (remoteCollection.contract_address) collection.contractAddress = remoteCollection.contract_address;\n  return collection;\n}\n\nfunction getBaseCurationFields(remoteCuration) {\n  return {\n    id: remoteCuration.id,\n    status: remoteCuration.status,\n    createdAt: +new Date(remoteCuration.created_at),\n    updatedAt: +new Date(remoteCuration.updated_at)\n  };\n}\n\nfunction fromRemoteCollectionCuration(remoteCuration) {\n  return _objectSpread({}, getBaseCurationFields(remoteCuration), {\n    collectionId: remoteCuration.collection_id,\n    assignee: remoteCuration.assignee\n  });\n}\n\nfunction fromRemoteItemCuration(remoteCuration) {\n  return _objectSpread({}, getBaseCurationFields(remoteCuration), {\n    itemId: remoteCuration.item_id,\n    contentHash: remoteCuration.content_hash\n  });\n}\n\nvar toRemoteCollectionQueryParameters = function toRemoteCollectionQueryParameters(params) {\n  var _ref = params || {},\n      isPublished = _ref.isPublished,\n      rest = _objectWithoutProperties(_ref, [\"isPublished\"]);\n\n  return _objectSpread({\n    is_published: isPublished\n  }, rest);\n};\n\n// API\nexport var BuilderAPI = /*#__PURE__*/function (_BaseAPI) {\n  _inherits(BuilderAPI, _BaseAPI);\n\n  function BuilderAPI(url, authorization) {\n    var _this;\n\n    _classCallCheck(this, BuilderAPI);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(BuilderAPI).call(this, url));\n    _this.authorization = void 0;\n\n    _this.saveItem = /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(item, contents) {\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return _this.request('put', \"/items/\".concat(item.id), {\n                  item: toRemoteItem(item)\n                });\n\n              case 2:\n                _context.next = 4;\n                return _this.saveItemContents(item, contents);\n\n              case 4:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function (_x, _x2) {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n\n    _this.saveItemContents = /*#__PURE__*/function () {\n      var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(item, contents) {\n        var formData, path;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (!(Object.keys(contents).length > 0)) {\n                  _context2.next = 4;\n                  break;\n                }\n\n                formData = new FormData();\n\n                for (path in contents) {\n                  formData.append(item.contents[path], contents[path]);\n                }\n\n                return _context2.abrupt(\"return\", _this.request('post', \"/items/\".concat(item.id, \"/files\"), formData));\n\n              case 4:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      return function (_x3, _x4) {\n        return _ref3.apply(this, arguments);\n      };\n    }();\n\n    _this.saveTOS = /*#__PURE__*/function () {\n      var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(collection, email) {\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return _this.request('post', \"/collections/\".concat(collection.id, \"/tos\"), {\n                  email: email,\n                  collection_address: collection.contractAddress\n                });\n\n              case 2:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }));\n\n      return function (_x5, _x6) {\n        return _ref4.apply(this, arguments);\n      };\n    }();\n\n    _this.lockCollection = function (collection) {\n      return _this.request('post', \"/collections/\".concat(collection.id, \"/lock\"), {\n        collection_address: collection.id\n      });\n    };\n\n    _this.fetchApprovalData = function (collectionId) {\n      return _this.request('get', \"/collections/\".concat(collectionId, \"/approvalData\"));\n    };\n\n    _this.authorization = authorization;\n    return _this;\n  }\n\n  _createClass(BuilderAPI, [{\n    key: \"request\",\n    value: function () {\n      var _request = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(method, path, params, config) {\n        var authConfig, headers, authHeaders, response;\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                authConfig = {};\n                headers = {};\n\n                if (config) {\n                  authConfig = _objectSpread({}, config);\n\n                  if (config.headers) {\n                    headers = _objectSpread({}, config.headers);\n                  }\n                }\n\n                authHeaders = this.authorization.createAuthHeaders(method, path);\n                headers = _objectSpread({}, headers, authHeaders);\n                authConfig = _objectSpread({}, authConfig, {\n                  headers: headers\n                });\n                _context4.prev = 6;\n                _context4.next = 9;\n                return _get(_getPrototypeOf(BuilderAPI.prototype), \"request\", this).call(this, method, path, params, authConfig);\n\n              case 9:\n                response = _context4.sent;\n                return _context4.abrupt(\"return\", response);\n\n              case 13:\n                _context4.prev = 13;\n                _context4.t0 = _context4[\"catch\"](6);\n\n                if (this.isAxiosError(_context4.t0) && _context4.t0.response) {\n                  _context4.t0.message = _context4.t0.response.data.error;\n                }\n\n                throw _context4.t0;\n\n              case 17:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this, [[6, 13]]);\n      }));\n\n      function request(_x7, _x8, _x9, _x10) {\n        return _request.apply(this, arguments);\n      }\n\n      return request;\n    }()\n  }, {\n    key: \"deployToPool\",\n    value: function () {\n      var _deployToPool = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(projectId) {\n        var additionalInfo,\n            _args5 = arguments;\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                additionalInfo = _args5.length > 1 && _args5[1] !== undefined ? _args5[1] : null;\n                _context5.next = 3;\n                return this.request('put', \"/projects/\".concat(projectId, \"/pool\"), additionalInfo);\n\n              case 3:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n\n      function deployToPool(_x11) {\n        return _deployToPool.apply(this, arguments);\n      }\n\n      return deployToPool;\n    }()\n  }, {\n    key: \"uploadMedia\",\n    value: function () {\n      var _uploadMedia = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6(projectId, preview, shots, onUploadProgress) {\n        var formData;\n        return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                formData = new FormData();\n                formData.append('preview', preview);\n                formData.append('north', shots.north);\n                formData.append('east', shots.east);\n                formData.append('south', shots.south);\n                formData.append('west', shots.west);\n                _context6.next = 8;\n                return this.request('post', \"/projects/\".concat(projectId, \"/media\"), formData, {\n                  onUploadProgress: onUploadProgress\n                });\n\n              case 8:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this);\n      }));\n\n      function uploadMedia(_x12, _x13, _x14, _x15) {\n        return _uploadMedia.apply(this, arguments);\n      }\n\n      return uploadMedia;\n    }()\n  }, {\n    key: \"fetchProjects\",\n    value: function () {\n      var _fetchProjects = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee7() {\n        var _yield$this$request, items;\n\n        return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                _context7.next = 2;\n                return this.request('get', \"/projects\");\n\n              case 2:\n                _yield$this$request = _context7.sent;\n                items = _yield$this$request.items;\n                return _context7.abrupt(\"return\", items.map(fromRemoteProject));\n\n              case 5:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7, this);\n      }));\n\n      function fetchProjects() {\n        return _fetchProjects.apply(this, arguments);\n      }\n\n      return fetchProjects;\n    }()\n  }, {\n    key: \"fetchPublicProject\",\n    value: function () {\n      var _fetchPublicProject = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee8(projectId) {\n        var type,\n            project,\n            _args8 = arguments;\n        return _regeneratorRuntime.wrap(function _callee8$(_context8) {\n          while (1) {\n            switch (_context8.prev = _context8.next) {\n              case 0:\n                type = _args8.length > 1 && _args8[1] !== undefined ? _args8[1] : 'public';\n                _context8.next = 3;\n                return this.request('get', \"/projects/\".concat(projectId, \"/\").concat(type));\n\n              case 3:\n                project = _context8.sent;\n                return _context8.abrupt(\"return\", type === 'pool' ? fromRemotePool(project) : fromRemoteProject(project));\n\n              case 5:\n              case \"end\":\n                return _context8.stop();\n            }\n          }\n        }, _callee8, this);\n      }));\n\n      function fetchPublicProject(_x16) {\n        return _fetchPublicProject.apply(this, arguments);\n      }\n\n      return fetchPublicProject;\n    }()\n  }, {\n    key: \"fetchPoolsPage\",\n    value: function () {\n      var _fetchPoolsPage = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee9(filters) {\n        var _yield$this$request2, items, total;\n\n        return _regeneratorRuntime.wrap(function _callee9$(_context9) {\n          while (1) {\n            switch (_context9.prev = _context9.next) {\n              case 0:\n                _context9.next = 2;\n                return this.request('get', '/pools', filters);\n\n              case 2:\n                _yield$this$request2 = _context9.sent;\n                items = _yield$this$request2.items;\n                total = _yield$this$request2.total;\n                return _context9.abrupt(\"return\", {\n                  items: items.map(fromRemotePool),\n                  total: total\n                });\n\n              case 6:\n              case \"end\":\n                return _context9.stop();\n            }\n          }\n        }, _callee9, this);\n      }));\n\n      function fetchPoolsPage(_x17) {\n        return _fetchPoolsPage.apply(this, arguments);\n      }\n\n      return fetchPoolsPage;\n    }()\n  }, {\n    key: \"fetchPoolGroups\",\n    value: function () {\n      var _fetchPoolGroups = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee10() {\n        var activeOnly,\n            items,\n            _args10 = arguments;\n        return _regeneratorRuntime.wrap(function _callee10$(_context10) {\n          while (1) {\n            switch (_context10.prev = _context10.next) {\n              case 0:\n                activeOnly = _args10.length > 0 && _args10[0] !== undefined ? _args10[0] : false;\n                _context10.next = 3;\n                return this.request('get', '/pools/groups', {\n                  activeOnly: activeOnly\n                });\n\n              case 3:\n                items = _context10.sent;\n                return _context10.abrupt(\"return\", items.map(fromPoolGroup));\n\n              case 5:\n              case \"end\":\n                return _context10.stop();\n            }\n          }\n        }, _callee10, this);\n      }));\n\n      function fetchPoolGroups() {\n        return _fetchPoolGroups.apply(this, arguments);\n      }\n\n      return fetchPoolGroups;\n    }()\n  }, {\n    key: \"saveProject\",\n    value: function () {\n      var _saveProject = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee11(project, scene) {\n        var manifest;\n        return _regeneratorRuntime.wrap(function _callee11$(_context11) {\n          while (1) {\n            switch (_context11.prev = _context11.next) {\n              case 0:\n                manifest = createManifest(toRemoteProject(project), scene);\n                _context11.next = 3;\n                return this.request('put', \"/projects/\".concat(project.id, \"/manifest\"), {\n                  manifest: manifest\n                });\n\n              case 3:\n              case \"end\":\n                return _context11.stop();\n            }\n          }\n        }, _callee11, this);\n      }));\n\n      function saveProject(_x18, _x19) {\n        return _saveProject.apply(this, arguments);\n      }\n\n      return saveProject;\n    }()\n  }, {\n    key: \"saveProjectThumbnail\",\n    value: function () {\n      var _saveProjectThumbnail = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee12(project) {\n        var blob, formData;\n        return _regeneratorRuntime.wrap(function _callee12$(_context12) {\n          while (1) {\n            switch (_context12.prev = _context12.next) {\n              case 0:\n                blob = dataURLToBlob(project.thumbnail);\n                formData = new FormData();\n\n                if (!blob) {\n                  _context12.next = 6;\n                  break;\n                }\n\n                formData.append('thumbnail', blob);\n                _context12.next = 6;\n                return this.request('post', \"/projects/\".concat(project.id, \"/media\"), formData);\n\n              case 6:\n              case \"end\":\n                return _context12.stop();\n            }\n          }\n        }, _callee12, this);\n      }));\n\n      function saveProjectThumbnail(_x20) {\n        return _saveProjectThumbnail.apply(this, arguments);\n      }\n\n      return saveProjectThumbnail;\n    }()\n  }, {\n    key: \"deleteProject\",\n    value: function () {\n      var _deleteProject = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee13(id) {\n        return _regeneratorRuntime.wrap(function _callee13$(_context13) {\n          while (1) {\n            switch (_context13.prev = _context13.next) {\n              case 0:\n                _context13.next = 2;\n                return this.request('delete', \"/projects/\".concat(id));\n\n              case 2:\n              case \"end\":\n                return _context13.stop();\n            }\n          }\n        }, _callee13, this);\n      }));\n\n      function deleteProject(_x21) {\n        return _deleteProject.apply(this, arguments);\n      }\n\n      return deleteProject;\n    }()\n  }, {\n    key: \"fetchManifest\",\n    value: function () {\n      var _fetchManifest = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee14(id) {\n        var type,\n            remoteManifest,\n            manifest,\n            _args14 = arguments;\n        return _regeneratorRuntime.wrap(function _callee14$(_context14) {\n          while (1) {\n            switch (_context14.prev = _context14.next) {\n              case 0:\n                type = _args14.length > 1 && _args14[1] !== undefined ? _args14[1] : PreviewType.PROJECT;\n                _context14.next = 3;\n                return this.request('get', \"/\".concat(type, \"s/\").concat(id, \"/manifest\"));\n\n              case 3:\n                remoteManifest = _context14.sent;\n                manifest = _objectSpread({}, remoteManifest, {\n                  project: fromRemoteProject(remoteManifest.project)\n                });\n                /* There are projects retrived from the cloud (S3, not DB) that don't have an ethAddress, even after migration (cos migration only impacts the DB),\n                   those projects can be loaded into the app state via the Scene Pool, and they end up with a null ethAddress, and are mixed with projects\n                   that the user created while being logged out (no ethAddress either). So to tell them appart we set them a placeholder value.\n                */\n\n                if (!manifest.project.ethAddress) {\n                  manifest.project.ethAddress = 'legacy';\n                }\n\n                return _context14.abrupt(\"return\", runMigrations(manifest, migrations));\n\n              case 7:\n              case \"end\":\n                return _context14.stop();\n            }\n          }\n        }, _callee14, this);\n      }));\n\n      function fetchManifest(_x22) {\n        return _fetchManifest.apply(this, arguments);\n      }\n\n      return fetchManifest;\n    }()\n  }, {\n    key: \"saveAssetPack\",\n    value: function () {\n      var _saveAssetPack = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee15(assetPack) {\n        var remotePack;\n        return _regeneratorRuntime.wrap(function _callee15$(_context15) {\n          while (1) {\n            switch (_context15.prev = _context15.next) {\n              case 0:\n                remotePack = toRemoteAssetPack(assetPack);\n                _context15.next = 3;\n                return this.request('put', \"/assetPacks/\".concat(remotePack.id), {\n                  assetPack: remotePack\n                });\n\n              case 3:\n              case \"end\":\n                return _context15.stop();\n            }\n          }\n        }, _callee15, this);\n      }));\n\n      function saveAssetPack(_x23) {\n        return _saveAssetPack.apply(this, arguments);\n      }\n\n      return saveAssetPack;\n    }()\n  }, {\n    key: \"saveAssetContents\",\n    value: function () {\n      var _saveAssetContents = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee16(asset, contents, onUploadProgress) {\n        var formData, path;\n        return _regeneratorRuntime.wrap(function _callee16$(_context16) {\n          while (1) {\n            switch (_context16.prev = _context16.next) {\n              case 0:\n                formData = new FormData();\n\n                for (path in contents) {\n                  formData.append(path, contents[path]);\n                }\n\n                _context16.next = 4;\n                return this.request('post', \"/assetPacks/\".concat(asset.assetPackId, \"/assets/\").concat(asset.id, \"/files\"), formData, {\n                  onUploadProgress: onUploadProgress\n                });\n\n              case 4:\n              case \"end\":\n                return _context16.stop();\n            }\n          }\n        }, _callee16, this);\n      }));\n\n      function saveAssetContents(_x24, _x25, _x26) {\n        return _saveAssetContents.apply(this, arguments);\n      }\n\n      return saveAssetContents;\n    }()\n  }, {\n    key: \"saveAssetPackThumbnail\",\n    value: function () {\n      var _saveAssetPackThumbnail = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee17(assetPack) {\n        var blob, formData;\n        return _regeneratorRuntime.wrap(function _callee17$(_context17) {\n          while (1) {\n            switch (_context17.prev = _context17.next) {\n              case 0:\n                blob = null;\n\n                if (!isDataUrl(assetPack.thumbnail)) {\n                  _context17.next = 5;\n                  break;\n                }\n\n                blob = dataURLToBlob(assetPack.thumbnail);\n                _context17.next = 8;\n                break;\n\n              case 5:\n                _context17.next = 7;\n                return objectURLToBlob(assetPack.thumbnail);\n\n              case 7:\n                blob = _context17.sent;\n\n              case 8:\n                if (blob) {\n                  _context17.next = 10;\n                  break;\n                }\n\n                throw new Error('Invalid thumbnail');\n\n              case 10:\n                formData = new FormData();\n\n                if (!blob) {\n                  _context17.next = 15;\n                  break;\n                }\n\n                formData.append('thumbnail', blob);\n                _context17.next = 15;\n                return this.request('post', \"/assetPacks/\".concat(assetPack.id, \"/thumbnail\"), formData);\n\n              case 15:\n              case \"end\":\n                return _context17.stop();\n            }\n          }\n        }, _callee17, this);\n      }));\n\n      function saveAssetPackThumbnail(_x27) {\n        return _saveAssetPackThumbnail.apply(this, arguments);\n      }\n\n      return saveAssetPackThumbnail;\n    }()\n  }, {\n    key: \"fetchAssetPacks\",\n    value: function () {\n      var _fetchAssetPacks = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee18(address) {\n        var promisesOfRemoteAssetPacks, assetPacks;\n        return _regeneratorRuntime.wrap(function _callee18$(_context18) {\n          while (1) {\n            switch (_context18.prev = _context18.next) {\n              case 0:\n                promisesOfRemoteAssetPacks = [this.request('get', '/assetPacks', {\n                  owner: 'default'\n                })];\n\n                if (address) {\n                  promisesOfRemoteAssetPacks.push(this.request('get', '/assetPacks', {\n                    owner: address\n                  }));\n                }\n\n                _context18.next = 4;\n                return Promise.all(promisesOfRemoteAssetPacks);\n\n              case 4:\n                assetPacks = _context18.sent;\n                return _context18.abrupt(\"return\", assetPacks.reduce(function (acc, curr) {\n                  return acc.concat(curr);\n                }, []).map(fromRemoteAssetPack));\n\n              case 6:\n              case \"end\":\n                return _context18.stop();\n            }\n          }\n        }, _callee18, this);\n      }));\n\n      function fetchAssetPacks(_x28) {\n        return _fetchAssetPacks.apply(this, arguments);\n      }\n\n      return fetchAssetPacks;\n    }()\n  }, {\n    key: \"deleteAssetPack\",\n    value: function () {\n      var _deleteAssetPack = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee19(assetPack) {\n        return _regeneratorRuntime.wrap(function _callee19$(_context19) {\n          while (1) {\n            switch (_context19.prev = _context19.next) {\n              case 0:\n                _context19.next = 2;\n                return this.request('delete', \"/assetPacks/\".concat(assetPack.id));\n\n              case 2:\n              case \"end\":\n                return _context19.stop();\n            }\n          }\n        }, _callee19, this);\n      }));\n\n      function deleteAssetPack(_x29) {\n        return _deleteAssetPack.apply(this, arguments);\n      }\n\n      return deleteAssetPack;\n    }()\n  }, {\n    key: \"likePool\",\n    value: function likePool(pool) {\n      var like = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n      var method = like ? 'put' : 'delete';\n      return this.request(method, \"/pools/\".concat(pool, \"/likes\"));\n    }\n  }, {\n    key: \"fetchItems\",\n    value: function () {\n      var _fetchItems = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee20(address) {\n        var params,\n            collectionId,\n            _params$page,\n            page,\n            _params$limit,\n            limit,\n            endpoint,\n            remoteItems,\n            _args20 = arguments;\n\n        return _regeneratorRuntime.wrap(function _callee20$(_context20) {\n          while (1) {\n            switch (_context20.prev = _context20.next) {\n              case 0:\n                params = _args20.length > 1 && _args20[1] !== undefined ? _args20[1] : {};\n                collectionId = params.collectionId, _params$page = params.page, page = _params$page === void 0 ? DEFAULT_PAGE : _params$page, _params$limit = params.limit, limit = _params$limit === void 0 ? DEFAULT_PAGE_SIZE : _params$limit;\n                endpoint = address ? \"/\".concat(address, \"/items\") : '/items';\n                _context20.next = 5;\n                return this.request('get', endpoint, {\n                  page: page,\n                  limit: limit,\n                  collectionId: collectionId\n                });\n\n              case 5:\n                remoteItems = _context20.sent;\n                return _context20.abrupt(\"return\", _objectSpread({}, remoteItems, {\n                  results: remoteItems.results.map(fromRemoteItem)\n                }));\n\n              case 7:\n              case \"end\":\n                return _context20.stop();\n            }\n          }\n        }, _callee20, this);\n      }));\n\n      function fetchItems(_x30) {\n        return _fetchItems.apply(this, arguments);\n      }\n\n      return fetchItems;\n    }()\n  }, {\n    key: \"fetchItem\",\n    value: function () {\n      var _fetchItem = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee21(id) {\n        var remoteItem;\n        return _regeneratorRuntime.wrap(function _callee21$(_context21) {\n          while (1) {\n            switch (_context21.prev = _context21.next) {\n              case 0:\n                _context21.next = 2;\n                return this.request('get', \"/items/\".concat(id));\n\n              case 2:\n                remoteItem = _context21.sent;\n                return _context21.abrupt(\"return\", fromRemoteItem(remoteItem));\n\n              case 4:\n              case \"end\":\n                return _context21.stop();\n            }\n          }\n        }, _callee21, this);\n      }));\n\n      function fetchItem(_x31) {\n        return _fetchItem.apply(this, arguments);\n      }\n\n      return fetchItem;\n    }()\n  }, {\n    key: \"fetchCollectionItems\",\n    value: function () {\n      var _fetchCollectionItems = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee22(collectionId) {\n        var options,\n            page,\n            limit,\n            remoteResponse,\n            _args22 = arguments;\n        return _regeneratorRuntime.wrap(function _callee22$(_context22) {\n          while (1) {\n            switch (_context22.prev = _context22.next) {\n              case 0:\n                options = _args22.length > 1 && _args22[1] !== undefined ? _args22[1] : {};\n                page = options.page, limit = options.limit;\n                _context22.next = 4;\n                return this.request('get', \"/collections/\".concat(collectionId, \"/items\"), options);\n\n              case 4:\n                remoteResponse = _context22.sent;\n\n                if (!(page && limit && remoteResponse.results)) {\n                  _context22.next = 7;\n                  break;\n                }\n\n                return _context22.abrupt(\"return\", _objectSpread({}, remoteResponse, {\n                  results: remoteResponse.results.map(fromRemoteItem)\n                }));\n\n              case 7:\n                return _context22.abrupt(\"return\", remoteResponse.map(fromRemoteItem));\n\n              case 8:\n              case \"end\":\n                return _context22.stop();\n            }\n          }\n        }, _callee22, this);\n      }));\n\n      function fetchCollectionItems(_x32) {\n        return _fetchCollectionItems.apply(this, arguments);\n      }\n\n      return fetchCollectionItems;\n    }()\n  }, {\n    key: \"deleteItem\",\n    value: function () {\n      var _deleteItem = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee23(id) {\n        return _regeneratorRuntime.wrap(function _callee23$(_context23) {\n          while (1) {\n            switch (_context23.prev = _context23.next) {\n              case 0:\n                _context23.next = 2;\n                return this.request('delete', \"/items/\".concat(id), {});\n\n              case 2:\n              case \"end\":\n                return _context23.stop();\n            }\n          }\n        }, _callee23, this);\n      }));\n\n      function deleteItem(_x33) {\n        return _deleteItem.apply(this, arguments);\n      }\n\n      return deleteItem;\n    }()\n  }, {\n    key: \"fetchCollections\",\n    value: function () {\n      var _fetchCollections = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee24(address, params) {\n        var remoteCollections, _ref5, limit, page;\n\n        return _regeneratorRuntime.wrap(function _callee24$(_context24) {\n          while (1) {\n            switch (_context24.prev = _context24.next) {\n              case 0:\n                if (!address) {\n                  _context24.next = 6;\n                  break;\n                }\n\n                _context24.next = 3;\n                return this.request('get', \"/\".concat(address, \"/collections\"), params);\n\n              case 3:\n                _context24.t0 = _context24.sent;\n                _context24.next = 9;\n                break;\n\n              case 6:\n                _context24.next = 8;\n                return this.request('get', '/collections', toRemoteCollectionQueryParameters(params));\n\n              case 8:\n                _context24.t0 = _context24.sent;\n\n              case 9:\n                remoteCollections = _context24.t0;\n                _ref5 = params || {}, limit = _ref5.limit, page = _ref5.page;\n\n                if (!(page && limit && remoteCollections.results)) {\n                  _context24.next = 13;\n                  break;\n                }\n\n                return _context24.abrupt(\"return\", _objectSpread({}, remoteCollections, {\n                  results: remoteCollections.results.map(fromRemoteCollection)\n                }));\n\n              case 13:\n                return _context24.abrupt(\"return\", remoteCollections.map(fromRemoteCollection));\n\n              case 14:\n              case \"end\":\n                return _context24.stop();\n            }\n          }\n        }, _callee24, this);\n      }));\n\n      function fetchCollections(_x34, _x35) {\n        return _fetchCollections.apply(this, arguments);\n      }\n\n      return fetchCollections;\n    }()\n  }, {\n    key: \"fetchCollection\",\n    value: function () {\n      var _fetchCollection = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee25(id) {\n        var remoteCollection;\n        return _regeneratorRuntime.wrap(function _callee25$(_context25) {\n          while (1) {\n            switch (_context25.prev = _context25.next) {\n              case 0:\n                _context25.next = 2;\n                return this.request('get', \"/collections/\".concat(id));\n\n              case 2:\n                remoteCollection = _context25.sent;\n                return _context25.abrupt(\"return\", fromRemoteCollection(remoteCollection));\n\n              case 4:\n              case \"end\":\n                return _context25.stop();\n            }\n          }\n        }, _callee25, this);\n      }));\n\n      function fetchCollection(_x36) {\n        return _fetchCollection.apply(this, arguments);\n      }\n\n      return fetchCollection;\n    }()\n  }, {\n    key: \"publishStandardCollection\",\n    value: function () {\n      var _publishStandardCollection = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee26(collectionId) {\n        var _yield$this$request3, collection, items;\n\n        return _regeneratorRuntime.wrap(function _callee26$(_context26) {\n          while (1) {\n            switch (_context26.prev = _context26.next) {\n              case 0:\n                _context26.next = 2;\n                return this.request('post', \"/collections/\".concat(collectionId, \"/publish\"));\n\n              case 2:\n                _yield$this$request3 = _context26.sent;\n                collection = _yield$this$request3.collection;\n                items = _yield$this$request3.items;\n                return _context26.abrupt(\"return\", {\n                  collection: fromRemoteCollection(collection),\n                  items: items.map(fromRemoteItem)\n                });\n\n              case 6:\n              case \"end\":\n                return _context26.stop();\n            }\n          }\n        }, _callee26, this);\n      }));\n\n      function publishStandardCollection(_x37) {\n        return _publishStandardCollection.apply(this, arguments);\n      }\n\n      return publishStandardCollection;\n    }()\n  }, {\n    key: \"publishTPCollection\",\n    value: function () {\n      var _publishTPCollection = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee27(collectionId, itemIds, cheque) {\n        var _yield$this$request4, collection, items, itemCurations;\n\n        return _regeneratorRuntime.wrap(function _callee27$(_context27) {\n          while (1) {\n            switch (_context27.prev = _context27.next) {\n              case 0:\n                _context27.next = 2;\n                return this.request('post', \"/collections/\".concat(collectionId, \"/publish\"), {\n                  itemIds: itemIds,\n                  cheque: cheque\n                });\n\n              case 2:\n                _yield$this$request4 = _context27.sent;\n                collection = _yield$this$request4.collection;\n                items = _yield$this$request4.items;\n                itemCurations = _yield$this$request4.itemCurations;\n                return _context27.abrupt(\"return\", {\n                  collection: fromRemoteCollection(collection),\n                  items: items.map(fromRemoteItem),\n                  itemCurations: itemCurations.map(fromRemoteItemCuration)\n                });\n\n              case 7:\n              case \"end\":\n                return _context27.stop();\n            }\n          }\n        }, _callee27, this);\n      }));\n\n      function publishTPCollection(_x38, _x39, _x40) {\n        return _publishTPCollection.apply(this, arguments);\n      }\n\n      return publishTPCollection;\n    }()\n  }, {\n    key: \"saveCollection\",\n    value: function () {\n      var _saveCollection = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee28(collection, data) {\n        var remoteCollection;\n        return _regeneratorRuntime.wrap(function _callee28$(_context28) {\n          while (1) {\n            switch (_context28.prev = _context28.next) {\n              case 0:\n                _context28.next = 2;\n                return this.request('put', \"/collections/\".concat(collection.id), {\n                  collection: toRemoteCollection(collection),\n                  data: data\n                });\n\n              case 2:\n                remoteCollection = _context28.sent;\n                return _context28.abrupt(\"return\", fromRemoteCollection(remoteCollection));\n\n              case 4:\n              case \"end\":\n                return _context28.stop();\n            }\n          }\n        }, _callee28, this);\n      }));\n\n      function saveCollection(_x41, _x42) {\n        return _saveCollection.apply(this, arguments);\n      }\n\n      return saveCollection;\n    }()\n  }, {\n    key: \"deleteCollection\",\n    value: function () {\n      var _deleteCollection = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee29(id) {\n        return _regeneratorRuntime.wrap(function _callee29$(_context29) {\n          while (1) {\n            switch (_context29.prev = _context29.next) {\n              case 0:\n                _context29.next = 2;\n                return this.request('delete', \"/collections/\".concat(id), {});\n\n              case 2:\n              case \"end\":\n                return _context29.stop();\n            }\n          }\n        }, _callee29, this);\n      }));\n\n      function deleteCollection(_x43) {\n        return _deleteCollection.apply(this, arguments);\n      }\n\n      return deleteCollection;\n    }()\n  }, {\n    key: \"fetchCurations\",\n    value: function () {\n      var _fetchCurations = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee30() {\n        var curations;\n        return _regeneratorRuntime.wrap(function _callee30$(_context30) {\n          while (1) {\n            switch (_context30.prev = _context30.next) {\n              case 0:\n                _context30.next = 2;\n                return this.request('get', \"/curations\");\n\n              case 2:\n                curations = _context30.sent;\n                return _context30.abrupt(\"return\", curations.map(fromRemoteCollectionCuration));\n\n              case 4:\n              case \"end\":\n                return _context30.stop();\n            }\n          }\n        }, _callee30, this);\n      }));\n\n      function fetchCurations() {\n        return _fetchCurations.apply(this, arguments);\n      }\n\n      return fetchCurations;\n    }()\n  }, {\n    key: \"fetchItemCuration\",\n    value: function () {\n      var _fetchItemCuration = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee31(itemId) {\n        var curation;\n        return _regeneratorRuntime.wrap(function _callee31$(_context31) {\n          while (1) {\n            switch (_context31.prev = _context31.next) {\n              case 0:\n                _context31.next = 2;\n                return this.request('get', \"/items/\".concat(itemId, \"/curation\"));\n\n              case 2:\n                curation = _context31.sent;\n                return _context31.abrupt(\"return\", fromRemoteItemCuration(curation));\n\n              case 4:\n              case \"end\":\n                return _context31.stop();\n            }\n          }\n        }, _callee31, this);\n      }));\n\n      function fetchItemCuration(_x44) {\n        return _fetchItemCuration.apply(this, arguments);\n      }\n\n      return fetchItemCuration;\n    }()\n  }, {\n    key: \"fetchItemCurations\",\n    value: function () {\n      var _fetchItemCurations = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee32(collectionId, itemIds) {\n        var curations;\n        return _regeneratorRuntime.wrap(function _callee32$(_context32) {\n          while (1) {\n            switch (_context32.prev = _context32.next) {\n              case 0:\n                _context32.next = 2;\n                return this.request('get', \"/collections/\".concat(collectionId, \"/itemCurations\"), {\n                  itemIds: itemIds\n                });\n\n              case 2:\n                curations = _context32.sent;\n                return _context32.abrupt(\"return\", curations.map(fromRemoteItemCuration));\n\n              case 4:\n              case \"end\":\n                return _context32.stop();\n            }\n          }\n        }, _callee32, this);\n      }));\n\n      function fetchItemCurations(_x45, _x46) {\n        return _fetchItemCurations.apply(this, arguments);\n      }\n\n      return fetchItemCurations;\n    }()\n  }, {\n    key: \"fetchCuration\",\n    value: function () {\n      var _fetchCuration = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee33(collectionId) {\n        var curation;\n        return _regeneratorRuntime.wrap(function _callee33$(_context33) {\n          while (1) {\n            switch (_context33.prev = _context33.next) {\n              case 0:\n                _context33.next = 2;\n                return this.request('get', \"/collections/\".concat(collectionId, \"/curation\"));\n\n              case 2:\n                curation = _context33.sent;\n\n                if (curation) {\n                  _context33.next = 5;\n                  break;\n                }\n\n                return _context33.abrupt(\"return\");\n\n              case 5:\n                return _context33.abrupt(\"return\", fromRemoteCollectionCuration(curation));\n\n              case 6:\n              case \"end\":\n                return _context33.stop();\n            }\n          }\n        }, _callee33, this);\n      }));\n\n      function fetchCuration(_x47) {\n        return _fetchCuration.apply(this, arguments);\n      }\n\n      return fetchCuration;\n    }()\n  }, {\n    key: \"pushCuration\",\n    value: function pushCuration(collectionId, assignee) {\n      return this.request('post', \"/collections/\".concat(collectionId, \"/curation\"), {\n        curation: {\n          assignee: assignee\n        }\n      });\n    }\n  }, {\n    key: \"pushItemCuration\",\n    value: function () {\n      var _pushItemCuration = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee34(itemId) {\n        var curation;\n        return _regeneratorRuntime.wrap(function _callee34$(_context34) {\n          while (1) {\n            switch (_context34.prev = _context34.next) {\n              case 0:\n                _context34.next = 2;\n                return this.request('post', \"/items/\".concat(itemId, \"/curation\"));\n\n              case 2:\n                curation = _context34.sent;\n                return _context34.abrupt(\"return\", fromRemoteItemCuration(curation));\n\n              case 4:\n              case \"end\":\n                return _context34.stop();\n            }\n          }\n        }, _callee34, this);\n      }));\n\n      function pushItemCuration(_x48) {\n        return _pushItemCuration.apply(this, arguments);\n      }\n\n      return pushItemCuration;\n    }()\n  }, {\n    key: \"fetchCommittee\",\n    value: function fetchCommittee() {\n      return this.request('get', '/committee');\n    }\n  }, {\n    key: \"createCollectionForumPost\",\n    value: function createCollectionForumPost(collection, forumPost) {\n      return this.request('post', \"/collections/\".concat(collection.id, \"/post\"), {\n        forumPost: forumPost\n      });\n    }\n  }, {\n    key: \"createCollectionNewAssigneeForumPost\",\n    value: function createCollectionNewAssigneeForumPost(collection, forumPost) {\n      return this.request('post', \"/collections/\".concat(collection.id, \"/curation/post\"), {\n        forumPost: forumPost\n      });\n    }\n  }, {\n    key: \"fetchRarities\",\n    value: function fetchRarities() {\n      return this.request('get', '/rarities');\n    }\n  }, {\n    key: \"fetchThirdParties\",\n    value: function fetchThirdParties(manager) {\n      return this.request('get', '/thirdParties', {\n        manager: manager\n      });\n    }\n  }, {\n    key: \"fetchThirdPartyAvailableSlots\",\n    value: function fetchThirdPartyAvailableSlots(thirdPartyId) {\n      return this.request('get', \"/thirdParties/\".concat(thirdPartyId, \"/slots\"));\n    }\n  }, {\n    key: \"updateCurationStatus\",\n    value: function updateCurationStatus(collectionId, status) {\n      return this.request('patch', \"/collections/\".concat(collectionId, \"/curation\"), {\n        curation: {\n          status: status\n        }\n      });\n    }\n  }, {\n    key: \"updateCuration\",\n    value: function updateCuration(collectionId, curation) {\n      return this.request('patch', \"/collections/\".concat(collectionId, \"/curation\"), {\n        curation: curation\n      });\n    }\n  }, {\n    key: \"updateItemCurationStatus\",\n    value: function () {\n      var _updateItemCurationStatus = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee35(itemId, status) {\n        var curation;\n        return _regeneratorRuntime.wrap(function _callee35$(_context35) {\n          while (1) {\n            switch (_context35.prev = _context35.next) {\n              case 0:\n                _context35.next = 2;\n                return this.request('patch', \"/items/\".concat(itemId, \"/curation\"), {\n                  curation: {\n                    status: status\n                  }\n                });\n\n              case 2:\n                curation = _context35.sent;\n                return _context35.abrupt(\"return\", fromRemoteItemCuration(curation));\n\n              case 4:\n              case \"end\":\n                return _context35.stop();\n            }\n          }\n        }, _callee35, this);\n      }));\n\n      function updateItemCurationStatus(_x49, _x50) {\n        return _updateItemCurationStatus.apply(this, arguments);\n      }\n\n      return updateItemCurationStatus;\n    }()\n  }, {\n    key: \"fetchContent\",\n    value: function () {\n      var _fetchContent = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee36(hash) {\n        var url, resp, message, blob;\n        return _regeneratorRuntime.wrap(function _callee36$(_context36) {\n          while (1) {\n            switch (_context36.prev = _context36.next) {\n              case 0:\n                url = getContentsStorageUrl(hash);\n                _context36.next = 3;\n                return fetch(url, {\n                  headers: NO_CACHE_HEADERS\n                });\n\n              case 3:\n                resp = _context36.sent;\n\n                if (resp.ok) {\n                  _context36.next = 9;\n                  break;\n                }\n\n                _context36.next = 7;\n                return resp.text();\n\n              case 7:\n                message = _context36.sent;\n                throw new Error(message);\n\n              case 9:\n                _context36.next = 11;\n                return resp.blob();\n\n              case 11:\n                blob = _context36.sent;\n                return _context36.abrupt(\"return\", blob);\n\n              case 13:\n              case \"end\":\n                return _context36.stop();\n            }\n          }\n        }, _callee36);\n      }));\n\n      function fetchContent(_x51) {\n        return _fetchContent.apply(this, arguments);\n      }\n\n      return fetchContent;\n    }()\n  }, {\n    key: \"fetchContents\",\n    value: function () {\n      var _fetchContents = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee37(contents) {\n        var _this2 = this;\n\n        var blobs, mappings, _loop, path;\n\n        return _regeneratorRuntime.wrap(function _callee37$(_context37) {\n          while (1) {\n            switch (_context37.prev = _context37.next) {\n              case 0:\n                blobs = new Map();\n                mappings = [];\n\n                _loop = function _loop(path) {\n                  var hash = contents[path]; // avoid fetching the same hash more than once\n\n                  if (!blobs.has(hash)) {\n                    blobs.set(hash, _this2.fetchContent(hash));\n                  }\n\n                  var blob = blobs.get(hash);\n                  mappings.push(blob.then(function (blob) {\n                    return [path, blob];\n                  }));\n                };\n\n                for (path in contents) {\n                  _loop(path);\n                }\n\n                return _context37.abrupt(\"return\", Promise.all(mappings).then(function (results) {\n                  return results.reduce(function (obj, _ref6) {\n                    var _ref7 = _slicedToArray(_ref6, 2),\n                        path = _ref7[0],\n                        blob = _ref7[1];\n\n                    obj[path] = blob;\n                    return obj;\n                  }, {});\n                }));\n\n              case 5:\n              case \"end\":\n                return _context37.stop();\n            }\n          }\n        }, _callee37);\n      }));\n\n      function fetchContents(_x52) {\n        return _fetchContents.apply(this, arguments);\n      }\n\n      return fetchContents;\n    }()\n  }, {\n    key: \"isAxiosError\",\n    value: function isAxiosError(error) {\n      return error.isAxiosError;\n    }\n  }]);\n\n  return BuilderAPI;\n}(BaseAPI);","map":{"version":3,"sources":["/opt/work/NZ_test/src/lib/api/builder.ts"],"names":["BaseAPI","config","NO_CACHE_HEADERS","runMigrations","migrations","dataURLToBlob","isDataUrl","objectURLToBlob","createManifest","PreviewType","DEFAULT_PAGE","DEFAULT_PAGE_SIZE","BUILDER_SERVER_URL","get","getContentsStorageUrl","hash","getAssetPackStorageUrl","getPreviewUrl","projectId","toRemoteProject","project","id","title","description","is_public","isPublic","scene_id","sceneId","eth_address","ethAddress","rows","layout","cols","created_at","createdAt","updated_at","updatedAt","fromRemoteProject","remoteProject","thumbnail","fromRemotePool","remotePool","pool","groups","likes","like","parcels","statistics","transforms","gltf_shapes","nft_shapes","scripts","entities","toRemoteAssetPack","assetPack","assets","map","asset","toRemoteAsset","fromRemoteAssetPack","remoteAssetPack","fromRemoteAsset","legacy_id","legacyId","asset_pack_id","assetPackId","name","model","replace","script","tags","category","contents","metrics","parameters","actions","remoteAsset","fromPoolGroup","poolGroup","isActive","is_active","activeFrom","Date","parse","active_from","activeUntil","active_until","toRemoteItem","item","remoteItem","owner","collection_id","collectionId","blockchain_item_id","tokenId","price","urn","beneficiary","rarity","total_supply","totalSupply","undefined","is_published","is_approved","in_catalyst","inCatalyst","type","data","content_hash","blockchainContentHash","local_content_hash","currentContentHash","catalyst_content_hash","catalystContentHash","fromRemoteItem","isPublished","isApproved","toRemoteCollection","collection","remoteCollection","salt","contract_address","contractAddress","minters","managers","forum_link","forumLink","lock","reviewed_at","reviewedAt","fromRemoteCollection","itemCount","Number","item_count","getBaseCurationFields","remoteCuration","status","fromRemoteCollectionCuration","assignee","fromRemoteItemCuration","itemId","item_id","contentHash","toRemoteCollectionQueryParameters","params","rest","BuilderAPI","url","authorization","saveItem","request","saveItemContents","Object","keys","length","formData","FormData","path","append","saveTOS","email","collection_address","lockCollection","fetchApprovalData","method","authConfig","headers","authHeaders","createAuthHeaders","response","isAxiosError","message","error","additionalInfo","preview","shots","onUploadProgress","north","east","south","west","items","filters","total","activeOnly","scene","manifest","blob","PROJECT","remoteManifest","remotePack","Error","address","promisesOfRemoteAssetPacks","push","Promise","all","assetPacks","reduce","acc","curr","concat","page","limit","endpoint","remoteItems","results","options","remoteResponse","remoteCollections","itemIds","cheque","itemCurations","curations","curation","forumPost","manager","thirdPartyId","fetch","resp","ok","text","blobs","Map","mappings","has","set","fetchContent","then","obj"],"mappings":"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","sourcesContent":["import { AxiosRequestConfig, AxiosError } from 'axios'\nimport { BaseAPI, APIParam } from 'decentraland-dapps/dist/lib/api'\nimport { Omit } from 'decentraland-dapps/dist/lib/types'\nimport { config } from 'config'\nimport { NO_CACHE_HEADERS } from 'lib/headers'\nimport { runMigrations } from 'modules/migrations/utils'\nimport { migrations } from 'modules/migrations/manifest'\nimport { Project, Manifest } from 'modules/project/types'\nimport { Asset, AssetAction, AssetParameter } from 'modules/asset/types'\nimport { Scene } from 'modules/scene/types'\nimport { FullAssetPack } from 'modules/assetPack/types'\nimport { dataURLToBlob, isDataUrl, objectURLToBlob } from 'modules/media/utils'\nimport { createManifest } from 'modules/project/export'\nimport { PoolGroup } from 'modules/poolGroup/types'\nimport { Pool } from 'modules/pool/types'\nimport { Item, ItemType, ItemRarity, WearableData, Rarity, ItemApprovalData } from 'modules/item/types'\nimport { Collection } from 'modules/collection/types'\nimport { Cheque, ThirdParty } from 'modules/thirdParty/types'\nimport { PreviewType } from 'modules/editor/types'\nimport { ForumPost } from 'modules/forum/types'\nimport { ModelMetrics } from 'modules/models/types'\nimport { CollectionCuration } from 'modules/curations/collectionCuration/types'\nimport { CurationSortOptions, CurationStatus } from 'modules/curations/types'\nimport { ItemCuration } from 'modules/curations/itemCuration/types'\nimport { DEFAULT_PAGE, DEFAULT_PAGE_SIZE, PaginatedResource } from './pagination'\nimport { Authorization } from './auth'\n\nexport const BUILDER_SERVER_URL = config.get('BUILDER_SERVER_URL', '')\n\nexport const getContentsStorageUrl = (hash: string = '') => `${BUILDER_SERVER_URL}/storage/contents/${hash}`\nexport const getAssetPackStorageUrl = (hash: string = '') => `${BUILDER_SERVER_URL}/storage/assetPacks/${hash}`\nexport const getPreviewUrl = (projectId: string) => `${BUILDER_SERVER_URL}/projects/${projectId}/media/preview.png`\n\nexport type FetchCollectionsParams = {\n  assignee?: string\n  status?: CurationStatus\n  sort?: CurationSortOptions\n  q?: string\n  isPublished?: boolean\n  page?: number\n  limit?: number\n}\n\nexport type RemoteItem = {\n  id: string // uuid\n  name: string\n  description: string\n  thumbnail: string\n  eth_address: string\n  collection_id: string | null\n  blockchain_item_id: string | null\n  price: string | null\n  urn: string | null\n  beneficiary: string | null\n  rarity: ItemRarity | null\n  total_supply: number | null\n  is_published: boolean\n  is_approved: boolean\n  in_catalyst: boolean\n  type: ItemType\n  data: WearableData\n  metrics: ModelMetrics\n  contents: Record<string, string>\n  content_hash: string | null\n  created_at: Date\n  updated_at: Date\n  local_content_hash: string | null\n  catalyst_content_hash: string | null\n}\n\nexport type RemoteCollection = {\n  id: string // uuid\n  name: string\n  eth_address: string\n  salt: string | null\n  contract_address: string | null\n  urn: string\n  is_published: boolean\n  is_approved: boolean\n  minters: string[]\n  managers: string[]\n  forum_link: string | null\n  lock: Date | null\n  reviewed_at: Date | null\n  created_at: Date\n  updated_at: Date\n  item_count?: string\n}\n\nexport type RemoteProject = {\n  id: string\n  title: string\n  description: string\n  thumbnail: string\n  is_public: boolean\n  scene_id: string\n  eth_address: string\n  rows: number\n  cols: number\n  created_at: string\n  updated_at: string\n}\n\nexport type RemotePoolGroup = {\n  id: string\n  name: string\n  is_active: boolean\n  active_from: string\n  active_until: string\n}\n\nexport type RemotePool = RemoteProject & {\n  groups: string[]\n  parcels: number | null\n  transforms: number | null\n  gltf_shapes: number | null\n  nft_shapes: number | null\n  scripts: number | null\n  entities: number | null\n  likes: number\n  like: boolean\n}\n\nexport type RemoteAssetPack = {\n  id: string\n  title: string\n  url?: string\n  thumbnail?: string\n  eth_address: string\n  assets: RemoteAsset[]\n  created_at?: string\n  updated_at?: string\n}\n\nexport type RemoteAsset = {\n  id: string\n  legacy_id: string | null\n  asset_pack_id: string\n  name: string\n  model: string\n  script: string | null\n  thumbnail: string\n  tags: string[]\n  category: string\n  contents: Record<string, string>\n  metrics: ModelMetrics\n  parameters: AssetParameter[]\n  actions: AssetAction[]\n}\n\nexport type RemoteWeeklyStats = {\n  week: string\n  title: string\n  base: string\n  users: number\n  sessions: number\n  median_session_time: number\n  min_session_time: number\n  average_session_time: number\n  max_session_time: number\n  direct_users: number\n  direct_sessions: number\n  max_concurrent_users: number\n  max_concurrent_users_time: string\n}\n\ntype BaseCuration = {\n  id: string\n  status: CollectionCuration['status']\n  created_at: Date\n  updated_at: Date\n}\n\nexport type RemoteCollectionCuration = {\n  collection_id: string\n  assignee?: string\n} & BaseCuration\n\nexport type RemoteItemCuration = {\n  item_id: string\n  content_hash: string\n} & BaseCuration\n\n/**\n * Transforms a Project into a RemoteProject for saving purposes only.\n * The `thumbnail` is omitted.\n */\nfunction toRemoteProject(project: Project): Omit<RemoteProject, 'thumbnail'> {\n  return {\n    id: project.id,\n    title: project.title,\n    description: project.description,\n    is_public: project.isPublic,\n    scene_id: project.sceneId,\n    eth_address: project.ethAddress!,\n    rows: project.layout.rows,\n    cols: project.layout.cols,\n    created_at: project.createdAt,\n    updated_at: project.updatedAt\n  }\n}\n\nfunction fromRemoteProject(remoteProject: RemoteProject): Project {\n  return {\n    id: remoteProject.id,\n    title: remoteProject.title,\n    description: remoteProject.description,\n    thumbnail: `${BUILDER_SERVER_URL}/projects/${remoteProject.id}/media/thumbnail.png`,\n    isPublic: !!remoteProject.is_public,\n    sceneId: remoteProject.scene_id,\n    ethAddress: remoteProject.eth_address,\n    layout: {\n      rows: remoteProject.rows,\n      cols: remoteProject.cols\n    },\n    createdAt: remoteProject.created_at,\n    updatedAt: remoteProject.updated_at\n  }\n}\n\nfunction fromRemotePool(remotePool: RemotePool): Pool {\n  const pool = fromRemoteProject(remotePool) as Pool\n\n  pool.thumbnail = `${BUILDER_SERVER_URL}/projects/${remotePool.id}/media/preview.png`\n  pool.isPublic = true\n  pool.groups = remotePool.groups || []\n  pool.likes = remotePool.likes || 0\n  pool.like = !!remotePool.like\n\n  if (remotePool.parcels) {\n    pool.statistics = {\n      parcels: remotePool.parcels as number,\n      transforms: remotePool.transforms as number,\n      gltf_shapes: remotePool.gltf_shapes as number,\n      nft_shapes: remotePool.nft_shapes as number,\n      scripts: remotePool.scripts as number,\n      entities: remotePool.entities as number\n    }\n  }\n\n  return pool\n}\n\nfunction toRemoteAssetPack(assetPack: FullAssetPack): RemoteAssetPack {\n  return {\n    id: assetPack.id,\n    title: assetPack.title,\n    eth_address: assetPack.ethAddress!,\n    assets: assetPack.assets.map(asset => toRemoteAsset(asset))\n  }\n}\n\nfunction fromRemoteAssetPack(remoteAssetPack: RemoteAssetPack): FullAssetPack {\n  return {\n    id: remoteAssetPack.id,\n    title: remoteAssetPack.title,\n    thumbnail: getAssetPackStorageUrl(remoteAssetPack.thumbnail),\n    ethAddress: remoteAssetPack.eth_address,\n    assets: remoteAssetPack.assets.map(asset => fromRemoteAsset(asset)),\n    createdAt: remoteAssetPack.created_at,\n    updatedAt: remoteAssetPack.updated_at\n  }\n}\n\nfunction toRemoteAsset(asset: Asset): RemoteAsset {\n  return {\n    id: asset.id,\n    legacy_id: asset.legacyId || null,\n    asset_pack_id: asset.assetPackId,\n    name: asset.name,\n    model: asset.model.replace(`${asset.assetPackId}/`, ''),\n    script: asset.script,\n    thumbnail: asset.thumbnail.replace(getContentsStorageUrl(), ''),\n    tags: asset.tags,\n    category: asset.category,\n    contents: asset.contents,\n    metrics: asset.metrics,\n    parameters: asset.parameters,\n    actions: asset.actions\n  }\n}\n\nfunction fromRemoteAsset(remoteAsset: RemoteAsset): Asset {\n  return {\n    id: remoteAsset.id,\n    legacyId: remoteAsset.legacy_id,\n    assetPackId: remoteAsset.asset_pack_id,\n    name: remoteAsset.name,\n    model: remoteAsset.model,\n    script: remoteAsset.script,\n    thumbnail: getContentsStorageUrl(remoteAsset.thumbnail),\n    tags: remoteAsset.tags,\n    category: remoteAsset.category,\n    contents: remoteAsset.contents,\n    metrics: remoteAsset.metrics,\n    parameters: remoteAsset.parameters,\n    actions: remoteAsset.actions\n  }\n}\n\nfunction fromPoolGroup(poolGroup: RemotePoolGroup): PoolGroup {\n  return {\n    id: poolGroup.id,\n    name: poolGroup.name,\n    isActive: poolGroup.is_active,\n    activeFrom: new Date(Date.parse(poolGroup.active_from)),\n    activeUntil: new Date(Date.parse(poolGroup.active_until))\n  }\n}\n\nfunction toRemoteItem(item: Item): RemoteItem {\n  const remoteItem: RemoteItem = {\n    id: item.id,\n    name: item.name,\n    description: item.description || '',\n    thumbnail: item.thumbnail,\n    eth_address: item.owner,\n    collection_id: item.collectionId || null,\n    blockchain_item_id: item.tokenId || null,\n    price: item.price || null,\n    urn: item.urn || null,\n    beneficiary: item.beneficiary || null,\n    rarity: item.rarity || null,\n    total_supply: item.totalSupply === undefined ? null : item.totalSupply,\n    is_published: false,\n    is_approved: false,\n    in_catalyst: item.inCatalyst || false,\n    type: item.type,\n    data: item.data,\n    metrics: item.metrics,\n    contents: item.contents,\n    content_hash: item.blockchainContentHash,\n    local_content_hash: item.currentContentHash,\n    catalyst_content_hash: item.catalystContentHash,\n    created_at: new Date(item.createdAt),\n    updated_at: new Date(item.updatedAt)\n  }\n\n  return remoteItem\n}\n\nfunction fromRemoteItem(remoteItem: RemoteItem) {\n  const item: Item = {\n    id: remoteItem.id,\n    name: remoteItem.name,\n    thumbnail: remoteItem.thumbnail,\n    owner: remoteItem.eth_address,\n    description: remoteItem.description,\n    isPublished: remoteItem.is_published,\n    isApproved: remoteItem.is_approved,\n    inCatalyst: remoteItem.in_catalyst,\n    type: remoteItem.type,\n    data: remoteItem.data,\n    contents: remoteItem.contents,\n    currentContentHash: remoteItem.local_content_hash,\n    blockchainContentHash: remoteItem.content_hash,\n    catalystContentHash: remoteItem.catalyst_content_hash,\n    metrics: remoteItem.metrics,\n    createdAt: +new Date(remoteItem.created_at),\n    updatedAt: +new Date(remoteItem.created_at)\n  }\n\n  if (remoteItem.collection_id) item.collectionId = remoteItem.collection_id\n  if (remoteItem.blockchain_item_id) item.tokenId = remoteItem.blockchain_item_id\n  if (remoteItem.price) item.price = remoteItem.price\n  if (remoteItem.urn) item.urn = remoteItem.urn\n  if (remoteItem.beneficiary) item.beneficiary = remoteItem.beneficiary\n  if (remoteItem.rarity) item.rarity = remoteItem.rarity\n  if (remoteItem.total_supply !== null) item.totalSupply = remoteItem.total_supply // 0 is false\n\n  return item\n}\n\nfunction toRemoteCollection(collection: Collection): RemoteCollection {\n  const remoteCollection: RemoteCollection = {\n    id: collection.id,\n    name: collection.name,\n    eth_address: collection.owner,\n    salt: collection.salt || null,\n    contract_address: collection.contractAddress || null,\n    urn: collection.urn,\n    is_published: false,\n    is_approved: false,\n    minters: collection.minters,\n    managers: collection.managers,\n    forum_link: collection.forumLink || null,\n    lock: collection.lock ? new Date(collection.lock) : null,\n    reviewed_at: collection.reviewedAt ? new Date(collection.reviewedAt) : null,\n    created_at: new Date(collection.createdAt),\n    updated_at: new Date(collection.updatedAt)\n  }\n\n  return remoteCollection\n}\n\nfunction fromRemoteCollection(remoteCollection: RemoteCollection) {\n  const collection: Collection = {\n    id: remoteCollection.id,\n    name: remoteCollection.name,\n    owner: remoteCollection.eth_address,\n    urn: remoteCollection.urn,\n    isPublished: remoteCollection.is_published,\n    isApproved: remoteCollection.is_approved,\n    itemCount: Number(remoteCollection.item_count),\n    minters: remoteCollection.minters || [],\n    managers: remoteCollection.managers || [],\n    forumLink: remoteCollection.forum_link || undefined,\n    lock: remoteCollection.lock ? +new Date(remoteCollection.lock) : undefined,\n    reviewedAt: remoteCollection.reviewed_at ? +new Date(remoteCollection.reviewed_at) : undefined,\n    createdAt: +new Date(remoteCollection.created_at),\n    updatedAt: +new Date(remoteCollection.updated_at)\n  }\n\n  if (remoteCollection.salt) collection.salt = remoteCollection.salt\n  if (remoteCollection.contract_address) collection.contractAddress = remoteCollection.contract_address\n\n  return collection\n}\n\nfunction getBaseCurationFields(remoteCuration: RemoteCollectionCuration | RemoteItemCuration) {\n  return {\n    id: remoteCuration.id,\n    status: remoteCuration.status,\n    createdAt: +new Date(remoteCuration.created_at),\n    updatedAt: +new Date(remoteCuration.updated_at)\n  }\n}\n\nfunction fromRemoteCollectionCuration(remoteCuration: RemoteCollectionCuration): CollectionCuration {\n  return {\n    ...getBaseCurationFields(remoteCuration),\n    collectionId: remoteCuration.collection_id,\n    assignee: remoteCuration.assignee\n  }\n}\n\nfunction fromRemoteItemCuration(remoteCuration: RemoteItemCuration): ItemCuration {\n  return {\n    ...getBaseCurationFields(remoteCuration),\n    itemId: remoteCuration.item_id,\n    contentHash: remoteCuration.content_hash\n  }\n}\n\nconst toRemoteCollectionQueryParameters = (params?: FetchCollectionsParams) => {\n  const { isPublished, ...rest } = params || {}\n  return {\n    is_published: isPublished,\n    ...rest\n  }\n}\n\nexport type PoolDeploymentAdditionalFields = {\n  groups?: string[]\n}\n\nexport type Sort = {\n  sort_by?: string\n  sort_order?: 'asc' | 'desc'\n}\n\nexport type Pagination = {\n  limit?: number\n  offset?: number\n}\n\nexport type PoolFilters = {\n  group?: string\n  eth_address?: string\n}\n\n// API\n\nexport class BuilderAPI extends BaseAPI {\n  private authorization: Authorization\n\n  constructor(url: string, authorization: Authorization) {\n    super(url)\n    this.authorization = authorization\n  }\n\n  async request(method: AxiosRequestConfig['method'], path: string, params?: APIParam | null, config?: AxiosRequestConfig) {\n    let authConfig = {}\n    let headers = {}\n    if (config) {\n      authConfig = { ...config }\n      if (config.headers) {\n        headers = { ...config.headers }\n      }\n    }\n    const authHeaders = this.authorization.createAuthHeaders(method, path)\n    headers = {\n      ...headers,\n      ...authHeaders\n    }\n    authConfig = { ...authConfig, headers }\n\n    try {\n      const response = await super.request(method, path, params, authConfig)\n      return response\n    } catch (error) {\n      if (this.isAxiosError(error) && error.response) {\n        error.message = error.response.data.error\n      }\n      throw error\n    }\n  }\n\n  async deployToPool(projectId: string, additionalInfo: PoolDeploymentAdditionalFields | null = null) {\n    await this.request('put', `/projects/${projectId}/pool`, additionalInfo)\n  }\n\n  async uploadMedia(\n    projectId: string,\n    preview: Blob,\n    shots: Record<string, Blob>,\n    onUploadProgress?: (progress: { loaded: number; total: number }) => void\n  ) {\n    const formData = new FormData()\n    formData.append('preview', preview)\n    formData.append('north', shots.north)\n    formData.append('east', shots.east)\n    formData.append('south', shots.south)\n    formData.append('west', shots.west)\n\n    await this.request('post', `/projects/${projectId}/media`, formData, {\n      onUploadProgress\n    })\n  }\n\n  async fetchProjects() {\n    const { items }: { items: RemoteProject[]; total: number } = await this.request('get', `/projects`)\n    return items.map(fromRemoteProject)\n  }\n\n  async fetchPublicProject(projectId: string, type: 'public' | 'pool' = 'public') {\n    const project: RemotePool = await this.request('get', `/projects/${projectId}/${type}`)\n    return type === 'pool' ? fromRemotePool(project) : fromRemoteProject(project)\n  }\n\n  async fetchPoolsPage(filters: PoolFilters & Pagination & Sort) {\n    const { items, total }: { items: RemotePool[]; total: number } = await this.request('get', '/pools', filters)\n    return { items: items.map(fromRemotePool), total }\n  }\n\n  async fetchPoolGroups(activeOnly: boolean = false) {\n    const items: RemotePoolGroup[] = await this.request('get', '/pools/groups', { activeOnly })\n    return items.map(fromPoolGroup)\n  }\n\n  async saveProject(project: Project, scene: Scene) {\n    const manifest = createManifest(toRemoteProject(project), scene)\n    await this.request('put', `/projects/${project.id}/manifest`, { manifest })\n  }\n\n  async saveProjectThumbnail(project: Project) {\n    const blob = dataURLToBlob(project.thumbnail)\n    const formData = new FormData()\n    if (blob) {\n      formData.append('thumbnail', blob)\n      await this.request('post', `/projects/${project.id}/media`, formData)\n    }\n  }\n\n  async deleteProject(id: string) {\n    await this.request('delete', `/projects/${id}`)\n  }\n\n  async fetchManifest(id: string, type: PreviewType.PROJECT | PreviewType.POOL | PreviewType.PUBLIC = PreviewType.PROJECT) {\n    const remoteManifest = await this.request('get', `/${type}s/${id}/manifest`)\n    const manifest = {\n      ...remoteManifest,\n      project: fromRemoteProject(remoteManifest.project)\n    } as Manifest\n\n    /* There are projects retrived from the cloud (S3, not DB) that don't have an ethAddress, even after migration (cos migration only impacts the DB),\n       those projects can be loaded into the app state via the Scene Pool, and they end up with a null ethAddress, and are mixed with projects\n       that the user created while being logged out (no ethAddress either). So to tell them appart we set them a placeholder value.\n    */\n    if (!manifest.project.ethAddress) {\n      manifest.project.ethAddress = 'legacy'\n    }\n\n    return runMigrations(manifest, migrations)\n  }\n\n  async saveAssetPack(assetPack: FullAssetPack) {\n    const remotePack = toRemoteAssetPack(assetPack)\n    await this.request('put', `/assetPacks/${remotePack.id}`, { assetPack: remotePack })\n  }\n\n  async saveAssetContents(\n    asset: Asset,\n    contents: Record<string, Blob>,\n    onUploadProgress?: (progress: { loaded: number; total: number }) => void\n  ) {\n    const formData = new FormData()\n\n    for (let path in contents) {\n      formData.append(path, contents[path])\n    }\n\n    await this.request('post', `/assetPacks/${asset.assetPackId}/assets/${asset.id}/files`, formData, {\n      onUploadProgress\n    })\n  }\n\n  async saveAssetPackThumbnail(assetPack: FullAssetPack) {\n    let blob: Blob | null = null\n\n    if (isDataUrl(assetPack.thumbnail)) {\n      blob = dataURLToBlob(assetPack.thumbnail)\n    } else {\n      blob = await objectURLToBlob(assetPack.thumbnail)\n    }\n\n    if (!blob) throw new Error('Invalid thumbnail')\n\n    const formData = new FormData()\n    if (blob) {\n      formData.append('thumbnail', blob)\n      await this.request('post', `/assetPacks/${assetPack.id}/thumbnail`, formData)\n    }\n  }\n\n  async fetchAssetPacks(address?: string): Promise<FullAssetPack[]> {\n    const promisesOfRemoteAssetPacks: Array<Promise<RemoteAssetPack[]>> = [this.request('get', '/assetPacks', { owner: 'default' })]\n    if (address) {\n      promisesOfRemoteAssetPacks.push(this.request('get', '/assetPacks', { owner: address }))\n    }\n\n    const assetPacks: RemoteAssetPack[][] = await Promise.all(promisesOfRemoteAssetPacks)\n    return assetPacks.reduce((acc, curr) => acc.concat(curr), []).map(fromRemoteAssetPack)\n  }\n\n  async deleteAssetPack(assetPack: FullAssetPack) {\n    await this.request('delete', `/assetPacks/${assetPack.id}`)\n  }\n\n  likePool(pool: string, like: boolean = true) {\n    const method = like ? 'put' : 'delete'\n    return this.request(method, `/pools/${pool}/likes`)\n  }\n\n  async fetchItems(address?: string, params: { collectionId?: string; page?: number; limit?: number } = {}) {\n    const { collectionId, page = DEFAULT_PAGE, limit = DEFAULT_PAGE_SIZE } = params\n    const endpoint = address ? `/${address}/items` : '/items'\n    const remoteItems: PaginatedResource<RemoteItem> = await this.request('get', endpoint, { page, limit, collectionId })\n    return { ...remoteItems, results: remoteItems.results.map(fromRemoteItem) }\n  }\n\n  async fetchItem(id: string) {\n    const remoteItem: RemoteItem = await this.request('get', `/items/${id}`)\n    return fromRemoteItem(remoteItem)\n  }\n\n  async fetchCollectionItems(collectionId: string, options: { page?: number; limit?: number; status?: CurationStatus } = {}) {\n    const { page, limit } = options\n    const remoteResponse = await this.request('get', `/collections/${collectionId}/items`, options)\n    if (page && limit && remoteResponse.results) {\n      // TODO: remove this check when we have pagination on standard collections\n      return { ...remoteResponse, results: remoteResponse.results.map(fromRemoteItem) }\n    }\n    return remoteResponse.map(fromRemoteItem)\n  }\n\n  saveItem = async (item: Item, contents: Record<string, Blob>) => {\n    await this.request('put', `/items/${item.id}`, { item: toRemoteItem(item) })\n    // This has to be done after the PUT above, otherwise it will fail when creating an item, since it wont find it in the DB and return a 404\n    await this.saveItemContents(item, contents)\n  }\n\n  saveItemContents = async (item: Item, contents: Record<string, Blob>) => {\n    if (Object.keys(contents).length > 0) {\n      const formData = new FormData()\n      for (let path in contents) {\n        formData.append(item.contents[path], contents[path])\n      }\n\n      return this.request('post', `/items/${item.id}/files`, formData)\n    }\n  }\n\n  async deleteItem(id: string) {\n    await this.request('delete', `/items/${id}`, {})\n  }\n\n  async fetchCollections(address?: string, params?: FetchCollectionsParams) {\n    const remoteCollections = address\n      ? await this.request('get', `/${address}/collections`, params)\n      : await this.request('get', '/collections', toRemoteCollectionQueryParameters(params))\n\n    const { limit, page } = params || {}\n    if (page && limit && remoteCollections.results) {\n      // TODO: remove this check when we have pagination on standard collections\n      return { ...remoteCollections, results: remoteCollections.results.map(fromRemoteCollection) }\n    }\n    return remoteCollections.map(fromRemoteCollection)\n  }\n\n  async fetchCollection(id: string) {\n    const remoteCollection: RemoteCollection = await this.request('get', `/collections/${id}`)\n    return fromRemoteCollection(remoteCollection)\n  }\n\n  async publishStandardCollection(collectionId: string) {\n    const { collection, items }: { collection: RemoteCollection; items: RemoteItem[] } = await this.request(\n      'post',\n      `/collections/${collectionId}/publish`\n    )\n    return {\n      collection: fromRemoteCollection(collection),\n      items: items.map(fromRemoteItem)\n    }\n  }\n\n  async publishTPCollection(collectionId: string, itemIds: string[], cheque: Cheque) {\n    const {\n      collection,\n      items,\n      itemCurations\n    }: { collection: RemoteCollection; items: RemoteItem[]; itemCurations: RemoteItemCuration[] } = await this.request(\n      'post',\n      `/collections/${collectionId}/publish`,\n      {\n        itemIds,\n        cheque\n      }\n    )\n    return {\n      collection: fromRemoteCollection(collection),\n      items: items.map(fromRemoteItem),\n      itemCurations: itemCurations.map(fromRemoteItemCuration)\n    }\n  }\n\n  async saveCollection(collection: Collection, data: string) {\n    const remoteCollection = await this.request('put', `/collections/${collection.id}`, {\n      collection: toRemoteCollection(collection),\n      data\n    })\n    return fromRemoteCollection(remoteCollection)\n  }\n\n  saveTOS = async (collection: Collection, email: string): Promise<void> => {\n    await this.request('post', `/collections/${collection.id}/tos`, { email, collection_address: collection.contractAddress })\n  }\n\n  lockCollection = (collection: Collection): Promise<string> => {\n    return this.request('post', `/collections/${collection.id}/lock`, { collection_address: collection.id })\n  }\n\n  async deleteCollection(id: string) {\n    await this.request('delete', `/collections/${id}`, {})\n  }\n\n  async fetchCurations(): Promise<CollectionCuration[]> {\n    const curations: RemoteCollectionCuration[] = await this.request('get', `/curations`)\n\n    return curations.map(fromRemoteCollectionCuration)\n  }\n\n  async fetchItemCuration(itemId: Item['id']): Promise<ItemCuration> {\n    const curation: RemoteItemCuration = await this.request('get', `/items/${itemId}/curation`)\n\n    return fromRemoteItemCuration(curation)\n  }\n\n  async fetchItemCurations(collectionId: Collection['id'], itemIds?: Item['id'][]) {\n    const curations: RemoteItemCuration[] = await this.request('get', `/collections/${collectionId}/itemCurations`, {\n      itemIds\n    })\n    return curations.map(fromRemoteItemCuration)\n  }\n\n  async fetchCuration(collectionId: string): Promise<CollectionCuration | undefined> {\n    const curation: RemoteCollectionCuration | undefined = await this.request('get', `/collections/${collectionId}/curation`)\n\n    if (!curation) {\n      return\n    }\n\n    return fromRemoteCollectionCuration(curation)\n  }\n\n  pushCuration(collectionId: string, assignee?: string | null): Promise<void> {\n    return this.request('post', `/collections/${collectionId}/curation`, { curation: { assignee } })\n  }\n\n  async pushItemCuration(itemId: string): Promise<ItemCuration> {\n    const curation: RemoteItemCuration = await this.request('post', `/items/${itemId}/curation`)\n\n    return fromRemoteItemCuration(curation)\n  }\n\n  fetchCommittee(): Promise<string[]> {\n    return this.request('get', '/committee')\n  }\n\n  createCollectionForumPost(collection: Collection, forumPost: ForumPost): Promise<string> {\n    return this.request('post', `/collections/${collection.id}/post`, { forumPost })\n  }\n\n  createCollectionNewAssigneeForumPost(collection: Collection, forumPost: ForumPost): Promise<string> {\n    return this.request('post', `/collections/${collection.id}/curation/post`, { forumPost })\n  }\n\n  fetchRarities(): Promise<Rarity[]> {\n    return this.request('get', '/rarities')\n  }\n\n  fetchThirdParties(manager?: string): Promise<ThirdParty[]> {\n    return this.request('get', '/thirdParties', { manager })\n  }\n\n  fetchThirdPartyAvailableSlots(thirdPartyId: string): Promise<number> {\n    return this.request('get', `/thirdParties/${thirdPartyId}/slots`)\n  }\n\n  fetchApprovalData = (collectionId: string): Promise<ItemApprovalData> => {\n    return this.request('get', `/collections/${collectionId}/approvalData`)\n  }\n\n  updateCurationStatus(collectionId: string, status: CurationStatus): Promise<void> {\n    return this.request('patch', `/collections/${collectionId}/curation`, { curation: { status } })\n  }\n\n  updateCuration(collectionId: string, curation: Partial<Pick<CollectionCuration, 'assignee' | 'status'>>): Promise<void> {\n    return this.request('patch', `/collections/${collectionId}/curation`, { curation })\n  }\n\n  async updateItemCurationStatus(itemId: string, status: CurationStatus): Promise<ItemCuration> {\n    const curation: RemoteItemCuration = await this.request('patch', `/items/${itemId}/curation`, { curation: { status } })\n    return fromRemoteItemCuration(curation)\n  }\n\n  async fetchContent(hash: string) {\n    const url = getContentsStorageUrl(hash)\n    const resp = await fetch(url, { headers: NO_CACHE_HEADERS })\n    if (!resp.ok) {\n      const message = await resp.text()\n      throw new Error(message)\n    }\n    const blob = await resp.blob()\n    return blob\n  }\n\n  async fetchContents(contents: Record<string, string>): Promise<Record<string, Blob>> {\n    const blobs = new Map<string, Promise<Blob>>()\n    const mappings: Promise<[string, Blob]>[] = []\n    for (const path in contents) {\n      const hash = contents[path]\n      // avoid fetching the same hash more than once\n      if (!blobs.has(hash)) {\n        blobs.set(hash, this.fetchContent(hash))\n      }\n      const blob = blobs.get(hash)!\n      mappings.push(blob.then(blob => [path, blob]))\n    }\n    return Promise.all(mappings).then(results =>\n      results.reduce<Record<string, Blob>>((obj, [path, blob]) => {\n        obj[path] = blob\n        return obj\n      }, {})\n    )\n  }\n\n  isAxiosError(error: any): error is AxiosError {\n    return error.isAxiosError\n  }\n}\n"]},"metadata":{},"sourceType":"module"}