{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { serialize } from \"../../Misc/decorators\";\nimport { CameraInputTypes } from \"../../Cameras/cameraInputsManager\";\nimport { KeyboardEventTypes } from \"../../Events/keyboardEvents\";\nimport { Vector3 } from \"../../Maths/math.vector\";\nimport { Tools } from '../../Misc/tools';\n/**\r\n * Listen to keyboard events to control the camera.\r\n * @see https://doc.babylonjs.com/how_to/customizing_camera_inputs\r\n */\n\nvar FlyCameraKeyboardInput =\n/** @class */\nfunction () {\n  function FlyCameraKeyboardInput() {\n    /**\r\n     * The list of keyboard keys used to control the forward move of the camera.\r\n     */\n    this.keysForward = [87];\n    /**\r\n     * The list of keyboard keys used to control the backward move of the camera.\r\n     */\n\n    this.keysBackward = [83];\n    /**\r\n     * The list of keyboard keys used to control the forward move of the camera.\r\n     */\n\n    this.keysUp = [69];\n    /**\r\n     * The list of keyboard keys used to control the backward move of the camera.\r\n     */\n\n    this.keysDown = [81];\n    /**\r\n     * The list of keyboard keys used to control the right strafe move of the camera.\r\n     */\n\n    this.keysRight = [68];\n    /**\r\n     * The list of keyboard keys used to control the left strafe move of the camera.\r\n     */\n\n    this.keysLeft = [65];\n    this._keys = new Array();\n  }\n  /**\r\n   * Attach the input controls to a specific dom element to get the input from.\r\n   * @param noPreventDefault Defines whether event caught by the controls should call preventdefault() (https://developer.mozilla.org/en-US/docs/Web/API/Event/preventDefault)\r\n   */\n\n\n  FlyCameraKeyboardInput.prototype.attachControl = function (noPreventDefault) {\n    var _this = this;\n\n    noPreventDefault = Tools.BackCompatCameraNoPreventDefault(arguments);\n\n    if (this._onCanvasBlurObserver) {\n      return;\n    }\n\n    this._scene = this.camera.getScene();\n    this._engine = this._scene.getEngine();\n    this._onCanvasBlurObserver = this._engine.onCanvasBlurObservable.add(function () {\n      _this._keys = [];\n    });\n    this._onKeyboardObserver = this._scene.onKeyboardObservable.add(function (info) {\n      var evt = info.event;\n\n      if (info.type === KeyboardEventTypes.KEYDOWN) {\n        if (_this.keysForward.indexOf(evt.keyCode) !== -1 || _this.keysBackward.indexOf(evt.keyCode) !== -1 || _this.keysUp.indexOf(evt.keyCode) !== -1 || _this.keysDown.indexOf(evt.keyCode) !== -1 || _this.keysLeft.indexOf(evt.keyCode) !== -1 || _this.keysRight.indexOf(evt.keyCode) !== -1) {\n          var index = _this._keys.indexOf(evt.keyCode);\n\n          if (index === -1) {\n            _this._keys.push(evt.keyCode);\n          }\n\n          if (!noPreventDefault) {\n            evt.preventDefault();\n          }\n        }\n      } else {\n        if (_this.keysForward.indexOf(evt.keyCode) !== -1 || _this.keysBackward.indexOf(evt.keyCode) !== -1 || _this.keysUp.indexOf(evt.keyCode) !== -1 || _this.keysDown.indexOf(evt.keyCode) !== -1 || _this.keysLeft.indexOf(evt.keyCode) !== -1 || _this.keysRight.indexOf(evt.keyCode) !== -1) {\n          var index = _this._keys.indexOf(evt.keyCode);\n\n          if (index >= 0) {\n            _this._keys.splice(index, 1);\n          }\n\n          if (!noPreventDefault) {\n            evt.preventDefault();\n          }\n        }\n      }\n    });\n  };\n  /**\r\n   * Detach the current controls from the specified dom element.\r\n   * @param ignored defines an ignored parameter kept for backward compatibility. If you want to define the source input element, you can set engine.inputElement before calling camera.attachControl\r\n   */\n\n\n  FlyCameraKeyboardInput.prototype.detachControl = function (ignored) {\n    if (this._scene) {\n      if (this._onKeyboardObserver) {\n        this._scene.onKeyboardObservable.remove(this._onKeyboardObserver);\n      }\n\n      if (this._onCanvasBlurObserver) {\n        this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver);\n      }\n\n      this._onKeyboardObserver = null;\n      this._onCanvasBlurObserver = null;\n    }\n\n    this._keys = [];\n  };\n  /**\r\n   * Gets the class name of the current intput.\r\n   * @returns the class name\r\n   */\n\n\n  FlyCameraKeyboardInput.prototype.getClassName = function () {\n    return \"FlyCameraKeyboardInput\";\n  };\n  /** @hidden */\n\n\n  FlyCameraKeyboardInput.prototype._onLostFocus = function (e) {\n    this._keys = [];\n  };\n  /**\r\n   * Get the friendly name associated with the input class.\r\n   * @returns the input friendly name\r\n   */\n\n\n  FlyCameraKeyboardInput.prototype.getSimpleName = function () {\n    return \"keyboard\";\n  };\n  /**\r\n   * Update the current camera state depending on the inputs that have been used this frame.\r\n   * This is a dynamically created lambda to avoid the performance penalty of looping for inputs in the render loop.\r\n   */\n\n\n  FlyCameraKeyboardInput.prototype.checkInputs = function () {\n    if (this._onKeyboardObserver) {\n      var camera = this.camera; // Keyboard\n\n      for (var index = 0; index < this._keys.length; index++) {\n        var keyCode = this._keys[index];\n\n        var speed = camera._computeLocalCameraSpeed();\n\n        if (this.keysForward.indexOf(keyCode) !== -1) {\n          camera._localDirection.copyFromFloats(0, 0, speed);\n        } else if (this.keysBackward.indexOf(keyCode) !== -1) {\n          camera._localDirection.copyFromFloats(0, 0, -speed);\n        } else if (this.keysUp.indexOf(keyCode) !== -1) {\n          camera._localDirection.copyFromFloats(0, speed, 0);\n        } else if (this.keysDown.indexOf(keyCode) !== -1) {\n          camera._localDirection.copyFromFloats(0, -speed, 0);\n        } else if (this.keysRight.indexOf(keyCode) !== -1) {\n          camera._localDirection.copyFromFloats(speed, 0, 0);\n        } else if (this.keysLeft.indexOf(keyCode) !== -1) {\n          camera._localDirection.copyFromFloats(-speed, 0, 0);\n        }\n\n        if (camera.getScene().useRightHandedSystem) {\n          camera._localDirection.z *= -1;\n        }\n\n        camera.getViewMatrix().invertToRef(camera._cameraTransformMatrix);\n        Vector3.TransformNormalToRef(camera._localDirection, camera._cameraTransformMatrix, camera._transformedDirection);\n        camera.cameraDirection.addInPlace(camera._transformedDirection);\n      }\n    }\n  };\n\n  __decorate([serialize()], FlyCameraKeyboardInput.prototype, \"keysForward\", void 0);\n\n  __decorate([serialize()], FlyCameraKeyboardInput.prototype, \"keysBackward\", void 0);\n\n  __decorate([serialize()], FlyCameraKeyboardInput.prototype, \"keysUp\", void 0);\n\n  __decorate([serialize()], FlyCameraKeyboardInput.prototype, \"keysDown\", void 0);\n\n  __decorate([serialize()], FlyCameraKeyboardInput.prototype, \"keysRight\", void 0);\n\n  __decorate([serialize()], FlyCameraKeyboardInput.prototype, \"keysLeft\", void 0);\n\n  return FlyCameraKeyboardInput;\n}();\n\nexport { FlyCameraKeyboardInput };\nCameraInputTypes[\"FlyCameraKeyboardInput\"] = FlyCameraKeyboardInput;","map":null,"metadata":{},"sourceType":"module"}