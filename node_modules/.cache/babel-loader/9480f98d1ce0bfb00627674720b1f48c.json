{"ast":null,"code":"import _classCallCheck from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/opt/work/NZ_test/src/components/ItemEditorPage/LeftPanel/LeftPanel.tsx\";\nimport * as React from 'react';\nimport { Loader, Tabs } from 'decentraland-ui';\nimport { t } from 'decentraland-dapps/dist/modules/translation/utils';\nimport { sortByName } from 'lib/sort';\nimport { isThirdParty } from 'lib/urn';\nimport { CollectionType } from 'modules/collection/types';\nimport { CurationStatus } from 'modules/curations/types';\nimport { getCollectionType } from 'modules/collection/utils';\nimport CollectionProvider from 'components/CollectionProvider';\nimport Header from './Header';\nimport Items from './Items';\nimport Collections from './Collections';\nimport { LEFT_PANEL_PAGE_SIZE } from '../constants';\nimport { ItemEditorTabs } from './LeftPanel.types';\nimport './LeftPanel.css';\nvar INITIAL_PAGE = 1;\n\nvar LeftPanel = /*#__PURE__*/function (_React$PureComponent) {\n  _inherits(LeftPanel, _React$PureComponent);\n\n  function LeftPanel() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, LeftPanel);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(LeftPanel)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      pages: [INITIAL_PAGE],\n      currentTab: ItemEditorTabs.COLLECTIONS\n    };\n\n    _this.loadPage = function (page) {\n      _this.setState({\n        pages: [page]\n      }, _this.fetchResource);\n    };\n\n    _this.loadRandomPage = function (currentItems) {\n      var pages = _this.state.pages;\n      var _this$props = _this.props,\n          totalItems = _this$props.totalItems,\n          totalCollections = _this$props.totalCollections,\n          onSetReviewedItems = _this$props.onSetReviewedItems;\n      var totalResources = _this.isCollectionTabActive() ? totalCollections : totalItems;\n      var totalPages = Math.ceil(totalResources / LEFT_PANEL_PAGE_SIZE);\n      var randomPage;\n\n      while (!randomPage) {\n        randomPage = Math.floor(Math.random() * totalPages);\n\n        if (pages.includes(randomPage)) {\n          randomPage = null;\n        }\n      }\n\n      onSetReviewedItems(currentItems);\n\n      _this.setState({\n        pages: [randomPage]\n      }, _this.fetchResource);\n    };\n\n    _this.handleTabChange = function (tab) {\n      _this.setState({\n        currentTab: tab,\n        pages: [INITIAL_PAGE]\n      }, _this.fetchResource);\n    };\n\n    _this.isCollectionTabActive = function () {\n      var selectedCollectionId = _this.props.selectedCollectionId;\n      var currentTab = _this.state.currentTab;\n      return currentTab === ItemEditorTabs.COLLECTIONS && !selectedCollectionId;\n    };\n\n    return _this;\n  }\n\n  _createClass(LeftPanel, [{\n    key: \"fetchResource\",\n    value: function fetchResource() {\n      var _this$props2 = this.props,\n          address = _this$props2.address,\n          onFetchCollections = _this$props2.onFetchCollections,\n          onFetchOrphanItems = _this$props2.onFetchOrphanItems,\n          isReviewing = _this$props2.isReviewing,\n          selectedCollectionId = _this$props2.selectedCollectionId;\n      var pages = this.state.pages; // this is for the items editor base view, if a collection is selected, the logic will be handled in the collection provider\n\n      if (address && !isReviewing && !selectedCollectionId) {\n        var page = pages[pages.length - 1]; // fetch new last page added, the previous ones were already fetched\n\n        var fetchFn = this.isCollectionTabActive() ? onFetchCollections : onFetchOrphanItems;\n        fetchFn(address, {\n          limit: LEFT_PANEL_PAGE_SIZE,\n          page: page\n        });\n      }\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.fetchResource();\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      var _this$props3 = this.props,\n          isConnected = _this$props3.isConnected,\n          address = _this$props3.address,\n          selectedCollectionId = _this$props3.selectedCollectionId; // fetch only if this was triggered by a connecting event or if th selectedCollection changes\n\n      if (address && isConnected && (isConnected !== prevProps.isConnected || prevProps.selectedCollectionId && !selectedCollectionId)) {\n        this.setState({\n          pages: [INITIAL_PAGE]\n        }, this.fetchResource);\n      }\n\n      if (prevProps.selectedCollectionId !== selectedCollectionId) {\n        this.setState({\n          pages: [INITIAL_PAGE]\n        });\n      }\n    }\n  }, {\n    key: \"getItems\",\n    value: function getItems(collection, collectionItems) {\n      var _this$props4 = this.props,\n          selectedCollectionId = _this$props4.selectedCollectionId,\n          orphanItems = _this$props4.orphanItems,\n          isReviewing = _this$props4.isReviewing;\n\n      if (selectedCollectionId && collection) {\n        return getCollectionType(collection) === CollectionType.THIRD_PARTY && isReviewing ? collectionItems.filter(function (item) {\n          return item.isPublished;\n        }) : collectionItems;\n      }\n\n      return orphanItems;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$props5 = this.props,\n          allItems = _this$props5.items,\n          totalItems = _this$props5.totalItems,\n          totalCollections = _this$props5.totalCollections,\n          collections = _this$props5.collections,\n          selectedItemId = _this$props5.selectedItemId,\n          selectedCollectionId = _this$props5.selectedCollectionId,\n          visibleItems = _this$props5.visibleItems,\n          bodyShape = _this$props5.bodyShape,\n          isReviewing = _this$props5.isReviewing,\n          isConnected = _this$props5.isConnected,\n          onSetItems = _this$props5.onSetItems,\n          onSetCollection = _this$props5.onSetCollection,\n          isLoadingOrphanItems = _this$props5.isLoading,\n          onSetReviewedItems = _this$props5.onSetReviewedItems;\n      var pages = this.state.pages;\n      var showTabs = !selectedCollectionId;\n      var showCollections = this.isCollectionTabActive() && !selectedCollectionId;\n      var showItems = !this.isCollectionTabActive() || selectedCollectionId;\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"LeftPanel\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 114,\n          columnNumber: 7\n        }\n      }, isConnected ? /*#__PURE__*/React.createElement(CollectionProvider, {\n        id: selectedCollectionId,\n        itemsPage: pages,\n        itemsPageSize: LEFT_PANEL_PAGE_SIZE,\n        status: isReviewing ? CurationStatus.PENDING : undefined,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 116,\n          columnNumber: 11\n        }\n      }, function (_ref) {\n        var paginatedCollections = _ref.paginatedCollections,\n            collection = _ref.collection,\n            collectionItems = _ref.paginatedItems,\n            isLoading = _ref.isLoading;\n\n        var items = _this2.getItems(collection, collectionItems);\n\n        var isCollectionTab = _this2.isCollectionTabActive();\n\n        var showLoader = isLoading && (isCollectionTab && collections.length === 0 || !isCollectionTab && items.length === 0);\n\n        if (showLoader) {\n          return /*#__PURE__*/React.createElement(Loader, {\n            size: \"massive\",\n            active: true,\n            __self: _this2,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 127,\n              columnNumber: 24\n            }\n          });\n        }\n\n        if (items.length === 0 && collections.length === 0) {\n          return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Header, {\n            __self: _this2,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 133,\n              columnNumber: 21\n            }\n          }), /*#__PURE__*/React.createElement(\"div\", {\n            className: \"empty\",\n            __self: _this2,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 134,\n              columnNumber: 21\n            }\n          }, /*#__PURE__*/React.createElement(\"div\", {\n            className: \"subtitle\",\n            __self: _this2,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 135,\n              columnNumber: 23\n            }\n          }, t('collections_page.empty_description'))));\n        } else if (items.length === 0 && selectedCollectionId) {\n          return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Header, {\n            __self: _this2,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 142,\n              columnNumber: 21\n            }\n          }), /*#__PURE__*/React.createElement(\"div\", {\n            className: \"empty\",\n            __self: _this2,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 143,\n              columnNumber: 21\n            }\n          }, /*#__PURE__*/React.createElement(\"div\", {\n            className: \"subtitle\",\n            __self: _this2,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 144,\n              columnNumber: 23\n            }\n          }, isReviewing ? t('item_editor.left_panel.no_items_to_review') : t('item_editor.left_panel.empty_collection'))));\n        }\n\n        return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Header, {\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 154,\n            columnNumber: 19\n          }\n        }), showTabs ? /*#__PURE__*/React.createElement(Tabs, {\n          isFullscreen: true,\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 156,\n            columnNumber: 21\n          }\n        }, /*#__PURE__*/React.createElement(Tabs.Tab, {\n          active: isCollectionTab,\n          onClick: function onClick() {\n            return _this2.handleTabChange(ItemEditorTabs.COLLECTIONS);\n          },\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 157,\n            columnNumber: 23\n          }\n        }, t('collections_page.collections')), /*#__PURE__*/React.createElement(Tabs.Tab, {\n          active: !isCollectionTab,\n          onClick: function onClick() {\n            return _this2.handleTabChange(ItemEditorTabs.ORPHAN_ITEMS);\n          },\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 160,\n            columnNumber: 23\n          }\n        }, t('item_editor.left_panel.items'))) : null, showCollections ? /*#__PURE__*/React.createElement(Collections, {\n          collections: paginatedCollections,\n          totalCollections: totalCollections || collections.length,\n          items: allItems,\n          hasHeader: items.length > 0,\n          selectedCollectionId: selectedCollectionId,\n          onSetCollection: onSetCollection,\n          onLoadPage: _this2.loadPage,\n          isLoading: isLoading,\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 166,\n            columnNumber: 21\n          }\n        }) : null, showItems ? /*#__PURE__*/React.createElement(Items, {\n          items: !collection || !isThirdParty(collection.urn) ? items.sort(sortByName) : items,\n          totalItems: totalItems || items.length,\n          hasHeader: !selectedCollectionId && collections.length > 0,\n          selectedItemId: selectedItemId,\n          selectedCollectionId: selectedCollectionId,\n          isReviewing: isReviewing,\n          visibleItems: visibleItems,\n          bodyShape: bodyShape,\n          onSetItems: onSetItems,\n          isLoading: isLoading || isLoadingOrphanItems,\n          onLoadRandomPage: function onLoadRandomPage() {\n            return _this2.loadRandomPage(items);\n          },\n          onLoadPage: _this2.loadPage,\n          onSetReviewedItems: onSetReviewedItems,\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 178,\n            columnNumber: 21\n          }\n        }) : null);\n      }) : null);\n    }\n  }]);\n\n  return LeftPanel;\n}(React.PureComponent);\n\nexport { LeftPanel as default };","map":{"version":3,"sources":["/opt/work/NZ_test/src/components/ItemEditorPage/LeftPanel/LeftPanel.tsx"],"names":["React","Loader","Tabs","t","sortByName","isThirdParty","CollectionType","CurationStatus","getCollectionType","CollectionProvider","Header","Items","Collections","LEFT_PANEL_PAGE_SIZE","ItemEditorTabs","INITIAL_PAGE","LeftPanel","state","pages","currentTab","COLLECTIONS","loadPage","page","setState","fetchResource","loadRandomPage","currentItems","props","totalItems","totalCollections","onSetReviewedItems","totalResources","isCollectionTabActive","totalPages","Math","ceil","randomPage","floor","random","includes","handleTabChange","tab","selectedCollectionId","address","onFetchCollections","onFetchOrphanItems","isReviewing","length","fetchFn","limit","prevProps","isConnected","collection","collectionItems","orphanItems","THIRD_PARTY","filter","item","isPublished","allItems","items","collections","selectedItemId","visibleItems","bodyShape","onSetItems","onSetCollection","isLoadingOrphanItems","isLoading","showTabs","showCollections","showItems","PENDING","undefined","paginatedCollections","paginatedItems","getItems","isCollectionTab","showLoader","ORPHAN_ITEMS","urn","sort","PureComponent"],"mappings":";;;;;;AAAA,OAAO,KAAKA,KAAZ,MAAuB,OAAvB;AACA,SAASC,MAAT,EAAiBC,IAAjB,QAA6B,iBAA7B;AACA,SAASC,CAAT,QAAkB,mDAAlB;AACA,SAASC,UAAT,QAA2B,UAA3B;AACA,SAASC,YAAT,QAA6B,SAA7B;AACA,SAAqBC,cAArB,QAA2C,0BAA3C;AACA,SAASC,cAAT,QAA+B,yBAA/B;AACA,SAASC,iBAAT,QAAkC,0BAAlC;AAEA,OAAOC,kBAAP,MAA+B,+BAA/B;AACA,OAAOC,MAAP,MAAmB,UAAnB;AACA,OAAOC,KAAP,MAAkB,SAAlB;AACA,OAAOC,WAAP,MAAwB,eAAxB;AACA,SAASC,oBAAT,QAAqC,cAArC;AACA,SAAuBC,cAAvB,QAA6C,mBAA7C;AACA,OAAO,iBAAP;AAEA,IAAMC,YAAY,GAAG,CAArB;;IAEqBC,S;;;;;;;;;;;;;;;UACnBC,K,GAAQ;AACNC,MAAAA,KAAK,EAAE,CAACH,YAAD,CADD;AAENI,MAAAA,UAAU,EAAEL,cAAc,CAACM;AAFrB,K;;UAyCRC,Q,GAAW,UAACC,IAAD,EAAkB;AAC3B,YAAKC,QAAL,CAAc;AAAEL,QAAAA,KAAK,EAAE,CAACI,IAAD;AAAT,OAAd,EAAiC,MAAKE,aAAtC;AACD,K;;UAEDC,c,GAAiB,UAACC,YAAD,EAA0B;AAAA,UACjCR,KADiC,GACvB,MAAKD,KADkB,CACjCC,KADiC;AAAA,wBAEoB,MAAKS,KAFzB;AAAA,UAEjCC,UAFiC,eAEjCA,UAFiC;AAAA,UAErBC,gBAFqB,eAErBA,gBAFqB;AAAA,UAEHC,kBAFG,eAEHA,kBAFG;AAGzC,UAAMC,cAAc,GAAG,MAAKC,qBAAL,KAA+BH,gBAA/B,GAAkDD,UAAzE;AACA,UAAMK,UAAU,GAAGC,IAAI,CAACC,IAAL,CAAUJ,cAAc,GAAIlB,oBAA5B,CAAnB;AACA,UAAIuB,UAAJ;;AACA,aAAO,CAACA,UAAR,EAAoB;AAClBA,QAAAA,UAAU,GAAGF,IAAI,CAACG,KAAL,CAAWH,IAAI,CAACI,MAAL,KAAgBL,UAA3B,CAAb;;AACA,YAAIf,KAAK,CAACqB,QAAN,CAAeH,UAAf,CAAJ,EAAgC;AAC9BA,UAAAA,UAAU,GAAG,IAAb;AACD;AACF;;AACDN,MAAAA,kBAAkB,CAACJ,YAAD,CAAlB;;AACA,YAAKH,QAAL,CAAc;AAAEL,QAAAA,KAAK,EAAE,CAACkB,UAAD;AAAT,OAAd,EAAuC,MAAKZ,aAA5C;AACD,K;;UAEDgB,e,GAAkB,UAACC,GAAD,EAAyB;AACzC,YAAKlB,QAAL,CAAc;AAAEJ,QAAAA,UAAU,EAAEsB,GAAd;AAAmBvB,QAAAA,KAAK,EAAE,CAACH,YAAD;AAA1B,OAAd,EAA0D,MAAKS,aAA/D;AACD,K;;UAEDQ,qB,GAAwB,YAAM;AAAA,UACpBU,oBADoB,GACK,MAAKf,KADV,CACpBe,oBADoB;AAAA,UAEpBvB,UAFoB,GAEL,MAAKF,KAFA,CAEpBE,UAFoB;AAG5B,aAAOA,UAAU,KAAKL,cAAc,CAACM,WAA9B,IAA6C,CAACsB,oBAArD;AACD,K;;;;;;;oCAhEe;AAAA,yBACiF,KAAKf,KADtF;AAAA,UACNgB,OADM,gBACNA,OADM;AAAA,UACGC,kBADH,gBACGA,kBADH;AAAA,UACuBC,kBADvB,gBACuBA,kBADvB;AAAA,UAC2CC,WAD3C,gBAC2CA,WAD3C;AAAA,UACwDJ,oBADxD,gBACwDA,oBADxD;AAAA,UAENxB,KAFM,GAEI,KAAKD,KAFT,CAENC,KAFM,EAGd;;AACA,UAAIyB,OAAO,IAAI,CAACG,WAAZ,IAA2B,CAACJ,oBAAhC,EAAsD;AACpD,YAAMpB,IAAI,GAAGJ,KAAK,CAACA,KAAK,CAAC6B,MAAN,GAAe,CAAhB,CAAlB,CADoD,CACf;;AACrC,YAAMC,OAAO,GAAG,KAAKhB,qBAAL,KAA+BY,kBAA/B,GAAoDC,kBAApE;AACAG,QAAAA,OAAO,CAACL,OAAD,EAAU;AAAEM,UAAAA,KAAK,EAAEpC,oBAAT;AAA+BS,UAAAA,IAAI,EAAJA;AAA/B,SAAV,CAAP;AACD;AACF;;;wCAEmB;AAClB,WAAKE,aAAL;AACD;;;uCAEkB0B,S,EAAkB;AAAA,yBACoB,KAAKvB,KADzB;AAAA,UAC3BwB,WAD2B,gBAC3BA,WAD2B;AAAA,UACdR,OADc,gBACdA,OADc;AAAA,UACLD,oBADK,gBACLA,oBADK,EAEnC;;AACA,UAAIC,OAAO,IAAIQ,WAAX,KAA2BA,WAAW,KAAKD,SAAS,CAACC,WAA1B,IAA0CD,SAAS,CAACR,oBAAV,IAAkC,CAACA,oBAAxG,CAAJ,EAAoI;AAClI,aAAKnB,QAAL,CAAc;AAAEL,UAAAA,KAAK,EAAE,CAACH,YAAD;AAAT,SAAd,EAAyC,KAAKS,aAA9C;AACD;;AACD,UAAI0B,SAAS,CAACR,oBAAV,KAAmCA,oBAAvC,EAA6D;AAC3D,aAAKnB,QAAL,CAAc;AAAEL,UAAAA,KAAK,EAAE,CAACH,YAAD;AAAT,SAAd;AACD;AACF;;;6BAEQqC,U,EAA+BC,e,EAAyB;AAAA,yBACJ,KAAK1B,KADD;AAAA,UACvDe,oBADuD,gBACvDA,oBADuD;AAAA,UACjCY,WADiC,gBACjCA,WADiC;AAAA,UACpBR,WADoB,gBACpBA,WADoB;;AAE/D,UAAIJ,oBAAoB,IAAIU,UAA5B,EAAwC;AACtC,eAAO5C,iBAAiB,CAAC4C,UAAD,CAAjB,KAAkC9C,cAAc,CAACiD,WAAjD,IAAgET,WAAhE,GACHO,eAAe,CAACG,MAAhB,CAAuB,UAAAC,IAAI;AAAA,iBAAIA,IAAI,CAACC,WAAT;AAAA,SAA3B,CADG,GAEHL,eAFJ;AAGD;;AACD,aAAOC,WAAP;AACD;;;6BAgCQ;AAAA;;AAAA,yBAgBH,KAAK3B,KAhBF;AAAA,UAEEgC,QAFF,gBAELC,KAFK;AAAA,UAGLhC,UAHK,gBAGLA,UAHK;AAAA,UAILC,gBAJK,gBAILA,gBAJK;AAAA,UAKLgC,WALK,gBAKLA,WALK;AAAA,UAMLC,cANK,gBAMLA,cANK;AAAA,UAOLpB,oBAPK,gBAOLA,oBAPK;AAAA,UAQLqB,YARK,gBAQLA,YARK;AAAA,UASLC,SATK,gBASLA,SATK;AAAA,UAULlB,WAVK,gBAULA,WAVK;AAAA,UAWLK,WAXK,gBAWLA,WAXK;AAAA,UAYLc,UAZK,gBAYLA,UAZK;AAAA,UAaLC,eAbK,gBAaLA,eAbK;AAAA,UAcMC,oBAdN,gBAcLC,SAdK;AAAA,UAeLtC,kBAfK,gBAeLA,kBAfK;AAAA,UAiBCZ,KAjBD,GAiBW,KAAKD,KAjBhB,CAiBCC,KAjBD;AAkBP,UAAMmD,QAAQ,GAAG,CAAC3B,oBAAlB;AACA,UAAM4B,eAAe,GAAG,KAAKtC,qBAAL,MAAgC,CAACU,oBAAzD;AACA,UAAM6B,SAAS,GAAG,CAAC,KAAKvC,qBAAL,EAAD,IAAiCU,oBAAnD;AACA,0BACE;AAAK,QAAA,SAAS,EAAC,WAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACGS,WAAW,gBACV,oBAAC,kBAAD;AACE,QAAA,EAAE,EAAET,oBADN;AAEE,QAAA,SAAS,EAAExB,KAFb;AAGE,QAAA,aAAa,EAAEL,oBAHjB;AAIE,QAAA,MAAM,EAAEiC,WAAW,GAAGvC,cAAc,CAACiE,OAAlB,GAA4BC,SAJjD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAMG,gBAAsF;AAAA,YAAnFC,oBAAmF,QAAnFA,oBAAmF;AAAA,YAA7DtB,UAA6D,QAA7DA,UAA6D;AAAA,YAAjCC,eAAiC,QAAjDsB,cAAiD;AAAA,YAAhBP,SAAgB,QAAhBA,SAAgB;;AACrF,YAAMR,KAAK,GAAG,MAAI,CAACgB,QAAL,CAAcxB,UAAd,EAA0BC,eAA1B,CAAd;;AACA,YAAMwB,eAAe,GAAG,MAAI,CAAC7C,qBAAL,EAAxB;;AACA,YAAM8C,UAAU,GAAGV,SAAS,KAAMS,eAAe,IAAIhB,WAAW,CAACd,MAAZ,KAAuB,CAA3C,IAAkD,CAAC8B,eAAD,IAAoBjB,KAAK,CAACb,MAAN,KAAiB,CAA5F,CAA5B;;AACA,YAAI+B,UAAJ,EAAgB;AACd,8BAAO,oBAAC,MAAD;AAAQ,YAAA,IAAI,EAAC,SAAb;AAAuB,YAAA,MAAM,MAA7B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAAP;AACD;;AAED,YAAIlB,KAAK,CAACb,MAAN,KAAiB,CAAjB,IAAsBc,WAAW,CAACd,MAAZ,KAAuB,CAAjD,EAAoD;AAClD,8BACE,uDACE,oBAAC,MAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YADF,eAEE;AAAK,YAAA,SAAS,EAAC,OAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BACE;AAAK,YAAA,SAAS,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aAA2B5C,CAAC,CAAC,oCAAD,CAA5B,CADF,CAFF,CADF;AAQD,SATD,MASO,IAAIyD,KAAK,CAACb,MAAN,KAAiB,CAAjB,IAAsBL,oBAA1B,EAAgD;AACrD,8BACE,uDACE,oBAAC,MAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YADF,eAEE;AAAK,YAAA,SAAS,EAAC,OAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BACE;AAAK,YAAA,SAAS,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aACGI,WAAW,GAAG3C,CAAC,CAAC,2CAAD,CAAJ,GAAoDA,CAAC,CAAC,yCAAD,CADnE,CADF,CAFF,CADF;AAUD;;AAED,4BACE,uDACE,oBAAC,MAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UADF,EAEGkE,QAAQ,gBACP,oBAAC,IAAD;AAAM,UAAA,YAAY,MAAlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBACE,oBAAC,IAAD,CAAM,GAAN;AAAU,UAAA,MAAM,EAAEQ,eAAlB;AAAmC,UAAA,OAAO,EAAE;AAAA,mBAAM,MAAI,CAACrC,eAAL,CAAqB1B,cAAc,CAACM,WAApC,CAAN;AAAA,WAA5C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WACGjB,CAAC,CAAC,8BAAD,CADJ,CADF,eAIE,oBAAC,IAAD,CAAM,GAAN;AAAU,UAAA,MAAM,EAAE,CAAC0E,eAAnB;AAAoC,UAAA,OAAO,EAAE;AAAA,mBAAM,MAAI,CAACrC,eAAL,CAAqB1B,cAAc,CAACiE,YAApC,CAAN;AAAA,WAA7C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WACG5E,CAAC,CAAC,8BAAD,CADJ,CAJF,CADO,GASL,IAXN,EAYGmE,eAAe,gBACd,oBAAC,WAAD;AACE,UAAA,WAAW,EAAEI,oBADf;AAEE,UAAA,gBAAgB,EAAE7C,gBAAgB,IAAIgC,WAAW,CAACd,MAFpD;AAGE,UAAA,KAAK,EAAEY,QAHT;AAIE,UAAA,SAAS,EAAEC,KAAK,CAACb,MAAN,GAAe,CAJ5B;AAKE,UAAA,oBAAoB,EAAEL,oBALxB;AAME,UAAA,eAAe,EAAEwB,eANnB;AAOE,UAAA,UAAU,EAAE,MAAI,CAAC7C,QAPnB;AAQE,UAAA,SAAS,EAAE+C,SARb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UADc,GAWZ,IAvBN,EAwBGG,SAAS,gBACR,oBAAC,KAAD;AACE,UAAA,KAAK,EAAE,CAACnB,UAAD,IAAe,CAAC/C,YAAY,CAAC+C,UAAU,CAAC4B,GAAZ,CAA5B,GAA+CpB,KAAK,CAACqB,IAAN,CAAW7E,UAAX,CAA/C,GAAwEwD,KADjF;AAEE,UAAA,UAAU,EAAEhC,UAAU,IAAIgC,KAAK,CAACb,MAFlC;AAGE,UAAA,SAAS,EAAE,CAACL,oBAAD,IAAyBmB,WAAW,CAACd,MAAZ,GAAqB,CAH3D;AAIE,UAAA,cAAc,EAAEe,cAJlB;AAKE,UAAA,oBAAoB,EAAEpB,oBALxB;AAME,UAAA,WAAW,EAAEI,WANf;AAOE,UAAA,YAAY,EAAEiB,YAPhB;AAQE,UAAA,SAAS,EAAEC,SARb;AASE,UAAA,UAAU,EAAEC,UATd;AAUE,UAAA,SAAS,EAAEG,SAAS,IAAID,oBAV1B;AAWE,UAAA,gBAAgB,EAAE;AAAA,mBAAM,MAAI,CAAC1C,cAAL,CAAoBmC,KAApB,CAAN;AAAA,WAXpB;AAYE,UAAA,UAAU,EAAE,MAAI,CAACvC,QAZnB;AAaE,UAAA,kBAAkB,EAAES,kBAbtB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UADQ,GAgBN,IAxCN,CADF;AA4CD,OAhFH,CADU,GAmFR,IApFN,CADF;AAwFD;;;;EArLoC9B,KAAK,CAACkF,a;;SAAxBlE,S","sourcesContent":["import * as React from 'react'\nimport { Loader, Tabs } from 'decentraland-ui'\nimport { t } from 'decentraland-dapps/dist/modules/translation/utils'\nimport { sortByName } from 'lib/sort'\nimport { isThirdParty } from 'lib/urn'\nimport { Collection, CollectionType } from 'modules/collection/types'\nimport { CurationStatus } from 'modules/curations/types'\nimport { getCollectionType } from 'modules/collection/utils'\nimport { Item } from 'modules/item/types'\nimport CollectionProvider from 'components/CollectionProvider'\nimport Header from './Header'\nimport Items from './Items'\nimport Collections from './Collections'\nimport { LEFT_PANEL_PAGE_SIZE } from '../constants'\nimport { Props, State, ItemEditorTabs } from './LeftPanel.types'\nimport './LeftPanel.css'\n\nconst INITIAL_PAGE = 1\n\nexport default class LeftPanel extends React.PureComponent<Props, State> {\n  state = {\n    pages: [INITIAL_PAGE],\n    currentTab: ItemEditorTabs.COLLECTIONS\n  }\n\n  fetchResource() {\n    const { address, onFetchCollections, onFetchOrphanItems, isReviewing, selectedCollectionId } = this.props\n    const { pages } = this.state\n    // this is for the items editor base view, if a collection is selected, the logic will be handled in the collection provider\n    if (address && !isReviewing && !selectedCollectionId) {\n      const page = pages[pages.length - 1] // fetch new last page added, the previous ones were already fetched\n      const fetchFn = this.isCollectionTabActive() ? onFetchCollections : onFetchOrphanItems\n      fetchFn(address, { limit: LEFT_PANEL_PAGE_SIZE, page })\n    }\n  }\n\n  componentDidMount() {\n    this.fetchResource()\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    const { isConnected, address, selectedCollectionId } = this.props\n    // fetch only if this was triggered by a connecting event or if th selectedCollection changes\n    if (address && isConnected && (isConnected !== prevProps.isConnected || (prevProps.selectedCollectionId && !selectedCollectionId))) {\n      this.setState({ pages: [INITIAL_PAGE] }, this.fetchResource)\n    }\n    if (prevProps.selectedCollectionId !== selectedCollectionId) {\n      this.setState({ pages: [INITIAL_PAGE] })\n    }\n  }\n\n  getItems(collection: Collection | null, collectionItems: Item[]) {\n    const { selectedCollectionId, orphanItems, isReviewing } = this.props\n    if (selectedCollectionId && collection) {\n      return getCollectionType(collection) === CollectionType.THIRD_PARTY && isReviewing\n        ? collectionItems.filter(item => item.isPublished)\n        : collectionItems\n    }\n    return orphanItems\n  }\n\n  loadPage = (page: number) => {\n    this.setState({ pages: [page] }, this.fetchResource)\n  }\n\n  loadRandomPage = (currentItems: Item[]) => {\n    const { pages } = this.state\n    const { totalItems, totalCollections, onSetReviewedItems } = this.props\n    const totalResources = this.isCollectionTabActive() ? totalCollections : totalItems\n    const totalPages = Math.ceil(totalResources! / LEFT_PANEL_PAGE_SIZE)\n    let randomPage\n    while (!randomPage) {\n      randomPage = Math.floor(Math.random() * totalPages)\n      if (pages.includes(randomPage)) {\n        randomPage = null\n      }\n    }\n    onSetReviewedItems(currentItems)\n    this.setState({ pages: [randomPage] }, this.fetchResource)\n  }\n\n  handleTabChange = (tab: ItemEditorTabs) => {\n    this.setState({ currentTab: tab, pages: [INITIAL_PAGE] }, this.fetchResource)\n  }\n\n  isCollectionTabActive = () => {\n    const { selectedCollectionId } = this.props\n    const { currentTab } = this.state\n    return currentTab === ItemEditorTabs.COLLECTIONS && !selectedCollectionId\n  }\n\n  render() {\n    const {\n      items: allItems,\n      totalItems,\n      totalCollections,\n      collections,\n      selectedItemId,\n      selectedCollectionId,\n      visibleItems,\n      bodyShape,\n      isReviewing,\n      isConnected,\n      onSetItems,\n      onSetCollection,\n      isLoading: isLoadingOrphanItems,\n      onSetReviewedItems\n    } = this.props\n    const { pages } = this.state\n    const showTabs = !selectedCollectionId\n    const showCollections = this.isCollectionTabActive() && !selectedCollectionId\n    const showItems = !this.isCollectionTabActive() || selectedCollectionId\n    return (\n      <div className=\"LeftPanel\">\n        {isConnected ? (\n          <CollectionProvider\n            id={selectedCollectionId}\n            itemsPage={pages}\n            itemsPageSize={LEFT_PANEL_PAGE_SIZE}\n            status={isReviewing ? CurationStatus.PENDING : undefined}\n          >\n            {({ paginatedCollections, collection, paginatedItems: collectionItems, isLoading }) => {\n              const items = this.getItems(collection, collectionItems)\n              const isCollectionTab = this.isCollectionTabActive()\n              const showLoader = isLoading && ((isCollectionTab && collections.length === 0) || (!isCollectionTab && items.length === 0))\n              if (showLoader) {\n                return <Loader size=\"massive\" active />\n              }\n\n              if (items.length === 0 && collections.length === 0) {\n                return (\n                  <>\n                    <Header />\n                    <div className=\"empty\">\n                      <div className=\"subtitle\">{t('collections_page.empty_description')}</div>\n                    </div>\n                  </>\n                )\n              } else if (items.length === 0 && selectedCollectionId) {\n                return (\n                  <>\n                    <Header />\n                    <div className=\"empty\">\n                      <div className=\"subtitle\">\n                        {isReviewing ? t('item_editor.left_panel.no_items_to_review') : t('item_editor.left_panel.empty_collection')}\n                      </div>\n                    </div>\n                  </>\n                )\n              }\n\n              return (\n                <>\n                  <Header />\n                  {showTabs ? (\n                    <Tabs isFullscreen>\n                      <Tabs.Tab active={isCollectionTab} onClick={() => this.handleTabChange(ItemEditorTabs.COLLECTIONS)}>\n                        {t('collections_page.collections')}\n                      </Tabs.Tab>\n                      <Tabs.Tab active={!isCollectionTab} onClick={() => this.handleTabChange(ItemEditorTabs.ORPHAN_ITEMS)}>\n                        {t('item_editor.left_panel.items')}\n                      </Tabs.Tab>\n                    </Tabs>\n                  ) : null}\n                  {showCollections ? (\n                    <Collections\n                      collections={paginatedCollections}\n                      totalCollections={totalCollections || collections.length}\n                      items={allItems}\n                      hasHeader={items.length > 0}\n                      selectedCollectionId={selectedCollectionId}\n                      onSetCollection={onSetCollection}\n                      onLoadPage={this.loadPage}\n                      isLoading={isLoading}\n                    />\n                  ) : null}\n                  {showItems ? (\n                    <Items\n                      items={!collection || !isThirdParty(collection.urn) ? items.sort(sortByName) : items}\n                      totalItems={totalItems || items.length}\n                      hasHeader={!selectedCollectionId && collections.length > 0}\n                      selectedItemId={selectedItemId}\n                      selectedCollectionId={selectedCollectionId}\n                      isReviewing={isReviewing}\n                      visibleItems={visibleItems}\n                      bodyShape={bodyShape}\n                      onSetItems={onSetItems}\n                      isLoading={isLoading || isLoadingOrphanItems}\n                      onLoadRandomPage={() => this.loadRandomPage(items)}\n                      onLoadPage={this.loadPage}\n                      onSetReviewedItems={onSetReviewedItems}\n                    />\n                  ) : null}\n                </>\n              )\n            }}\n          </CollectionProvider>\n        ) : null}\n      </div>\n    )\n  }\n}\n"]},"metadata":{},"sourceType":"module"}