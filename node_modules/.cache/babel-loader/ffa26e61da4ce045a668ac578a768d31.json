{"ast":null,"code":"import _regeneratorRuntime from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _objectWithoutProperties from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport _asyncToGenerator from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _objectSpread from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _classCallCheck from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"/opt/work/NZ_test/src/components/Modals/CreateAndEditMultipleItemsModal/CreateAndEditMultipleItemsModal.tsx\";\nimport PQueue from 'p-queue';\nimport * as React from 'react';\nimport uuid from 'uuid';\nimport { FileTooBigError, ItemFactory, loadFile, MAX_FILE_SIZE, Rarity, THUMBNAIL_PATH } from '@dcl/builder-client';\nimport Dropzone from 'react-dropzone';\nimport { Button, Icon, Message, ModalNavigation, Progress, Table } from 'decentraland-ui';\nimport Modal from 'decentraland-dapps/dist/containers/Modal';\nimport { getAnalytics } from 'decentraland-dapps/dist/modules/analytics/utils';\nimport { T, t } from 'decentraland-dapps/dist/modules/translation/utils';\nimport { config } from 'config';\nimport { EngineType, getModelData } from 'lib/getModelData';\nimport { getExtension } from 'lib/file';\nimport { buildThirdPartyURN, decodeURN, URNType } from 'lib/urn';\nimport { convertImageIntoWearableThumbnail, dataURLToBlob, getImageType } from 'modules/media/utils';\nimport { ImageType } from 'modules/media/types';\nimport { MultipleItemsSaveState } from 'modules/ui/createMultipleItems/reducer';\nimport { IMAGE_PATH } from 'modules/item/types';\nimport { generateCatalystImage } from 'modules/item/utils';\nimport ItemImport from 'components/ItemImport';\nimport { InfoIcon } from 'components/InfoIcon';\nimport { CreateOrEditMultipleItemsModalType, ImportedFileType, ItemCreationView } from './CreateAndEditMultipleItemsModal.types';\nimport styles from './CreateAndEditMultipleItemsModal.module.css';\nvar WEARABLES_ZIP_INFRA_URL = config.get('WEARABLES_ZIP_INFRA_URL', '');\nvar AMOUNT_OF_FILES_TO_PROCESS_SIMULTANEOUSLY = 4;\n\nvar CreateAndEditMultipleItemsModal = /*#__PURE__*/function (_React$PureComponent) {\n  _inherits(CreateAndEditMultipleItemsModal, _React$PureComponent);\n\n  function CreateAndEditMultipleItemsModal() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, CreateAndEditMultipleItemsModal);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(CreateAndEditMultipleItemsModal)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.analytics = getAnalytics();\n    _this.state = {\n      view: ItemCreationView.IMPORT,\n      loadingFilesProgress: 0,\n      importedFiles: {}\n    };\n\n    _this.isViewClosable = function () {\n      var view = _this.state.view;\n      return view === ItemCreationView.IMPORTING || view === ItemCreationView.COMPLETED;\n    };\n\n    _this.getValidFiles = function () {\n      var importedFiles = _this.state.importedFiles;\n      return Object.values(importedFiles).filter(function (file) {\n        return file.type === ImportedFileType.ACCEPTED;\n      });\n    };\n\n    _this.getRejectedFiles = function () {\n      var importedFiles = _this.state.importedFiles;\n      return Object.values(importedFiles).filter(function (file) {\n        return file.type === ImportedFileType.REJECTED;\n      });\n    };\n\n    _this.handleRejectedFiles = function (rejectedFiles) {\n      _this.setState({\n        importedFiles: _objectSpread({}, _this.state.importedFiles, rejectedFiles.reduce(function (accum, file) {\n          accum[file.name] = {\n            type: ImportedFileType.REJECTED,\n            fileName: file.name,\n            reason: t('create_and_edit_multiple_items_modal.wrong_file_extension')\n          };\n          return accum;\n        }, {}))\n      });\n\n      _this.setState({\n        view: ItemCreationView.REVIEW\n      });\n    };\n\n    _this.processAcceptedFile = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(file) {\n        var _this$props, collection, metadata, fileArrayBuffer, loadedFile, itemFactory, thumbnail, modelPath, url, data, thumbnailImageType, decodedCollectionUrn, decodedUrn, thirdPartyName, thirdPartyCollectionId, builtItem, _builtItem$item, _id, itemWithoutId, catalystImage;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _this$props = _this.props, collection = _this$props.collection, metadata = _this$props.metadata;\n                _context.prev = 1;\n\n                if (!(file.size > MAX_FILE_SIZE)) {\n                  _context.next = 4;\n                  break;\n                }\n\n                throw new FileTooBigError(file.name, file.size);\n\n              case 4:\n                _context.next = 6;\n                return file.arrayBuffer();\n\n              case 6:\n                fileArrayBuffer = _context.sent;\n                _context.next = 9;\n                return loadFile(file.name, new Blob([new Uint8Array(fileArrayBuffer)]));\n\n              case 9:\n                loadedFile = _context.sent;\n\n                if (loadedFile.wearable) {\n                  _context.next = 12;\n                  break;\n                }\n\n                throw new Error(t('create_and_edit_multiple_items_modal.wearable_file_not_found'));\n\n              case 12:\n                itemFactory = new ItemFactory().fromConfig(loadedFile.wearable, loadedFile.content);\n                thumbnail = loadedFile.content[THUMBNAIL_PATH];\n\n                if (thumbnail) {\n                  _context.next = 28;\n                  break;\n                }\n\n                modelPath = loadedFile.wearable.data.representations[0].mainFile;\n                url = URL.createObjectURL(loadedFile.content[modelPath]);\n                _context.next = 19;\n                return getModelData(url, {\n                  width: 1024,\n                  height: 1024,\n                  extension: getExtension(modelPath) || undefined,\n                  engine: EngineType.BABYLON\n                });\n\n              case 19:\n                data = _context.sent;\n                URL.revokeObjectURL(url);\n                _context.next = 23;\n                return dataURLToBlob(data.image);\n\n              case 23:\n                thumbnail = _context.sent;\n\n                if (thumbnail) {\n                  _context.next = 26;\n                  break;\n                }\n\n                throw new Error(t('create_and_edit_multiple_items_modal.thumbnail_file_not_generated'));\n\n              case 26:\n                _context.next = 33;\n                break;\n\n              case 28:\n                _context.next = 30;\n                return getImageType(thumbnail);\n\n              case 30:\n                thumbnailImageType = _context.sent;\n\n                if (!(thumbnailImageType !== ImageType.PNG)) {\n                  _context.next = 33;\n                  break;\n                }\n\n                throw new Error(t('create_and_edit_multiple_items_modal.wrong_thumbnail_format'));\n\n              case 33:\n                _context.t0 = dataURLToBlob;\n                _context.next = 36;\n                return convertImageIntoWearableThumbnail(thumbnail);\n\n              case 36:\n                _context.t1 = _context.sent;\n                thumbnail = (0, _context.t0)(_context.t1);\n\n                if (thumbnail) {\n                  _context.next = 40;\n                  break;\n                }\n\n                throw new Error(t('create_and_edit_multiple_items_modal.thumbnail_file_not_generated'));\n\n              case 40:\n                itemFactory.withThumbnail(thumbnail); // Set the UNIQUE rarity so all items have this rarity as default although TP items don't require rarity\n\n                itemFactory.withRarity(Rarity.UNIQUE); // Override collection id if specified in the modal's metadata\n\n                if (metadata.collectionId) {\n                  itemFactory.withCollectionId(metadata.collectionId);\n                } // Generate or set the correct URN for the items taking into consideration the selected collection\n\n\n                decodedCollectionUrn = collection !== null && collection !== void 0 && collection.urn ? decodeURN(collection.urn) : null;\n\n                if (!(decodedCollectionUrn && decodedCollectionUrn.type === URNType.COLLECTIONS_THIRDPARTY && decodedCollectionUrn.thirdPartyCollectionId)) {\n                  _context.next = 54;\n                  break;\n                }\n\n                decodedUrn = loadedFile.wearable.id ? decodeURN(loadedFile.wearable.id) : null;\n\n                if (!(loadedFile.wearable.id && decodedUrn && decodedUrn.type === URNType.COLLECTIONS_THIRDPARTY)) {\n                  _context.next = 53;\n                  break;\n                }\n\n                thirdPartyName = decodedUrn.thirdPartyName, thirdPartyCollectionId = decodedUrn.thirdPartyCollectionId;\n\n                if (!(thirdPartyCollectionId && thirdPartyCollectionId !== decodedCollectionUrn.thirdPartyCollectionId || thirdPartyName && thirdPartyName !== decodedCollectionUrn.thirdPartyName)) {\n                  _context.next = 50;\n                  break;\n                }\n\n                throw new Error(t('create_and_edit_multiple_items_modal.invalid_urn'));\n\n              case 50:\n                if (decodedUrn.thirdPartyTokenId) {\n                  itemFactory.withUrn(buildThirdPartyURN(decodedCollectionUrn.thirdPartyName, decodedCollectionUrn.thirdPartyCollectionId, decodedUrn.thirdPartyTokenId));\n                }\n\n                _context.next = 54;\n                break;\n\n              case 53:\n                itemFactory.withUrn(buildThirdPartyURN(decodedCollectionUrn.thirdPartyName, decodedCollectionUrn.thirdPartyCollectionId, uuid.v4()));\n\n              case 54:\n                _context.next = 56;\n                return itemFactory.build();\n\n              case 56:\n                builtItem = _context.sent;\n\n                if (!_this.isCreating()) {\n                  _builtItem$item = builtItem.item, _id = _builtItem$item.id, itemWithoutId = _objectWithoutProperties(_builtItem$item, [\"id\"]);\n                  builtItem.item = itemWithoutId;\n                } // Generate catalyst image as part of the item\n\n\n                _context.next = 60;\n                return generateCatalystImage(builtItem.item, {\n                  thumbnail: builtItem.newContent[THUMBNAIL_PATH]\n                });\n\n              case 60:\n                catalystImage = _context.sent;\n                builtItem.newContent[IMAGE_PATH] = catalystImage.content;\n                builtItem.item.contents[IMAGE_PATH] = catalystImage.hash;\n                return _context.abrupt(\"return\", _objectSpread({\n                  type: ImportedFileType.ACCEPTED\n                }, builtItem, {\n                  fileName: file.name\n                }));\n\n              case 66:\n                _context.prev = 66;\n                _context.t2 = _context[\"catch\"](1);\n                return _context.abrupt(\"return\", {\n                  type: ImportedFileType.REJECTED,\n                  fileName: file.name,\n                  reason: _context.t2.message\n                });\n\n              case 69:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[1, 66]]);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    _this.handleFilesImport = /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(acceptedFiles) {\n        var queue, promisesToProcess, importedFiles;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _this.setState({\n                  view: ItemCreationView.IMPORTING\n                });\n\n                queue = new PQueue({\n                  concurrency: AMOUNT_OF_FILES_TO_PROCESS_SIMULTANEOUSLY\n                });\n                queue.on('next', function () {\n                  _this.setState({\n                    loadingFilesProgress: Math.round((acceptedFiles.length - (queue.size + queue.pending)) * 100 / acceptedFiles.length)\n                  });\n                });\n                promisesToProcess = acceptedFiles.map(function (file) {\n                  return function () {\n                    return _this.processAcceptedFile(file);\n                  };\n                });\n                _context2.next = 6;\n                return queue.addAll(promisesToProcess);\n\n              case 6:\n                importedFiles = _context2.sent;\n\n                _this.setState({\n                  importedFiles: _objectSpread({}, _this.state.importedFiles, importedFiles.reduce(function (accum, file) {\n                    accum[file.fileName] = file;\n                    return accum;\n                  }, {})),\n                  view: ItemCreationView.REVIEW\n                });\n\n              case 8:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      return function (_x2) {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n\n    _this.handleFilesUpload = function () {\n      var _this$props2 = _this.props,\n          collection = _this$props2.collection,\n          onSaveMultipleItems = _this$props2.onSaveMultipleItems;\n\n      var files = _this.getValidFiles();\n\n      onSaveMultipleItems(files);\n\n      _this.setState({\n        view: ItemCreationView.UPLOADING\n      });\n\n      _this.analytics.track(\"\".concat(_this.isCreating() ? 'Create' : 'Edit', \" TP Items\"), {\n        items: files.map(function (file) {\n          return file.item.id;\n        }),\n        collectionId: collection === null || collection === void 0 ? void 0 : collection.id\n      });\n    };\n\n    _this.onRejectedFilesClear = function () {\n      _this.setState({\n        importedFiles: _objectSpread({}, Object.entries(_this.state.importedFiles).filter(function (entry) {\n          return entry[1].type !== ImportedFileType.REJECTED;\n        }).reduce(function (accum, entry) {\n          accum[entry[0]] = entry[1];\n          return accum;\n        }, {}))\n      });\n    };\n\n    _this.renderDropZone = function (props) {\n      var open = props.open,\n          getRootProps = props.getRootProps,\n          getInputProps = props.getInputProps;\n\n      var validFiles = _this.getValidFiles();\n\n      var rejectedFiles = _this.getRejectedFiles();\n\n      return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Modal.Content, {\n        scrolling: true,\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 262,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", Object.assign({}, getRootProps(), {\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 263,\n          columnNumber: 11\n        }\n      }), /*#__PURE__*/React.createElement(\"input\", Object.assign({}, getInputProps(), {\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 264,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 265,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"\".concat(styles.tablesContainer, \" \").concat(styles.itemDropZoneContainer),\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 266,\n          columnNumber: 15\n        }\n      }, rejectedFiles.length > 0 ? /*#__PURE__*/React.createElement(Table, {\n        basic: \"very\",\n        compact: \"very\",\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 268,\n          columnNumber: 19\n        }\n      }, /*#__PURE__*/React.createElement(Table.Header, {\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 269,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(Table.Row, {\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 270,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(Table.HeaderCell, {\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 271,\n          columnNumber: 25\n        }\n      }, t('create_and_edit_multiple_items_modal.invalid_title')), /*#__PURE__*/React.createElement(Table.HeaderCell, {\n        textAlign: \"right\",\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 272,\n          columnNumber: 25\n        }\n      }, /*#__PURE__*/React.createElement(Icon, {\n        className: styles.trashIcon,\n        \"aria-label\": \"clear rejected files\",\n        name: \"trash\",\n        onClick: _this.onRejectedFilesClear,\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 273,\n          columnNumber: 27\n        }\n      })))), /*#__PURE__*/React.createElement(Table.Body, {\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 282,\n          columnNumber: 21\n        }\n      }, rejectedFiles.map(function (_ref3, index) {\n        var fileName = _ref3.fileName,\n            reason = _ref3.reason;\n        return /*#__PURE__*/React.createElement(Table.Row, {\n          key: index,\n          __self: _assertThisInitialized(_assertThisInitialized(_this)),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 285,\n            columnNumber: 27\n          }\n        }, /*#__PURE__*/React.createElement(Table.Cell, {\n          __self: _assertThisInitialized(_assertThisInitialized(_this)),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 286,\n            columnNumber: 29\n          }\n        }, /*#__PURE__*/React.createElement(Icon, {\n          name: \"warning circle\",\n          size: \"small\",\n          color: \"red\",\n          __self: _assertThisInitialized(_assertThisInitialized(_this)),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 287,\n            columnNumber: 31\n          }\n        }), \" \", fileName), /*#__PURE__*/React.createElement(Table.Cell, {\n          textAlign: \"right\",\n          __self: _assertThisInitialized(_assertThisInitialized(_this)),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 289,\n            columnNumber: 29\n          }\n        }, reason));\n      }))) : null, validFiles.length > 0 ? /*#__PURE__*/React.createElement(Table, {\n        basic: \"very\",\n        compact: \"very\",\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 297,\n          columnNumber: 19\n        }\n      }, rejectedFiles.length > 0 ? /*#__PURE__*/React.createElement(Table.Header, {\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 299,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(Table.Row, {\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 300,\n          columnNumber: 25\n        }\n      }, /*#__PURE__*/React.createElement(Table.HeaderCell, {\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 301,\n          columnNumber: 27\n        }\n      }, t('create_and_edit_multiple_items_modal.valid_title')))) : null, /*#__PURE__*/React.createElement(Table.Body, {\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 305,\n          columnNumber: 21\n        }\n      }, validFiles.map(function (_ref4, index) {\n        var fileName = _ref4.fileName;\n        return /*#__PURE__*/React.createElement(Table.Row, {\n          key: index,\n          __self: _assertThisInitialized(_assertThisInitialized(_this)),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 308,\n            columnNumber: 27\n          }\n        }, /*#__PURE__*/React.createElement(Table.Cell, {\n          colSpan: \"2\",\n          __self: _assertThisInitialized(_assertThisInitialized(_this)),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 309,\n            columnNumber: 29\n          }\n        }, fileName));\n      }))) : null)), rejectedFiles.length > 0 ? /*#__PURE__*/React.createElement(\"div\", {\n        className: styles.rejectedFilesInfo,\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 319,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(InfoIcon, {\n        className: styles.infoIcon,\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 320,\n          columnNumber: 17\n        }\n      }), t('create_and_edit_multiple_items_modal.only_valid_items_info')) : null)), /*#__PURE__*/React.createElement(Modal.Actions, {\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 326,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(Button, {\n        secondary: true,\n        onClick: open,\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 327,\n          columnNumber: 11\n        }\n      }, t('create_and_edit_multiple_items_modal.add_more_button')), /*#__PURE__*/React.createElement(Button, {\n        primary: true,\n        disabled: validFiles.length === 0,\n        onClick: _this.handleFilesUpload,\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 330,\n          columnNumber: 11\n        }\n      }, t('create_and_edit_multiple_items_modal.upload_items_button'))));\n    };\n\n    _this.renderReviewTable = function () {\n      var onClose = _this.props.onClose;\n      return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(ModalNavigation, {\n        title: _this.getModalTitle(),\n        subtitle: _this.getModalSubtitle(),\n        onClose: onClose,\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 342,\n          columnNumber: 9\n        }\n      }), /*#__PURE__*/React.createElement(Dropzone, {\n        children: _this.renderDropZone,\n        onDropAccepted: _this.handleFilesImport,\n        onDropRejected: _this.handleRejectedFiles,\n        accept: ['.zip'],\n        noClick: true,\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 343,\n          columnNumber: 9\n        }\n      }));\n    };\n\n    _this.isCreating = function () {\n      var _this$props$metadata$ = _this.props.metadata.type,\n          type = _this$props$metadata$ === void 0 ? CreateOrEditMultipleItemsModalType.CREATE : _this$props$metadata$;\n      return type === CreateOrEditMultipleItemsModalType.CREATE;\n    };\n\n    _this.getOperationTypeKey = function () {\n      return _this.isCreating() ? 'create' : 'edit';\n    };\n\n    _this.getModalTitle = function () {\n      return t(\"create_and_edit_multiple_items_modal.\".concat(_this.getOperationTypeKey(), \".title\"));\n    };\n\n    _this.getModalSubtitle = function () {\n      return _this.isCreating() ? null : t('create_and_edit_multiple_items_modal.edit.subtitle');\n    };\n\n    _this.renderImportView = function () {\n      var onClose = _this.props.onClose;\n      return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(ModalNavigation, {\n        title: _this.getModalTitle(),\n        subtitle: _this.getModalSubtitle(),\n        onClose: onClose,\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 377,\n          columnNumber: 9\n        }\n      }), /*#__PURE__*/React.createElement(Modal.Content, {\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 378,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(ItemImport, {\n        onDropAccepted: _this.handleFilesImport,\n        onDropRejected: _this.handleRejectedFiles,\n        acceptedExtensions: ['.zip'],\n        moreInformation: WEARABLES_ZIP_INFRA_URL ? /*#__PURE__*/React.createElement(\"span\", {\n          __self: _assertThisInitialized(_assertThisInitialized(_this)),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 385,\n            columnNumber: 17\n          }\n        }, /*#__PURE__*/React.createElement(T, {\n          id: \"create_and_edit_multiple_items_modal.import_information\",\n          values: {\n            link: /*#__PURE__*/React.createElement(\"a\", {\n              rel: \"noopener noreferrer\",\n              target: \"_blank\",\n              href: WEARABLES_ZIP_INFRA_URL,\n              __self: _assertThisInitialized(_assertThisInitialized(_this)),\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 390,\n                columnNumber: 25\n              }\n            }, t('create_and_edit_multiple_items_modal.import_information_link_label'))\n          },\n          __self: _assertThisInitialized(_assertThisInitialized(_this)),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 386,\n            columnNumber: 19\n          }\n        })) : undefined,\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 379,\n          columnNumber: 11\n        }\n      })));\n    };\n\n    return _this;\n  }\n\n  _createClass(CreateAndEditMultipleItemsModal, [{\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      var onModalUnmount = this.props.onModalUnmount;\n      onModalUnmount();\n    }\n  }, {\n    key: \"renderProgressBar\",\n    value: function renderProgressBar(progress, label, cancel) {\n      return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(ModalNavigation, {\n        title: this.getModalTitle(),\n        subtitle: this.getModalSubtitle(),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 410,\n          columnNumber: 9\n        }\n      }), /*#__PURE__*/React.createElement(Modal.Content, {\n        className: styles.modalContent,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 411,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: styles.progressBarContainer,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 412,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: styles.progressBarLabel,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 413,\n          columnNumber: 13\n        }\n      }, label), /*#__PURE__*/React.createElement(Progress, {\n        percent: progress,\n        className: styles.progressBar,\n        progress: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 414,\n          columnNumber: 13\n        }\n      }), cancel ? /*#__PURE__*/React.createElement(\"div\", {\n        onClick: cancel,\n        className: styles.progressBarCancel,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 416,\n          columnNumber: 15\n        }\n      }, t('global.cancel')) : null)));\n    }\n  }, {\n    key: \"renderItemsTableSection\",\n    value: function renderItemsTableSection(title, items) {\n      var _this2 = this;\n\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: styles.tablesContainer,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 428,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(Table, {\n        basic: \"very\",\n        compact: \"very\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 429,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(Table.Header, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 430,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(Table.Row, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 431,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(Table.HeaderCell, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 432,\n          columnNumber: 15\n        }\n      }, title))), /*#__PURE__*/React.createElement(Table.Body, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 435,\n          columnNumber: 11\n        }\n      }, items.map(function (item, index) {\n        return /*#__PURE__*/React.createElement(Table.Row, {\n          key: index,\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 437,\n            columnNumber: 15\n          }\n        }, /*#__PURE__*/React.createElement(Table.Cell, {\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 438,\n            columnNumber: 17\n          }\n        }, item));\n      }))));\n    }\n  }, {\n    key: \"renderCompleted\",\n    value: function renderCompleted() {\n      var _this$props3 = this.props,\n          onClose = _this$props3.onClose,\n          savedItemsFiles = _this$props3.savedItemsFiles,\n          notSavedItemsFiles = _this$props3.notSavedItemsFiles,\n          cancelledItemsFiles = _this$props3.cancelledItemsFiles,\n          saveMultipleItemsState = _this$props3.saveMultipleItemsState,\n          error = _this$props3.error;\n      var hasFinishedSuccessfully = saveMultipleItemsState === MultipleItemsSaveState.FINISHED_SUCCESSFULLY;\n      var hasBeenCancelled = saveMultipleItemsState === MultipleItemsSaveState.CANCELLED;\n      var hasFailed = saveMultipleItemsState === MultipleItemsSaveState.FINISHED_UNSUCCESSFULLY;\n      var title;\n\n      if (hasFinishedSuccessfully) {\n        title = t(\"create_and_edit_multiple_items_modal.\".concat(this.getOperationTypeKey(), \".successful_title\"));\n      } else if (hasFailed) {\n        title = t(\"create_and_edit_multiple_items_modal.\".concat(this.getOperationTypeKey(), \".failed_title\"));\n      } else {\n        title = t(\"create_and_edit_multiple_items_modal.\".concat(this.getOperationTypeKey(), \".cancelled_title\"));\n      }\n\n      return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(ModalNavigation, {\n        title: title,\n        onClose: onClose,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 464,\n          columnNumber: 9\n        }\n      }), /*#__PURE__*/React.createElement(Modal.Content, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 465,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"p\", {\n        className: styles.createdItems,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 466,\n          columnNumber: 11\n        }\n      }, !notSavedItemsFiles.length ? t(\"create_and_edit_multiple_items_modal.\".concat(this.getOperationTypeKey(), \".finished_successfully_subtitle\"), {\n        number_of_items: savedItemsFiles.length\n      }) : t(\"create_and_edit_multiple_items_modal.\".concat(this.getOperationTypeKey(), \".finished_partial_successfully_subtitle\"), {\n        number_of_items: savedItemsFiles.length,\n        number_of_failed_items: notSavedItemsFiles.length\n      })), hasFailed ? /*#__PURE__*/React.createElement(Message, {\n        error: true,\n        size: \"tiny\",\n        visible: true,\n        content: error,\n        header: t('global.error_ocurred'),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 476,\n          columnNumber: 24\n        }\n      }) : null, hasBeenCancelled && cancelledItemsFiles.length > 0 ? this.renderItemsTableSection(t('create_and_edit_multiple_items_modal.cancelled_items_table_title'), cancelledItemsFiles) : null, hasBeenCancelled || notSavedItemsFiles.length > 0 ? this.renderItemsTableSection(t('create_and_edit_multiple_items_modal.not_saved_items_table_title'), notSavedItemsFiles) : null, savedItemsFiles.length > 0 ? this.renderItemsTableSection(t(\"create_and_edit_multiple_items_modal.\".concat(this.getOperationTypeKey(), \".saved_items_table_title\")), savedItemsFiles) : null), /*#__PURE__*/React.createElement(Modal.Actions, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 490,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(Button, {\n        primary: true,\n        onClick: onClose,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 491,\n          columnNumber: 11\n        }\n      }, t('create_and_edit_multiple_items_modal.done_button'))));\n    }\n  }, {\n    key: \"renderView\",\n    value: function renderView() {\n      var _this$state = this.state,\n          view = _this$state.view,\n          loadingFilesProgress = _this$state.loadingFilesProgress;\n      var _this$props4 = this.props,\n          onCancelSaveMultipleItems = _this$props4.onCancelSaveMultipleItems,\n          saveItemsProgress = _this$props4.saveItemsProgress;\n      var validFiles = this.getValidFiles();\n\n      switch (view) {\n        case ItemCreationView.IMPORT:\n          return this.renderImportView();\n\n        case ItemCreationView.IMPORTING:\n          return this.renderProgressBar(loadingFilesProgress, t('create_and_edit_multiple_items_modal.importing_files_progress_label'));\n\n        case ItemCreationView.REVIEW:\n          return this.renderReviewTable();\n\n        case ItemCreationView.UPLOADING:\n          return this.renderProgressBar(saveItemsProgress, t('create_and_edit_multiple_items_modal.uploading_items_progress_label', {\n            number_of_items: validFiles.length\n          }), onCancelSaveMultipleItems);\n\n        case ItemCreationView.COMPLETED:\n          return this.renderCompleted();\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$props5 = this.props,\n          name = _this$props5.name,\n          onClose = _this$props5.onClose;\n      return /*#__PURE__*/React.createElement(Modal, {\n        name: name,\n        closeOnEscape: this.isViewClosable(),\n        closeOnDimmerClick: this.isViewClosable(),\n        onClose: onClose,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 526,\n          columnNumber: 7\n        }\n      }, this.renderView());\n    }\n  }], [{\n    key: \"getDerivedStateFromProps\",\n    value: function getDerivedStateFromProps(props, state) {\n      var isCancelled = props.saveMultipleItemsState === MultipleItemsSaveState.CANCELLED;\n      var hasFinished = props.saveMultipleItemsState === MultipleItemsSaveState.FINISHED_SUCCESSFULLY || props.saveMultipleItemsState === MultipleItemsSaveState.FINISHED_UNSUCCESSFULLY;\n\n      if (state.view !== ItemCreationView.COMPLETED && (isCancelled || hasFinished)) {\n        return _objectSpread({}, state, {\n          view: ItemCreationView.COMPLETED\n        });\n      }\n\n      return null;\n    }\n  }]);\n\n  return CreateAndEditMultipleItemsModal;\n}(React.PureComponent);\n\nexport { CreateAndEditMultipleItemsModal as default };","map":{"version":3,"sources":["/opt/work/NZ_test/src/components/Modals/CreateAndEditMultipleItemsModal/CreateAndEditMultipleItemsModal.tsx"],"names":["PQueue","React","uuid","FileTooBigError","ItemFactory","loadFile","MAX_FILE_SIZE","Rarity","THUMBNAIL_PATH","Dropzone","Button","Icon","Message","ModalNavigation","Progress","Table","Modal","getAnalytics","T","t","config","EngineType","getModelData","getExtension","buildThirdPartyURN","decodeURN","URNType","convertImageIntoWearableThumbnail","dataURLToBlob","getImageType","ImageType","MultipleItemsSaveState","IMAGE_PATH","generateCatalystImage","ItemImport","InfoIcon","CreateOrEditMultipleItemsModalType","ImportedFileType","ItemCreationView","styles","WEARABLES_ZIP_INFRA_URL","get","AMOUNT_OF_FILES_TO_PROCESS_SIMULTANEOUSLY","CreateAndEditMultipleItemsModal","analytics","state","view","IMPORT","loadingFilesProgress","importedFiles","isViewClosable","IMPORTING","COMPLETED","getValidFiles","Object","values","filter","file","type","ACCEPTED","getRejectedFiles","REJECTED","handleRejectedFiles","rejectedFiles","setState","reduce","accum","name","fileName","reason","REVIEW","processAcceptedFile","props","collection","metadata","size","arrayBuffer","fileArrayBuffer","Blob","Uint8Array","loadedFile","wearable","Error","itemFactory","fromConfig","content","thumbnail","modelPath","data","representations","mainFile","url","URL","createObjectURL","width","height","extension","undefined","engine","BABYLON","revokeObjectURL","image","thumbnailImageType","PNG","withThumbnail","withRarity","UNIQUE","collectionId","withCollectionId","decodedCollectionUrn","urn","COLLECTIONS_THIRDPARTY","thirdPartyCollectionId","decodedUrn","id","thirdPartyName","thirdPartyTokenId","withUrn","v4","build","builtItem","isCreating","item","_id","itemWithoutId","newContent","catalystImage","contents","hash","message","handleFilesImport","acceptedFiles","queue","concurrency","on","Math","round","length","pending","promisesToProcess","map","addAll","handleFilesUpload","onSaveMultipleItems","files","UPLOADING","track","items","onRejectedFilesClear","entries","entry","renderDropZone","open","getRootProps","getInputProps","validFiles","tablesContainer","itemDropZoneContainer","trashIcon","index","rejectedFilesInfo","infoIcon","renderReviewTable","onClose","getModalTitle","getModalSubtitle","CREATE","getOperationTypeKey","renderImportView","link","onModalUnmount","progress","label","cancel","modalContent","progressBarContainer","progressBarLabel","progressBar","progressBarCancel","title","savedItemsFiles","notSavedItemsFiles","cancelledItemsFiles","saveMultipleItemsState","error","hasFinishedSuccessfully","FINISHED_SUCCESSFULLY","hasBeenCancelled","CANCELLED","hasFailed","FINISHED_UNSUCCESSFULLY","createdItems","number_of_items","number_of_failed_items","renderItemsTableSection","onCancelSaveMultipleItems","saveItemsProgress","renderProgressBar","renderCompleted","renderView","isCancelled","hasFinished","PureComponent"],"mappings":"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","sourcesContent":["import PQueue from 'p-queue'\nimport * as React from 'react'\nimport uuid from 'uuid'\nimport { FileTooBigError, ItemFactory, loadFile, LocalItem, MAX_FILE_SIZE, Rarity, THUMBNAIL_PATH } from '@dcl/builder-client'\nimport Dropzone, { DropzoneState } from 'react-dropzone'\nimport { Button, Icon, Message, ModalNavigation, Progress, Table } from 'decentraland-ui'\nimport Modal from 'decentraland-dapps/dist/containers/Modal'\nimport { getAnalytics } from 'decentraland-dapps/dist/modules/analytics/utils'\nimport { T, t } from 'decentraland-dapps/dist/modules/translation/utils'\nimport { config } from 'config'\nimport { EngineType, getModelData } from 'lib/getModelData'\nimport { getExtension } from 'lib/file'\nimport { buildThirdPartyURN, DecodedURN, decodeURN, URNType } from 'lib/urn'\nimport { convertImageIntoWearableThumbnail, dataURLToBlob, getImageType } from 'modules/media/utils'\nimport { ImageType } from 'modules/media/types'\nimport { MultipleItemsSaveState } from 'modules/ui/createMultipleItems/reducer'\nimport { BuiltFile, IMAGE_PATH } from 'modules/item/types'\nimport { generateCatalystImage } from 'modules/item/utils'\nimport ItemImport from 'components/ItemImport'\nimport { InfoIcon } from 'components/InfoIcon'\nimport {\n  CreateOrEditMultipleItemsModalType,\n  ImportedFile,\n  ImportedFileType,\n  ItemCreationView,\n  Props,\n  RejectedFile,\n  State\n} from './CreateAndEditMultipleItemsModal.types'\nimport styles from './CreateAndEditMultipleItemsModal.module.css'\n\nconst WEARABLES_ZIP_INFRA_URL = config.get('WEARABLES_ZIP_INFRA_URL', '')\nconst AMOUNT_OF_FILES_TO_PROCESS_SIMULTANEOUSLY = 4\n\nexport default class CreateAndEditMultipleItemsModal extends React.PureComponent<Props, State> {\n  analytics = getAnalytics()\n  state = {\n    view: ItemCreationView.IMPORT,\n    loadingFilesProgress: 0,\n    importedFiles: {} as Record<string, ImportedFile<Blob>>\n  }\n\n  private isViewClosable = (): boolean => {\n    const { view } = this.state\n    return view === ItemCreationView.IMPORTING || view === ItemCreationView.COMPLETED\n  }\n\n  private getValidFiles = (): BuiltFile<Blob>[] => {\n    const { importedFiles } = this.state\n    return Object.values(importedFiles).filter(file => file.type === ImportedFileType.ACCEPTED) as BuiltFile<Blob>[]\n  }\n\n  private getRejectedFiles = (): RejectedFile[] => {\n    const { importedFiles } = this.state\n    return Object.values(importedFiles).filter(file => file.type === ImportedFileType.REJECTED) as RejectedFile[]\n  }\n\n  static getDerivedStateFromProps(props: Props, state: State): State | null {\n    const isCancelled = props.saveMultipleItemsState === MultipleItemsSaveState.CANCELLED\n    const hasFinished =\n      props.saveMultipleItemsState === MultipleItemsSaveState.FINISHED_SUCCESSFULLY ||\n      props.saveMultipleItemsState === MultipleItemsSaveState.FINISHED_UNSUCCESSFULLY\n\n    if (state.view !== ItemCreationView.COMPLETED && (isCancelled || hasFinished)) {\n      return { ...state, view: ItemCreationView.COMPLETED }\n    }\n\n    return null\n  }\n\n  componentWillUnmount(): void {\n    const { onModalUnmount } = this.props\n    onModalUnmount()\n  }\n\n  private handleRejectedFiles = (rejectedFiles: File[]): void => {\n    this.setState({\n      importedFiles: {\n        ...this.state.importedFiles,\n        ...rejectedFiles.reduce((accum, file) => {\n          accum[file.name] = {\n            type: ImportedFileType.REJECTED,\n            fileName: file.name,\n            reason: t('create_and_edit_multiple_items_modal.wrong_file_extension')\n          }\n          return accum\n        }, {} as Record<string, ImportedFile<Blob>>)\n      }\n    })\n\n    this.setState({\n      view: ItemCreationView.REVIEW\n    })\n  }\n\n  processAcceptedFile = async (file: File) => {\n    const { collection, metadata } = this.props\n    try {\n      if (file.size > MAX_FILE_SIZE) {\n        throw new FileTooBigError(file.name, file.size)\n      }\n\n      const fileArrayBuffer = await file.arrayBuffer()\n      const loadedFile = await loadFile(file.name, new Blob([new Uint8Array(fileArrayBuffer)]))\n\n      // Multiple files must contain an asset file\n      if (!loadedFile.wearable) {\n        throw new Error(t('create_and_edit_multiple_items_modal.wearable_file_not_found'))\n      }\n\n      const itemFactory = new ItemFactory<Blob>().fromConfig(loadedFile.wearable!, loadedFile.content)\n\n      let thumbnail: Blob | null = loadedFile.content[THUMBNAIL_PATH]\n\n      if (!thumbnail) {\n        const modelPath = loadedFile.wearable.data.representations[0].mainFile\n        const url = URL.createObjectURL(loadedFile.content[modelPath])\n        const data = await getModelData(url, {\n          width: 1024,\n          height: 1024,\n          extension: getExtension(modelPath) || undefined,\n          engine: EngineType.BABYLON\n        })\n        URL.revokeObjectURL(url)\n        thumbnail = await dataURLToBlob(data.image)\n        if (!thumbnail) {\n          throw new Error(t('create_and_edit_multiple_items_modal.thumbnail_file_not_generated'))\n        }\n      } else {\n        const thumbnailImageType = await getImageType(thumbnail)\n        if (thumbnailImageType !== ImageType.PNG) {\n          throw new Error(t('create_and_edit_multiple_items_modal.wrong_thumbnail_format'))\n        }\n      }\n\n      // Process the thumbnail so it fits our requirements\n      thumbnail = dataURLToBlob(await convertImageIntoWearableThumbnail(thumbnail))\n\n      if (!thumbnail) {\n        throw new Error(t('create_and_edit_multiple_items_modal.thumbnail_file_not_generated'))\n      }\n\n      itemFactory.withThumbnail(thumbnail)\n\n      // Set the UNIQUE rarity so all items have this rarity as default although TP items don't require rarity\n      itemFactory.withRarity(Rarity.UNIQUE)\n\n      // Override collection id if specified in the modal's metadata\n      if (metadata.collectionId) {\n        itemFactory.withCollectionId(metadata.collectionId)\n      }\n\n      // Generate or set the correct URN for the items taking into consideration the selected collection\n      let decodedCollectionUrn: DecodedURN<any> | null = collection?.urn ? decodeURN(collection.urn) : null\n\n      if (\n        decodedCollectionUrn &&\n        decodedCollectionUrn.type === URNType.COLLECTIONS_THIRDPARTY &&\n        decodedCollectionUrn.thirdPartyCollectionId\n      ) {\n        const decodedUrn: DecodedURN<any> | null = loadedFile.wearable.id ? decodeURN(loadedFile.wearable.id) : null\n        if (loadedFile.wearable.id && decodedUrn && decodedUrn.type === URNType.COLLECTIONS_THIRDPARTY) {\n          const { thirdPartyName, thirdPartyCollectionId } = decodedUrn\n          if (\n            (thirdPartyCollectionId && thirdPartyCollectionId !== decodedCollectionUrn.thirdPartyCollectionId) ||\n            (thirdPartyName && thirdPartyName !== decodedCollectionUrn.thirdPartyName)\n          ) {\n            throw new Error(t('create_and_edit_multiple_items_modal.invalid_urn'))\n          }\n          if (decodedUrn.thirdPartyTokenId) {\n            itemFactory.withUrn(\n              buildThirdPartyURN(\n                decodedCollectionUrn.thirdPartyName,\n                decodedCollectionUrn.thirdPartyCollectionId,\n                decodedUrn.thirdPartyTokenId\n              )\n            )\n          }\n        } else {\n          itemFactory.withUrn(\n            buildThirdPartyURN(decodedCollectionUrn.thirdPartyName, decodedCollectionUrn.thirdPartyCollectionId, uuid.v4())\n          )\n        }\n      }\n\n      const builtItem = await itemFactory.build()\n      if (!this.isCreating()) {\n        const { id: _id, ...itemWithoutId } = builtItem.item\n        builtItem.item = itemWithoutId as LocalItem\n      }\n\n      // Generate catalyst image as part of the item\n      const catalystImage = await generateCatalystImage(builtItem.item, { thumbnail: builtItem.newContent[THUMBNAIL_PATH] })\n      builtItem.newContent[IMAGE_PATH] = catalystImage.content\n      builtItem.item.contents[IMAGE_PATH] = catalystImage.hash\n\n      return { type: ImportedFileType.ACCEPTED, ...builtItem, fileName: file.name }\n    } catch (error) {\n      return { type: ImportedFileType.REJECTED, fileName: file.name, reason: error.message }\n    }\n  }\n\n  private handleFilesImport = async (acceptedFiles: File[]): Promise<void> => {\n    this.setState({\n      view: ItemCreationView.IMPORTING\n    })\n\n    const queue = new PQueue({ concurrency: AMOUNT_OF_FILES_TO_PROCESS_SIMULTANEOUSLY })\n    queue.on('next', () => {\n      this.setState({\n        loadingFilesProgress: Math.round(((acceptedFiles.length - (queue.size + queue.pending)) * 100) / acceptedFiles.length)\n      })\n    })\n    const promisesToProcess = acceptedFiles.map(file => () => this.processAcceptedFile(file))\n    const importedFiles: ImportedFile<Blob>[] = await queue.addAll(promisesToProcess)\n    this.setState({\n      importedFiles: {\n        ...this.state.importedFiles,\n        ...importedFiles.reduce((accum, file) => {\n          accum[file.fileName] = file\n          return accum\n        }, {} as Record<string, ImportedFile<Blob>>)\n      },\n      view: ItemCreationView.REVIEW\n    })\n  }\n\n  private handleFilesUpload = (): void => {\n    const { collection, onSaveMultipleItems } = this.props\n    const files = this.getValidFiles()\n    onSaveMultipleItems(files)\n    this.setState({\n      view: ItemCreationView.UPLOADING\n    })\n    this.analytics.track(`${this.isCreating() ? 'Create' : 'Edit'} TP Items`, {\n      items: files.map(file => file.item.id),\n      collectionId: collection?.id\n    })\n  }\n\n  private onRejectedFilesClear = (): void => {\n    this.setState({\n      importedFiles: {\n        ...Object.entries(this.state.importedFiles)\n          .filter(entry => entry[1].type !== ImportedFileType.REJECTED)\n          .reduce((accum, entry) => {\n            accum[entry[0]] = entry[1]\n            return accum\n          }, {} as Record<string, ImportedFile<Blob>>)\n      }\n    })\n  }\n\n  private renderDropZone = (props: DropzoneState) => {\n    const { open, getRootProps, getInputProps } = props\n\n    const validFiles = this.getValidFiles()\n    const rejectedFiles = this.getRejectedFiles()\n\n    return (\n      <>\n        <Modal.Content scrolling>\n          <div {...getRootProps()}>\n            <input {...getInputProps()} />\n            <div>\n              <div className={`${styles.tablesContainer} ${styles.itemDropZoneContainer}`}>\n                {rejectedFiles.length > 0 ? (\n                  <Table basic=\"very\" compact=\"very\">\n                    <Table.Header>\n                      <Table.Row>\n                        <Table.HeaderCell>{t('create_and_edit_multiple_items_modal.invalid_title')}</Table.HeaderCell>\n                        <Table.HeaderCell textAlign=\"right\">\n                          <Icon\n                            className={styles.trashIcon}\n                            aria-label=\"clear rejected files\"\n                            name=\"trash\"\n                            onClick={this.onRejectedFilesClear}\n                          />\n                        </Table.HeaderCell>\n                      </Table.Row>\n                    </Table.Header>\n                    <Table.Body>\n                      {rejectedFiles.map(({ fileName, reason }, index) => {\n                        return (\n                          <Table.Row key={index}>\n                            <Table.Cell>\n                              <Icon name=\"warning circle\" size=\"small\" color=\"red\" /> {fileName}\n                            </Table.Cell>\n                            <Table.Cell textAlign=\"right\">{reason}</Table.Cell>\n                          </Table.Row>\n                        )\n                      })}\n                    </Table.Body>\n                  </Table>\n                ) : null}\n                {validFiles.length > 0 ? (\n                  <Table basic=\"very\" compact=\"very\">\n                    {rejectedFiles.length > 0 ? (\n                      <Table.Header>\n                        <Table.Row>\n                          <Table.HeaderCell>{t('create_and_edit_multiple_items_modal.valid_title')}</Table.HeaderCell>\n                        </Table.Row>\n                      </Table.Header>\n                    ) : null}\n                    <Table.Body>\n                      {validFiles.map(({ fileName }, index) => {\n                        return (\n                          <Table.Row key={index}>\n                            <Table.Cell colSpan=\"2\">{fileName}</Table.Cell>\n                          </Table.Row>\n                        )\n                      })}\n                    </Table.Body>\n                  </Table>\n                ) : null}\n              </div>\n            </div>\n            {rejectedFiles.length > 0 ? (\n              <div className={styles.rejectedFilesInfo}>\n                <InfoIcon className={styles.infoIcon} />\n                {t('create_and_edit_multiple_items_modal.only_valid_items_info')}\n              </div>\n            ) : null}\n          </div>\n        </Modal.Content>\n        <Modal.Actions>\n          <Button secondary onClick={open}>\n            {t('create_and_edit_multiple_items_modal.add_more_button')}\n          </Button>\n          <Button primary disabled={validFiles.length === 0} onClick={this.handleFilesUpload}>\n            {t('create_and_edit_multiple_items_modal.upload_items_button')}\n          </Button>\n        </Modal.Actions>\n      </>\n    )\n  }\n\n  private renderReviewTable = () => {\n    const { onClose } = this.props\n    return (\n      <>\n        <ModalNavigation title={this.getModalTitle()} subtitle={this.getModalSubtitle()} onClose={onClose} />\n        <Dropzone\n          children={this.renderDropZone}\n          onDropAccepted={this.handleFilesImport}\n          onDropRejected={this.handleRejectedFiles}\n          accept={['.zip']}\n          noClick\n        />\n      </>\n    )\n  }\n\n  private isCreating = () => {\n    const {\n      metadata: { type = CreateOrEditMultipleItemsModalType.CREATE }\n    } = this.props\n    return type === CreateOrEditMultipleItemsModalType.CREATE\n  }\n\n  private getOperationTypeKey = () => {\n    return this.isCreating() ? 'create' : 'edit'\n  }\n\n  private getModalTitle = () => {\n    return t(`create_and_edit_multiple_items_modal.${this.getOperationTypeKey()}.title`)\n  }\n\n  private getModalSubtitle = () => {\n    return this.isCreating() ? null : t('create_and_edit_multiple_items_modal.edit.subtitle')\n  }\n\n  private renderImportView = () => {\n    const { onClose } = this.props\n    return (\n      <>\n        <ModalNavigation title={this.getModalTitle()} subtitle={this.getModalSubtitle()} onClose={onClose} />\n        <Modal.Content>\n          <ItemImport\n            onDropAccepted={this.handleFilesImport}\n            onDropRejected={this.handleRejectedFiles}\n            acceptedExtensions={['.zip']}\n            moreInformation={\n              WEARABLES_ZIP_INFRA_URL ? (\n                <span>\n                  <T\n                    id=\"create_and_edit_multiple_items_modal.import_information\"\n                    values={{\n                      link: (\n                        <a rel=\"noopener noreferrer\" target=\"_blank\" href={WEARABLES_ZIP_INFRA_URL}>\n                          {t('create_and_edit_multiple_items_modal.import_information_link_label')}\n                        </a>\n                      )\n                    }}\n                  />\n                </span>\n              ) : (\n                undefined\n              )\n            }\n          />\n        </Modal.Content>\n      </>\n    )\n  }\n\n  private renderProgressBar(progress: number, label: string, cancel?: () => void) {\n    return (\n      <>\n        <ModalNavigation title={this.getModalTitle()} subtitle={this.getModalSubtitle()} />\n        <Modal.Content className={styles.modalContent}>\n          <div className={styles.progressBarContainer}>\n            <div className={styles.progressBarLabel}>{label}</div>\n            <Progress percent={progress} className={styles.progressBar} progress />\n            {cancel ? (\n              <div onClick={cancel} className={styles.progressBarCancel}>\n                {t('global.cancel')}\n              </div>\n            ) : null}\n          </div>\n        </Modal.Content>\n      </>\n    )\n  }\n\n  private renderItemsTableSection(title: string, items: string[]) {\n    return (\n      <div className={styles.tablesContainer}>\n        <Table basic=\"very\" compact=\"very\">\n          <Table.Header>\n            <Table.Row>\n              <Table.HeaderCell>{title}</Table.HeaderCell>\n            </Table.Row>\n          </Table.Header>\n          <Table.Body>\n            {items.map((item, index) => (\n              <Table.Row key={index}>\n                <Table.Cell>{item}</Table.Cell>\n              </Table.Row>\n            ))}\n          </Table.Body>\n        </Table>\n      </div>\n    )\n  }\n\n  private renderCompleted() {\n    const { onClose, savedItemsFiles, notSavedItemsFiles, cancelledItemsFiles, saveMultipleItemsState, error } = this.props\n    const hasFinishedSuccessfully = saveMultipleItemsState === MultipleItemsSaveState.FINISHED_SUCCESSFULLY\n    const hasBeenCancelled = saveMultipleItemsState === MultipleItemsSaveState.CANCELLED\n    const hasFailed = saveMultipleItemsState === MultipleItemsSaveState.FINISHED_UNSUCCESSFULLY\n\n    let title: string\n    if (hasFinishedSuccessfully) {\n      title = t(`create_and_edit_multiple_items_modal.${this.getOperationTypeKey()}.successful_title`)\n    } else if (hasFailed) {\n      title = t(`create_and_edit_multiple_items_modal.${this.getOperationTypeKey()}.failed_title`)\n    } else {\n      title = t(`create_and_edit_multiple_items_modal.${this.getOperationTypeKey()}.cancelled_title`)\n    }\n\n    return (\n      <>\n        <ModalNavigation title={title} onClose={onClose} />\n        <Modal.Content>\n          <p className={styles.createdItems}>\n            {!notSavedItemsFiles.length\n              ? t(`create_and_edit_multiple_items_modal.${this.getOperationTypeKey()}.finished_successfully_subtitle`, {\n                  number_of_items: savedItemsFiles.length\n                })\n              : t(`create_and_edit_multiple_items_modal.${this.getOperationTypeKey()}.finished_partial_successfully_subtitle`, {\n                  number_of_items: savedItemsFiles.length,\n                  number_of_failed_items: notSavedItemsFiles.length\n                })}\n          </p>\n          {hasFailed ? <Message error size=\"tiny\" visible content={error} header={t('global.error_ocurred')} /> : null}\n          {hasBeenCancelled && cancelledItemsFiles.length > 0\n            ? this.renderItemsTableSection(t('create_and_edit_multiple_items_modal.cancelled_items_table_title'), cancelledItemsFiles)\n            : null}\n          {hasBeenCancelled || notSavedItemsFiles.length > 0\n            ? this.renderItemsTableSection(t('create_and_edit_multiple_items_modal.not_saved_items_table_title'), notSavedItemsFiles)\n            : null}\n          {savedItemsFiles.length > 0\n            ? this.renderItemsTableSection(\n                t(`create_and_edit_multiple_items_modal.${this.getOperationTypeKey()}.saved_items_table_title`),\n                savedItemsFiles\n              )\n            : null}\n        </Modal.Content>\n        <Modal.Actions>\n          <Button primary onClick={onClose}>\n            {t('create_and_edit_multiple_items_modal.done_button')}\n          </Button>\n        </Modal.Actions>\n      </>\n    )\n  }\n\n  private renderView() {\n    const { view, loadingFilesProgress } = this.state\n    const { onCancelSaveMultipleItems, saveItemsProgress } = this.props\n    const validFiles = this.getValidFiles()\n\n    switch (view) {\n      case ItemCreationView.IMPORT:\n        return this.renderImportView()\n      case ItemCreationView.IMPORTING:\n        return this.renderProgressBar(loadingFilesProgress, t('create_and_edit_multiple_items_modal.importing_files_progress_label'))\n      case ItemCreationView.REVIEW:\n        return this.renderReviewTable()\n      case ItemCreationView.UPLOADING:\n        return this.renderProgressBar(\n          saveItemsProgress,\n          t('create_and_edit_multiple_items_modal.uploading_items_progress_label', { number_of_items: validFiles.length }),\n          onCancelSaveMultipleItems\n        )\n      case ItemCreationView.COMPLETED:\n        return this.renderCompleted()\n    }\n  }\n\n  public render() {\n    const { name, onClose } = this.props\n\n    return (\n      <Modal name={name} closeOnEscape={this.isViewClosable()} closeOnDimmerClick={this.isViewClosable()} onClose={onClose}>\n        {this.renderView()}\n      </Modal>\n    )\n  }\n}\n"]},"metadata":{},"sourceType":"module"}