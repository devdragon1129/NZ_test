{"ast":null,"code":"import _objectSpread from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _classCallCheck from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"/opt/work/NZ_test/src/components/AssetPackEditor/AssetPackEditor.tsx\";\nimport * as React from 'react';\nimport { Field, Header, Button, Icon as SemanticIcon } from 'decentraland-ui';\nimport { getAnalytics } from 'decentraland-dapps/dist/modules/analytics/utils';\nimport { t } from 'decentraland-dapps/dist/modules/translation/utils';\nimport { MAX_TITLE_LENGTH, MAX_THUMBNAIL_SIZE, MIN_TITLE_LENGTH } from 'modules/assetPack/utils';\nimport { isGround } from 'modules/asset/utils';\nimport { isRemoteURL } from 'modules/media/utils';\nimport AssetThumbnail from 'components/AssetThumbnail';\nimport Icon from 'components/Icon';\nimport './AssetPackEditor.css';\n\nvar AssetPackEditor = /*#__PURE__*/function (_React$PureComponent) {\n  _inherits(AssetPackEditor, _React$PureComponent);\n\n  function AssetPackEditor() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, AssetPackEditor);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(AssetPackEditor)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.thumbnailInput = React.createRef();\n    _this.analytics = getAnalytics();\n    _this.state = {\n      errors: {},\n      isDirty: false,\n      isLoading: false\n    };\n\n    _this.getErrors = function (assetPack) {\n      var newErrors = {};\n\n      if (assetPack.title.length > MAX_TITLE_LENGTH) {\n        newErrors.title = t('asset_pack.edit_assetpack.errors.max_title_length', {\n          count: MAX_TITLE_LENGTH\n        });\n      }\n\n      if (assetPack.title.length < MIN_TITLE_LENGTH) {\n        newErrors.title = t('asset_pack.edit_assetpack.errors.min_title_length', {\n          count: MIN_TITLE_LENGTH\n        });\n      }\n\n      var hasErrors = Object.keys(newErrors).length > 0;\n      return hasErrors ? newErrors : {};\n    };\n\n    _this.handleRemove = function (id) {\n      var _this$props = _this.props,\n          assetPack = _this$props.assetPack,\n          onChange = _this$props.onChange;\n\n      _this.analytics.track('Asset Pack Editor Remove Asset', {\n        assetId: id\n      });\n\n      onChange(_objectSpread({}, assetPack, {\n        assets: assetPack.assets.filter(function (asset) {\n          return asset.id !== id;\n        })\n      }));\n    };\n\n    _this.handleOpenFileDialog = function () {\n      if (_this.thumbnailInput.current) {\n        _this.thumbnailInput.current.click();\n      }\n    };\n\n    _this.handleSetDirty = function () {\n      _this.setState({\n        isDirty: true,\n        errors: _this.getErrors(_this.props.assetPack)\n      });\n    };\n\n    _this.handleThumbnail = function (e) {\n      var _this$props2 = _this.props,\n          assetPack = _this$props2.assetPack,\n          onChange = _this$props2.onChange;\n      var files = e.target.files;\n\n      if (files && files.length > 0) {\n        var file = files[0];\n\n        if (file.size > MAX_THUMBNAIL_SIZE) {\n          alert(t('asset_pack.edit_assetpack.errors.thumbnail_size', {\n            count: MAX_THUMBNAIL_SIZE\n          }));\n          return;\n        }\n\n        var url = URL.createObjectURL(file);\n\n        _this.analytics.track('Asset Pack Editor Change Thumbnail');\n\n        onChange(_objectSpread({}, assetPack, {\n          thumbnail: url\n        }));\n      }\n    };\n\n    _this.handleChangeName = function (e) {\n      var _this$props3 = _this.props,\n          assetPack = _this$props3.assetPack,\n          onChange = _this$props3.onChange;\n      var isDirty = _this.state.isDirty;\n      var title = e.target.value;\n\n      var newPack = _objectSpread({}, assetPack, {\n        title: title\n      });\n\n      if (isDirty) {\n        _this.setState({\n          errors: _this.getErrors(newPack)\n        });\n      }\n\n      onChange(newPack);\n    };\n\n    _this.handleSubmit = function () {\n      var errors = _this.getErrors(_this.props.assetPack);\n\n      var hasErrors = Object.keys(errors).length > 0;\n\n      _this.setState({\n        isDirty: true,\n        isLoading: true,\n        errors: errors\n      });\n\n      if (!hasErrors) {\n        _this.props.onSubmit(_this.props.assetPack);\n      }\n    };\n\n    _this.handleAddItems = function () {\n      var onAddItems = _this.props.onAddAssets;\n\n      if (onAddItems) {\n        onAddItems();\n      }\n    };\n\n    _this.handleEditAsset = function (asset) {\n      var onEditAsset = _this.props.onEditAsset;\n\n      if (onEditAsset) {\n        _this.analytics.track('Asset Pack Editor Edit Asset', {\n          asset: asset\n        });\n\n        onEditAsset(asset);\n      }\n    };\n\n    _this.handleDeleteAssetPack = function () {\n      var _this$props4 = _this.props,\n          assetPack = _this$props4.assetPack,\n          onDeleteAssetPack = _this$props4.onDeleteAssetPack;\n\n      if (onDeleteAssetPack) {\n        onDeleteAssetPack(assetPack);\n      }\n    };\n\n    _this.renderAssets = function () {\n      var assetPack = _this.props.assetPack;\n      return assetPack.assets.map(function (asset) {\n        return /*#__PURE__*/React.createElement(AssetThumbnail, {\n          key: asset.id,\n          asset: asset,\n          onRemove: _this.handleRemove,\n          onClick: _this.handleEditAsset,\n          hideLabel: true,\n          __self: _assertThisInitialized(_assertThisInitialized(_this)),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 178,\n            columnNumber: 7\n          }\n        });\n      });\n    };\n\n    _this.renderEmptyState = function () {\n      var onReset = _this.props.onReset;\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"no-items\",\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 185,\n          columnNumber: 7\n        }\n      }, t('asset_pack.edit_assetpack.items.empty'), /*#__PURE__*/React.createElement(Button, {\n        basic: true,\n        onClick: onReset,\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 187,\n          columnNumber: 9\n        }\n      }, t('asset_pack.edit_assetpack.reset')));\n    };\n\n    return _this;\n  }\n\n  _createClass(AssetPackEditor, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this$props5 = this.props,\n          assetPack = _this$props5.assetPack,\n          onChange = _this$props5.onChange;\n\n      if (!assetPack.thumbnail) {\n        var thumb = null;\n\n        if (assetPack.assets.length) {\n          var foundAsset = assetPack.assets.find(function (asset) {\n            return !isGround(asset);\n          });\n\n          if (foundAsset) {\n            thumb = foundAsset.thumbnail;\n          } else {\n            thumb = assetPack.assets[0].thumbnail;\n          }\n        }\n\n        onChange(_objectSpread({}, assetPack, {\n          thumbnail: thumb || ''\n        }));\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$props6 = this.props,\n          assetPack = _this$props6.assetPack,\n          error = _this$props6.error,\n          onAddItems = _this$props6.onAddAssets,\n          onDeleteAssetPack = _this$props6.onDeleteAssetPack;\n      var _this$state = this.state,\n          errors = _this$state.errors,\n          isDirty = _this$state.isDirty,\n          isLoading = _this$state.isLoading;\n      var items = assetPack ? assetPack.assets.length : 0;\n      var hasErrors = Object.keys(errors).length > 0;\n      var isSubmitDisabled = isDirty ? hasErrors || items === 0 : false;\n      var thumbnail = assetPack.thumbnail;\n\n      if (thumbnail && isRemoteURL(thumbnail)) {\n        thumbnail = \"\".concat(assetPack.thumbnail, \"?updated_at=\").concat(assetPack.updatedAt || +Date.now());\n      }\n\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"AssetPackEditor\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 208,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"assetpack\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 209,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"thumbnail\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 210,\n          columnNumber: 11\n        }\n      }, assetPack.thumbnail && /*#__PURE__*/React.createElement(\"img\", {\n        src: thumbnail,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 211,\n          columnNumber: 37\n        }\n      }), /*#__PURE__*/React.createElement(Icon, {\n        name: \"camera\",\n        onClick: this.handleOpenFileDialog,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 212,\n          columnNumber: 13\n        }\n      }), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"file\",\n        ref: this.thumbnailInput,\n        onChange: this.handleThumbnail,\n        accept: \"image/png, image/jpeg\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 213,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(Field, {\n        label: t('asset_pack.edit_assetpack.name.label'),\n        placeholder: t('asset_pack.edit_assetpack.name.placeholder'),\n        onChange: this.handleChangeName,\n        error: hasErrors,\n        message: errors.title,\n        value: assetPack.title,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 215,\n          columnNumber: 11\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"assets\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 225,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"header\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 226,\n          columnNumber: 11\n        }\n      }, items > 0 && /*#__PURE__*/React.createElement(Header, {\n        sub: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 227,\n          columnNumber: 27\n        }\n      }, t('asset_pack.edit_assetpack.items.label', {\n        count: items\n      })), onAddItems && items > 0 && /*#__PURE__*/React.createElement(Button, {\n        basic: true,\n        onClick: this.handleAddItems,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 229,\n          columnNumber: 15\n        }\n      }, t('asset_pack.edit_assetpack.action_add_items'))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"content\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 234,\n          columnNumber: 11\n        }\n      }, assetPack && items > 0 ? this.renderAssets() : this.renderEmptyState())), error ? /*#__PURE__*/React.createElement(\"div\", {\n        className: \"error\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 238,\n          columnNumber: 11\n        }\n      }, t('global.error_ocurred'), \" \\\"\", error, \"\\\"\") : null, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"actions\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 243,\n          columnNumber: 9\n        }\n      }, onDeleteAssetPack && /*#__PURE__*/React.createElement(Button, {\n        primary: true,\n        inverted: true,\n        onClick: this.handleDeleteAssetPack,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 245,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(SemanticIcon, {\n        name: \"trash\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 246,\n          columnNumber: 15\n        }\n      }), t('asset_pack.edit_assetpack.action_delete')), /*#__PURE__*/React.createElement(Button, {\n        className: \"submit\",\n        disabled: isSubmitDisabled || isLoading,\n        onClick: this.handleSubmit,\n        primary: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 250,\n          columnNumber: 11\n        }\n      }, onDeleteAssetPack ? t('asset_pack.edit_assetpack.action_edit') : t('asset_pack.edit_assetpack.action_create'))));\n    }\n  }]);\n\n  return AssetPackEditor;\n}(React.PureComponent);\n\nexport { AssetPackEditor as default };","map":{"version":3,"sources":["/opt/work/NZ_test/src/components/AssetPackEditor/AssetPackEditor.tsx"],"names":["React","Field","Header","Button","Icon","SemanticIcon","getAnalytics","t","MAX_TITLE_LENGTH","MAX_THUMBNAIL_SIZE","MIN_TITLE_LENGTH","isGround","isRemoteURL","AssetThumbnail","AssetPackEditor","thumbnailInput","createRef","analytics","state","errors","isDirty","isLoading","getErrors","assetPack","newErrors","title","length","count","hasErrors","Object","keys","handleRemove","id","props","onChange","track","assetId","assets","filter","asset","handleOpenFileDialog","current","click","handleSetDirty","setState","handleThumbnail","e","files","target","file","size","alert","url","URL","createObjectURL","thumbnail","handleChangeName","value","newPack","handleSubmit","onSubmit","handleAddItems","onAddItems","onAddAssets","handleEditAsset","onEditAsset","handleDeleteAssetPack","onDeleteAssetPack","renderAssets","map","renderEmptyState","onReset","thumb","foundAsset","find","error","items","isSubmitDisabled","updatedAt","Date","now","PureComponent"],"mappings":";;;;;;;;AAAA,OAAO,KAAKA,KAAZ,MAAuB,OAAvB;AACA,SAASC,KAAT,EAAgBC,MAAhB,EAAwBC,MAAxB,EAAgCC,IAAI,IAAIC,YAAxC,QAA4D,iBAA5D;AACA,SAASC,YAAT,QAA6B,iDAA7B;AACA,SAASC,CAAT,QAAkB,mDAAlB;AACA,SAASC,gBAAT,EAA2BC,kBAA3B,EAA+CC,gBAA/C,QAAuE,yBAAvE;AAEA,SAASC,QAAT,QAAyB,qBAAzB;AACA,SAASC,WAAT,QAA4B,qBAA5B;AACA,OAAOC,cAAP,MAA2B,2BAA3B;AACA,OAAOT,IAAP,MAAiB,iBAAjB;AAGA,OAAO,uBAAP;;IAEqBU,e;;;;;;;;;;;;;;;UACnBC,c,GAAiBf,KAAK,CAACgB,SAAN,E;UAEjBC,S,GAAYX,YAAY,E;UAExBY,K,GAAe;AACbC,MAAAA,MAAM,EAAE,EADK;AAEbC,MAAAA,OAAO,EAAE,KAFI;AAGbC,MAAAA,SAAS,EAAE;AAHE,K;;UA4BfC,S,GAAY,UAACC,SAAD,EAAkB;AAC5B,UAAMC,SAAiC,GAAG,EAA1C;;AAEA,UAAID,SAAS,CAACE,KAAV,CAAgBC,MAAhB,GAAyBlB,gBAA7B,EAA+C;AAC7CgB,QAAAA,SAAS,CAACC,KAAV,GAAkBlB,CAAC,CAAC,mDAAD,EAAsD;AACvEoB,UAAAA,KAAK,EAAEnB;AADgE,SAAtD,CAAnB;AAGD;;AAED,UAAIe,SAAS,CAACE,KAAV,CAAgBC,MAAhB,GAAyBhB,gBAA7B,EAA+C;AAC7Cc,QAAAA,SAAS,CAACC,KAAV,GAAkBlB,CAAC,CAAC,mDAAD,EAAsD;AACvEoB,UAAAA,KAAK,EAAEjB;AADgE,SAAtD,CAAnB;AAGD;;AAED,UAAMkB,SAAS,GAAGC,MAAM,CAACC,IAAP,CAAYN,SAAZ,EAAuBE,MAAvB,GAAgC,CAAlD;AAEA,aAAOE,SAAS,GAAGJ,SAAH,GAAe,EAA/B;AACD,K;;UAEDO,Y,GAAe,UAACC,EAAD,EAAgB;AAAA,wBACG,MAAKC,KADR;AAAA,UACrBV,SADqB,eACrBA,SADqB;AAAA,UACVW,QADU,eACVA,QADU;;AAG7B,YAAKjB,SAAL,CAAekB,KAAf,CAAqB,gCAArB,EAAuD;AACrDC,QAAAA,OAAO,EAAEJ;AAD4C,OAAvD;;AAIAE,MAAAA,QAAQ,mBACHX,SADG;AAENc,QAAAA,MAAM,EAAEd,SAAS,CAACc,MAAV,CAAiBC,MAAjB,CAAwB,UAAAC,KAAK;AAAA,iBAAIA,KAAK,CAACP,EAAN,KAAaA,EAAjB;AAAA,SAA7B;AAFF,SAAR;AAID,K;;UAEDQ,oB,GAAuB,YAAM;AAC3B,UAAI,MAAKzB,cAAL,CAAoB0B,OAAxB,EAAiC;AAC/B,cAAK1B,cAAL,CAAoB0B,OAApB,CAA4BC,KAA5B;AACD;AACF,K;;UAEDC,c,GAAiB,YAAM;AACrB,YAAKC,QAAL,CAAc;AACZxB,QAAAA,OAAO,EAAE,IADG;AAEZD,QAAAA,MAAM,EAAE,MAAKG,SAAL,CAAe,MAAKW,KAAL,CAAWV,SAA1B;AAFI,OAAd;AAID,K;;UAEDsB,e,GAAkB,UAACC,CAAD,EAA4C;AAAA,yBAC5B,MAAKb,KADuB;AAAA,UACpDV,SADoD,gBACpDA,SADoD;AAAA,UACzCW,QADyC,gBACzCA,QADyC;AAAA,UAEpDa,KAFoD,GAE1CD,CAAC,CAACE,MAFwC,CAEpDD,KAFoD;;AAI5D,UAAIA,KAAK,IAAIA,KAAK,CAACrB,MAAN,GAAe,CAA5B,EAA+B;AAC7B,YAAMuB,IAAI,GAAGF,KAAK,CAAC,CAAD,CAAlB;;AACA,YAAIE,IAAI,CAACC,IAAL,GAAYzC,kBAAhB,EAAoC;AAClC0C,UAAAA,KAAK,CACH5C,CAAC,CAAC,iDAAD,EAAoD;AACnDoB,YAAAA,KAAK,EAAElB;AAD4C,WAApD,CADE,CAAL;AAKA;AACD;;AACD,YAAM2C,GAAG,GAAGC,GAAG,CAACC,eAAJ,CAAoBL,IAApB,CAAZ;;AAEA,cAAKhC,SAAL,CAAekB,KAAf,CAAqB,oCAArB;;AAEAD,QAAAA,QAAQ,mBACHX,SADG;AAENgC,UAAAA,SAAS,EAAEH;AAFL,WAAR;AAID;AACF,K;;UAEDI,gB,GAAmB,UAACV,CAAD,EAA4C;AAAA,yBAC7B,MAAKb,KADwB;AAAA,UACrDV,SADqD,gBACrDA,SADqD;AAAA,UAC1CW,QAD0C,gBAC1CA,QAD0C;AAAA,UAErDd,OAFqD,GAEzC,MAAKF,KAFoC,CAErDE,OAFqD;AAI7D,UAAMK,KAAK,GAAGqB,CAAC,CAACE,MAAF,CAASS,KAAvB;;AACA,UAAMC,OAAO,qBAAQnC,SAAR;AAAmBE,QAAAA,KAAK,EAALA;AAAnB,QAAb;;AAEA,UAAIL,OAAJ,EAAa;AACX,cAAKwB,QAAL,CAAc;AACZzB,UAAAA,MAAM,EAAE,MAAKG,SAAL,CAAeoC,OAAf;AADI,SAAd;AAGD;;AAEDxB,MAAAA,QAAQ,CAACwB,OAAD,CAAR;AACD,K;;UAEDC,Y,GAAe,YAAM;AACnB,UAAMxC,MAAM,GAAG,MAAKG,SAAL,CAAe,MAAKW,KAAL,CAAWV,SAA1B,CAAf;;AACA,UAAMK,SAAS,GAAGC,MAAM,CAACC,IAAP,CAAYX,MAAZ,EAAoBO,MAApB,GAA6B,CAA/C;;AAEA,YAAKkB,QAAL,CAAc;AACZxB,QAAAA,OAAO,EAAE,IADG;AAEZC,QAAAA,SAAS,EAAE,IAFC;AAGZF,QAAAA,MAAM,EAANA;AAHY,OAAd;;AAMA,UAAI,CAACS,SAAL,EAAgB;AACd,cAAKK,KAAL,CAAW2B,QAAX,CAAoB,MAAK3B,KAAL,CAAWV,SAA/B;AACD;AACF,K;;UAEDsC,c,GAAiB,YAAM;AAAA,UACAC,UADA,GACe,MAAK7B,KADpB,CACb8B,WADa;;AAErB,UAAID,UAAJ,EAAgB;AACdA,QAAAA,UAAU;AACX;AACF,K;;UAEDE,e,GAAkB,UAACzB,KAAD,EAAgC;AAAA,UACxC0B,WADwC,GACxB,MAAKhC,KADmB,CACxCgC,WADwC;;AAEhD,UAAIA,WAAJ,EAAiB;AACf,cAAKhD,SAAL,CAAekB,KAAf,CAAqB,8BAArB,EAAqD;AACnDI,UAAAA,KAAK,EAALA;AADmD,SAArD;;AAGA0B,QAAAA,WAAW,CAAC1B,KAAD,CAAX;AACD;AACF,K;;UAED2B,qB,GAAwB,YAAM;AAAA,yBACa,MAAKjC,KADlB;AAAA,UACpBV,SADoB,gBACpBA,SADoB;AAAA,UACT4C,iBADS,gBACTA,iBADS;;AAG5B,UAAIA,iBAAJ,EAAuB;AACrBA,QAAAA,iBAAiB,CAAC5C,SAAD,CAAjB;AACD;AACF,K;;UAED6C,Y,GAAe,YAAM;AAAA,UACX7C,SADW,GACG,MAAKU,KADR,CACXV,SADW;AAEnB,aAAOA,SAAS,CAACc,MAAV,CAAiBgC,GAAjB,CAAqB,UAAA9B,KAAK;AAAA,4BAC/B,oBAAC,cAAD;AAAgB,UAAA,GAAG,EAAEA,KAAK,CAACP,EAA3B;AAA+B,UAAA,KAAK,EAAEO,KAAtC;AAA6C,UAAA,QAAQ,EAAE,MAAKR,YAA5D;AAA0E,UAAA,OAAO,EAAE,MAAKiC,eAAxF;AAAyG,UAAA,SAAS,MAAlH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAD+B;AAAA,OAA1B,CAAP;AAGD,K;;UAEDM,gB,GAAmB,YAAM;AAAA,UACfC,OADe,GACH,MAAKtC,KADF,CACfsC,OADe;AAEvB,0BACE;AAAK,QAAA,SAAS,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACGhE,CAAC,CAAC,uCAAD,CADJ,eAEE,oBAAC,MAAD;AAAQ,QAAA,KAAK,MAAb;AAAc,QAAA,OAAO,EAAEgE,OAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACGhE,CAAC,CAAC,iCAAD,CADJ,CAFF,CADF;AAQD,K;;;;;;;wCAtKmB;AAAA,yBACc,KAAK0B,KADnB;AAAA,UACVV,SADU,gBACVA,SADU;AAAA,UACCW,QADD,gBACCA,QADD;;AAGlB,UAAI,CAACX,SAAS,CAACgC,SAAf,EAA0B;AACxB,YAAIiB,KAAoB,GAAG,IAA3B;;AAEA,YAAIjD,SAAS,CAACc,MAAV,CAAiBX,MAArB,EAA6B;AAC3B,cAAM+C,UAAU,GAAGlD,SAAS,CAACc,MAAV,CAAiBqC,IAAjB,CAAsB,UAAAnC,KAAK;AAAA,mBAAI,CAAC5B,QAAQ,CAAC4B,KAAD,CAAb;AAAA,WAA3B,CAAnB;;AACA,cAAIkC,UAAJ,EAAgB;AACdD,YAAAA,KAAK,GAAGC,UAAU,CAAClB,SAAnB;AACD,WAFD,MAEO;AACLiB,YAAAA,KAAK,GAAGjD,SAAS,CAACc,MAAV,CAAiB,CAAjB,EAAoBkB,SAA5B;AACD;AACF;;AAEDrB,QAAAA,QAAQ,mBACHX,SADG;AAENgC,UAAAA,SAAS,EAAEiB,KAAK,IAAI;AAFd,WAAR;AAID;AACF;;;6BAoJQ;AAAA,yBACkE,KAAKvC,KADvE;AAAA,UACCV,SADD,gBACCA,SADD;AAAA,UACYoD,KADZ,gBACYA,KADZ;AAAA,UACgCb,UADhC,gBACmBC,WADnB;AAAA,UAC4CI,iBAD5C,gBAC4CA,iBAD5C;AAAA,wBAEgC,KAAKjD,KAFrC;AAAA,UAECC,MAFD,eAECA,MAFD;AAAA,UAESC,OAFT,eAESA,OAFT;AAAA,UAEkBC,SAFlB,eAEkBA,SAFlB;AAGP,UAAMuD,KAAK,GAAGrD,SAAS,GAAGA,SAAS,CAACc,MAAV,CAAiBX,MAApB,GAA6B,CAApD;AACA,UAAME,SAAS,GAAGC,MAAM,CAACC,IAAP,CAAYX,MAAZ,EAAoBO,MAApB,GAA6B,CAA/C;AACA,UAAMmD,gBAAgB,GAAGzD,OAAO,GAAGQ,SAAS,IAAIgD,KAAK,KAAK,CAA1B,GAA8B,KAA9D;AAEA,UAAIrB,SAAS,GAAGhC,SAAS,CAACgC,SAA1B;;AAEA,UAAIA,SAAS,IAAI3C,WAAW,CAAC2C,SAAD,CAA5B,EAAyC;AACvCA,QAAAA,SAAS,aAAMhC,SAAS,CAACgC,SAAhB,yBAAwChC,SAAS,CAACuD,SAAV,IAAuB,CAACC,IAAI,CAACC,GAAL,EAAhE,CAAT;AACD;;AAED,0BACE;AAAK,QAAA,SAAS,EAAC,iBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAK,QAAA,SAAS,EAAC,WAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAK,QAAA,SAAS,EAAC,WAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACGzD,SAAS,CAACgC,SAAV,iBAAuB;AAAK,QAAA,GAAG,EAAEA,SAAV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAD1B,eAEE,oBAAC,IAAD;AAAM,QAAA,IAAI,EAAC,QAAX;AAAoB,QAAA,OAAO,EAAE,KAAKf,oBAAlC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAFF,eAGE;AAAO,QAAA,IAAI,EAAC,MAAZ;AAAmB,QAAA,GAAG,EAAE,KAAKzB,cAA7B;AAA6C,QAAA,QAAQ,EAAE,KAAK8B,eAA5D;AAA6E,QAAA,MAAM,EAAC,uBAApF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAHF,CADF,eAME,oBAAC,KAAD;AACE,QAAA,KAAK,EAAEtC,CAAC,CAAC,sCAAD,CADV;AAEE,QAAA,WAAW,EAAEA,CAAC,CAAC,4CAAD,CAFhB;AAGE,QAAA,QAAQ,EAAE,KAAKiD,gBAHjB;AAIE,QAAA,KAAK,EAAE5B,SAJT;AAKE,QAAA,OAAO,EAAET,MAAM,CAACM,KALlB;AAME,QAAA,KAAK,EAAEF,SAAS,CAACE,KANnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QANF,CADF,eAiBE;AAAK,QAAA,SAAS,EAAC,QAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAK,QAAA,SAAS,EAAC,QAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACGmD,KAAK,GAAG,CAAR,iBAAa,oBAAC,MAAD;AAAQ,QAAA,GAAG,MAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAarE,CAAC,CAAC,uCAAD,EAA0C;AAAEoB,QAAAA,KAAK,EAAEiD;AAAT,OAA1C,CAAd,CADhB,EAEGd,UAAU,IAAIc,KAAK,GAAG,CAAtB,iBACC,oBAAC,MAAD;AAAQ,QAAA,KAAK,MAAb;AAAc,QAAA,OAAO,EAAE,KAAKf,cAA5B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACGtD,CAAC,CAAC,4CAAD,CADJ,CAHJ,CADF,eASE;AAAK,QAAA,SAAS,EAAC,SAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAA0BgB,SAAS,IAAIqD,KAAK,GAAG,CAArB,GAAyB,KAAKR,YAAL,EAAzB,GAA+C,KAAKE,gBAAL,EAAzE,CATF,CAjBF,EA6BGK,KAAK,gBACJ;AAAK,QAAA,SAAS,EAAC,OAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACGpE,CAAC,CAAC,sBAAD,CADJ,SACgCoE,KADhC,OADI,GAIF,IAjCN,eAmCE;AAAK,QAAA,SAAS,EAAC,SAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACGR,iBAAiB,iBAChB,oBAAC,MAAD;AAAQ,QAAA,OAAO,MAAf;AAAgB,QAAA,QAAQ,MAAxB;AAAyB,QAAA,OAAO,EAAE,KAAKD,qBAAvC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE,oBAAC,YAAD;AAAc,QAAA,IAAI,EAAC,OAAnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF,EAEG3D,CAAC,CAAC,yCAAD,CAFJ,CAFJ,eAOE,oBAAC,MAAD;AAAQ,QAAA,SAAS,EAAC,QAAlB;AAA2B,QAAA,QAAQ,EAAEsE,gBAAgB,IAAIxD,SAAzD;AAAoE,QAAA,OAAO,EAAE,KAAKsC,YAAlF;AAAgG,QAAA,OAAO,MAAvG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACGQ,iBAAiB,GAAG5D,CAAC,CAAC,uCAAD,CAAJ,GAAgDA,CAAC,CAAC,yCAAD,CADrE,CAPF,CAnCF,CADF;AAiDD;;;;EAjPmFP,KAAK,CAACiF,a;;SAAvEnE,e","sourcesContent":["import * as React from 'react'\nimport { Field, Header, Button, Icon as SemanticIcon } from 'decentraland-ui'\nimport { getAnalytics } from 'decentraland-dapps/dist/modules/analytics/utils'\nimport { t } from 'decentraland-dapps/dist/modules/translation/utils'\nimport { MAX_TITLE_LENGTH, MAX_THUMBNAIL_SIZE, MIN_TITLE_LENGTH } from 'modules/assetPack/utils'\nimport { RawAssetPack, MixedAssetPack } from 'modules/assetPack/types'\nimport { isGround } from 'modules/asset/utils'\nimport { isRemoteURL } from 'modules/media/utils'\nimport AssetThumbnail from 'components/AssetThumbnail'\nimport Icon from 'components/Icon'\n\nimport { Props, State } from './AssetPackEditor.types'\nimport './AssetPackEditor.css'\n\nexport default class AssetPackEditor<T extends MixedAssetPack = RawAssetPack> extends React.PureComponent<Props<T>, State> {\n  thumbnailInput = React.createRef<HTMLInputElement>()\n\n  analytics = getAnalytics()\n\n  state: State = {\n    errors: {},\n    isDirty: false,\n    isLoading: false\n  }\n\n  componentDidMount() {\n    const { assetPack, onChange } = this.props\n\n    if (!assetPack.thumbnail) {\n      let thumb: string | null = null\n\n      if (assetPack.assets.length) {\n        const foundAsset = assetPack.assets.find(asset => !isGround(asset))\n        if (foundAsset) {\n          thumb = foundAsset.thumbnail\n        } else {\n          thumb = assetPack.assets[0].thumbnail\n        }\n      }\n\n      onChange({\n        ...assetPack,\n        thumbnail: thumb || ''\n      })\n    }\n  }\n\n  getErrors = (assetPack: T) => {\n    const newErrors: Record<string, string> = {}\n\n    if (assetPack.title.length > MAX_TITLE_LENGTH) {\n      newErrors.title = t('asset_pack.edit_assetpack.errors.max_title_length', {\n        count: MAX_TITLE_LENGTH\n      })\n    }\n\n    if (assetPack.title.length < MIN_TITLE_LENGTH) {\n      newErrors.title = t('asset_pack.edit_assetpack.errors.min_title_length', {\n        count: MIN_TITLE_LENGTH\n      })\n    }\n\n    const hasErrors = Object.keys(newErrors).length > 0\n\n    return hasErrors ? newErrors : {}\n  }\n\n  handleRemove = (id: string) => {\n    const { assetPack, onChange } = this.props\n\n    this.analytics.track('Asset Pack Editor Remove Asset', {\n      assetId: id\n    })\n\n    onChange({\n      ...assetPack,\n      assets: assetPack.assets.filter(asset => asset.id !== id)\n    })\n  }\n\n  handleOpenFileDialog = () => {\n    if (this.thumbnailInput.current) {\n      this.thumbnailInput.current.click()\n    }\n  }\n\n  handleSetDirty = () => {\n    this.setState({\n      isDirty: true,\n      errors: this.getErrors(this.props.assetPack)\n    })\n  }\n\n  handleThumbnail = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const { assetPack, onChange } = this.props\n    const { files } = e.target\n\n    if (files && files.length > 0) {\n      const file = files[0]\n      if (file.size > MAX_THUMBNAIL_SIZE) {\n        alert(\n          t('asset_pack.edit_assetpack.errors.thumbnail_size', {\n            count: MAX_THUMBNAIL_SIZE\n          })\n        )\n        return\n      }\n      const url = URL.createObjectURL(file)\n\n      this.analytics.track('Asset Pack Editor Change Thumbnail')\n\n      onChange({\n        ...assetPack,\n        thumbnail: url\n      })\n    }\n  }\n\n  handleChangeName = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const { assetPack, onChange } = this.props\n    const { isDirty } = this.state\n\n    const title = e.target.value\n    const newPack = { ...assetPack, title }\n\n    if (isDirty) {\n      this.setState({\n        errors: this.getErrors(newPack)\n      })\n    }\n\n    onChange(newPack)\n  }\n\n  handleSubmit = () => {\n    const errors = this.getErrors(this.props.assetPack)\n    const hasErrors = Object.keys(errors).length > 0\n\n    this.setState({\n      isDirty: true,\n      isLoading: true,\n      errors\n    })\n\n    if (!hasErrors) {\n      this.props.onSubmit(this.props.assetPack)\n    }\n  }\n\n  handleAddItems = () => {\n    const { onAddAssets: onAddItems } = this.props\n    if (onAddItems) {\n      onAddItems()\n    }\n  }\n\n  handleEditAsset = (asset: T['assets'][number]) => {\n    const { onEditAsset } = this.props\n    if (onEditAsset) {\n      this.analytics.track('Asset Pack Editor Edit Asset', {\n        asset\n      })\n      onEditAsset(asset)\n    }\n  }\n\n  handleDeleteAssetPack = () => {\n    const { assetPack, onDeleteAssetPack } = this.props\n\n    if (onDeleteAssetPack) {\n      onDeleteAssetPack(assetPack)\n    }\n  }\n\n  renderAssets = () => {\n    const { assetPack } = this.props\n    return assetPack.assets.map(asset => (\n      <AssetThumbnail key={asset.id} asset={asset} onRemove={this.handleRemove} onClick={this.handleEditAsset} hideLabel />\n    ))\n  }\n\n  renderEmptyState = () => {\n    const { onReset } = this.props\n    return (\n      <div className=\"no-items\">\n        {t('asset_pack.edit_assetpack.items.empty')}\n        <Button basic onClick={onReset}>\n          {t('asset_pack.edit_assetpack.reset')}\n        </Button>\n      </div>\n    )\n  }\n\n  render() {\n    const { assetPack, error, onAddAssets: onAddItems, onDeleteAssetPack } = this.props\n    const { errors, isDirty, isLoading } = this.state\n    const items = assetPack ? assetPack.assets.length : 0\n    const hasErrors = Object.keys(errors).length > 0\n    const isSubmitDisabled = isDirty ? hasErrors || items === 0 : false\n\n    let thumbnail = assetPack.thumbnail\n\n    if (thumbnail && isRemoteURL(thumbnail)) {\n      thumbnail = `${assetPack.thumbnail}?updated_at=${assetPack.updatedAt || +Date.now()}`\n    }\n\n    return (\n      <div className=\"AssetPackEditor\">\n        <div className=\"assetpack\">\n          <div className=\"thumbnail\">\n            {assetPack.thumbnail && <img src={thumbnail} />}\n            <Icon name=\"camera\" onClick={this.handleOpenFileDialog} />\n            <input type=\"file\" ref={this.thumbnailInput} onChange={this.handleThumbnail} accept=\"image/png, image/jpeg\" />\n          </div>\n          <Field\n            label={t('asset_pack.edit_assetpack.name.label')}\n            placeholder={t('asset_pack.edit_assetpack.name.placeholder')}\n            onChange={this.handleChangeName}\n            error={hasErrors}\n            message={errors.title}\n            value={assetPack.title}\n          />\n        </div>\n\n        <div className=\"assets\">\n          <div className=\"header\">\n            {items > 0 && <Header sub>{t('asset_pack.edit_assetpack.items.label', { count: items })}</Header>}\n            {onAddItems && items > 0 && (\n              <Button basic onClick={this.handleAddItems}>\n                {t('asset_pack.edit_assetpack.action_add_items')}\n              </Button>\n            )}\n          </div>\n          <div className=\"content\">{assetPack && items > 0 ? this.renderAssets() : this.renderEmptyState()}</div>\n        </div>\n\n        {error ? (\n          <div className=\"error\">\n            {t('global.error_ocurred')} \"{error}\"\n          </div>\n        ) : null}\n\n        <div className=\"actions\">\n          {onDeleteAssetPack && (\n            <Button primary inverted onClick={this.handleDeleteAssetPack}>\n              <SemanticIcon name=\"trash\" />\n              {t('asset_pack.edit_assetpack.action_delete')}\n            </Button>\n          )}\n          <Button className=\"submit\" disabled={isSubmitDisabled || isLoading} onClick={this.handleSubmit} primary>\n            {onDeleteAssetPack ? t('asset_pack.edit_assetpack.action_edit') : t('asset_pack.edit_assetpack.action_create')}\n          </Button>\n        </div>\n      </div>\n    )\n  }\n}\n"]},"metadata":{},"sourceType":"module"}