{"ast":null,"code":"\"use strict\";\n\nvar _taggedTemplateLiteral = require(\"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/taggedTemplateLiteral\");\n\nvar _templateObject, _templateObject2, _templateObject3, _templateObject4, _templateObject5, _templateObject6, _templateObject7, _templateObject8, _templateObject9, _templateObject10;\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.keywordCode = void 0;\n\nvar context_1 = require(\"../context\");\n\nvar errors_1 = require(\"../errors\");\n\nvar code_1 = require(\"../../vocabularies/code\");\n\nvar codegen_1 = require(\"../codegen\");\n\nvar names_1 = require(\"../names\");\n\nfunction keywordCode(it, keyword, def, ruleType) {\n  var cxt = new context_1.default(it, def, keyword);\n\n  if (\"code\" in def) {\n    def.code(cxt, ruleType);\n  } else if (cxt.$data && def.validate) {\n    funcKeywordCode(cxt, def);\n  } else if (\"macro\" in def) {\n    macroKeywordCode(cxt, def);\n  } else if (def.compile || def.validate) {\n    funcKeywordCode(cxt, def);\n  }\n}\n\nexports.keywordCode = keywordCode;\n\nfunction macroKeywordCode(cxt, def) {\n  var gen = cxt.gen,\n      keyword = cxt.keyword,\n      schema = cxt.schema,\n      parentSchema = cxt.parentSchema,\n      it = cxt.it;\n  var macroSchema = def.macro.call(it.self, schema, parentSchema, it);\n  var schemaRef = useKeyword(gen, keyword, macroSchema);\n  if (it.opts.validateSchema !== false) it.self.validateSchema(macroSchema, true);\n  var valid = gen.name(\"valid\");\n  cxt.subschema({\n    schema: macroSchema,\n    schemaPath: codegen_1.nil,\n    errSchemaPath: \"\".concat(it.errSchemaPath, \"/\").concat(keyword),\n    topSchemaRef: schemaRef,\n    compositeRule: true\n  }, valid);\n  cxt.pass(valid, function () {\n    return cxt.error(true);\n  });\n}\n\nfunction funcKeywordCode(cxt, def) {\n  var _a;\n\n  var gen = cxt.gen,\n      keyword = cxt.keyword,\n      schema = cxt.schema,\n      parentSchema = cxt.parentSchema,\n      $data = cxt.$data,\n      it = cxt.it;\n  checkAsync(it, def);\n  var validate = !$data && def.compile ? def.compile.call(it.self, schema, parentSchema, it) : def.validate;\n  var validateRef = useKeyword(gen, keyword, validate);\n  var valid = gen.let(\"valid\");\n  cxt.block$data(valid, validateKeyword);\n  cxt.ok((_a = def.valid) !== null && _a !== void 0 ? _a : valid);\n\n  function validateKeyword() {\n    if (def.errors === false) {\n      assignValid();\n      if (def.modifying) modifyData(cxt);\n      reportErrs(function () {\n        return cxt.error();\n      });\n    } else {\n      var ruleErrs = def.async ? validateAsync() : validateSync();\n      if (def.modifying) modifyData(cxt);\n      reportErrs(function () {\n        return addErrs(cxt, ruleErrs);\n      });\n    }\n  }\n\n  function validateAsync() {\n    var ruleErrs = gen.let(\"ruleErrs\", null);\n    gen.try(function () {\n      return assignValid(codegen_1._(_templateObject || (_templateObject = _taggedTemplateLiteral([\"await \"]))));\n    }, function (e) {\n      return gen.assign(valid, false).if(codegen_1._(_templateObject2 || (_templateObject2 = _taggedTemplateLiteral([\"\", \" instanceof \", \"\"])), e, it.ValidationError), function () {\n        return gen.assign(ruleErrs, codegen_1._(_templateObject3 || (_templateObject3 = _taggedTemplateLiteral([\"\", \".errors\"])), e));\n      }, function () {\n        return gen.throw(e);\n      });\n    });\n    return ruleErrs;\n  }\n\n  function validateSync() {\n    var validateErrs = codegen_1._(_templateObject4 || (_templateObject4 = _taggedTemplateLiteral([\"\", \".errors\"])), validateRef);\n\n    gen.assign(validateErrs, null);\n    assignValid(codegen_1.nil);\n    return validateErrs;\n  }\n\n  function assignValid() {\n    var _await = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : def.async ? codegen_1._(_templateObject5 || (_templateObject5 = _taggedTemplateLiteral([\"await \"]))) : codegen_1.nil;\n\n    var passCxt = it.opts.passContext ? names_1.default.this : names_1.default.self;\n    var passSchema = !(\"compile\" in def && !$data || def.schema === false);\n    gen.assign(valid, codegen_1._(_templateObject6 || (_templateObject6 = _taggedTemplateLiteral([\"\", \"\", \"\"])), _await, code_1.callValidateCode(cxt, validateRef, passCxt, passSchema)), def.modifying);\n  }\n\n  function reportErrs(errors) {\n    var _a;\n\n    gen.if(codegen_1.not((_a = def.valid) !== null && _a !== void 0 ? _a : valid), errors);\n  }\n}\n\nfunction modifyData(cxt) {\n  var gen = cxt.gen,\n      data = cxt.data,\n      it = cxt.it;\n  gen.if(it.parentData, function () {\n    return gen.assign(data, codegen_1._(_templateObject7 || (_templateObject7 = _taggedTemplateLiteral([\"\", \"[\", \"]\"])), it.parentData, it.parentDataProperty));\n  });\n}\n\nfunction addErrs(cxt, errs) {\n  var gen = cxt.gen;\n  gen.if(codegen_1._(_templateObject8 || (_templateObject8 = _taggedTemplateLiteral([\"Array.isArray(\", \")\"])), errs), function () {\n    gen.assign(names_1.default.vErrors, codegen_1._(_templateObject9 || (_templateObject9 = _taggedTemplateLiteral([\"\", \" === null ? \", \" : \", \".concat(\", \")\"])), names_1.default.vErrors, errs, names_1.default.vErrors, errs)).assign(names_1.default.errors, codegen_1._(_templateObject10 || (_templateObject10 = _taggedTemplateLiteral([\"\", \".length\"])), names_1.default.vErrors));\n    errors_1.extendErrors(cxt);\n  }, function () {\n    return cxt.error();\n  });\n}\n\nfunction checkAsync(_ref, def) {\n  var schemaEnv = _ref.schemaEnv;\n  if (def.async && !schemaEnv.$async) throw new Error(\"async keyword in sync schema\");\n}\n\nfunction useKeyword(gen, keyword, result) {\n  if (result === undefined) throw new Error(\"keyword \\\"\".concat(keyword, \"\\\" failed to compile\"));\n  return gen.scopeValue(\"keyword\", typeof result == \"function\" ? {\n    ref: result\n  } : {\n    ref: result,\n    code: codegen_1.stringify(result)\n  });\n}","map":null,"metadata":{},"sourceType":"script"}