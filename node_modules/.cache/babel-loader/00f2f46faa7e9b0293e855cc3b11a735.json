{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n    desc = {\n      enumerable: true,\n      get: function get() {\n        return m[k];\n      }\n    };\n  }\n\n  Object.defineProperty(o, k2, desc);\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) {\n    if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  }\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) {\n    if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  }\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.WearablePreview = void 0;\n/* eslint-disable  @typescript-eslint/no-empty-function */\n\nvar React = __importStar(require(\"react\"));\n\nvar deep_equal_1 = __importDefault(require(\"deep-equal\"));\n\nvar preview_1 = require(\"@dcl/schemas/dist/dapps/preview\");\n\nvar debounce_1 = require(\"../../lib/debounce\");\n\nrequire(\"./WearablePreview.css\");\n\nvar debounce = (0, debounce_1.createDebounce)();\n\nvar WearablePreview =\n/** @class */\nfunction (_super) {\n  __extends(WearablePreview, _super);\n\n  function WearablePreview() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.state = {\n      isReady: false,\n      pendingOptions: null,\n      lastOptions: null\n    };\n    _this.iframe = null;\n\n    _this.getUrl = function () {\n      var _a = _this.props,\n          contractAddress = _a.contractAddress,\n          tokenId = _a.tokenId,\n          itemId = _a.itemId,\n          profile = _a.profile,\n          urns = _a.urns,\n          urls = _a.urls,\n          base64s = _a.base64s,\n          skin = _a.skin,\n          hair = _a.hair,\n          eyes = _a.eyes,\n          bodyShape = _a.bodyShape,\n          emote = _a.emote,\n          camera = _a.camera,\n          zoom = _a.zoom,\n          autoRotateSpeed = _a.autoRotateSpeed,\n          offsetX = _a.offsetX,\n          offsetY = _a.offsetY,\n          offsetZ = _a.offsetZ,\n          wheelZoom = _a.wheelZoom,\n          wheelPrecision = _a.wheelPrecision,\n          wheelStart = _a.wheelStart,\n          transparentBackground = _a.transparentBackground,\n          dev = _a.dev,\n          baseUrl = _a.baseUrl;\n      var contractParam = contractAddress ? \"contract=\".concat(contractAddress) : '';\n      var tokenParam = tokenId ? \"token=\".concat(tokenId) : '';\n      var itemParam = itemId ? \"item=\".concat(itemId) : '';\n      var profileParam = profile ? \"profile=\".concat(profile) : '';\n      var urnParams = urns && urns.length > 0 ? urns.map(function (urn) {\n        return \"urn=\".concat(urn);\n      }).join('&') : '';\n      var urlsParams = urls && urls.length > 0 ? urls.map(function (url) {\n        return \"url=\".concat(url);\n      }).join('&') : '';\n      var base64sParams = base64s && base64s.length > 0 ? base64s.map(function (base64) {\n        return \"base64=\".concat(base64);\n      }).join('&') : '';\n      var skinParam = skin ? \"skin=\".concat(skin) : '';\n      var hairParam = hair ? \"hair=\".concat(hair) : '';\n      var eyesParam = eyes ? \"eyes=\".concat(eyes) : '';\n      var bodyShapeParam = bodyShape ? \"bodyShape=\".concat(bodyShape) : '';\n      var emoteParam = emote ? \"emote=\".concat(emote) : '';\n      var cameraParam = camera ? \"camera=\".concat(camera) : '';\n      var zoomParam = !isNaN(zoom) ? \"zoom=\".concat(zoom) : '';\n      var autoRotateSpeedParam = !isNaN(autoRotateSpeed) ? \"autoRotateSpeed=\".concat(autoRotateSpeed) : '';\n      var offsetXParam = !isNaN(offsetX) ? \"offsetX=\".concat(offsetX) : '';\n      var offsetYParam = !isNaN(offsetY) ? \"offsetY=\".concat(offsetY) : '';\n      var offsetZParam = !isNaN(offsetZ) ? \"offsetZ=\".concat(offsetZ) : '';\n      var wheelZoomParam = !isNaN(wheelZoom) ? \"wheelZoom=\".concat(wheelZoom) : '';\n      var wheelPrecisionParam = !isNaN(wheelPrecision) ? \"wheelPrecision=\".concat(wheelPrecision) : '';\n      var wheelStartParam = !isNaN(wheelStart) ? \"wheelStart=\".concat(wheelStart) : '';\n      var transparentBackgroundParam = transparentBackground ? \"transparentBackground\" : '';\n      var envParam = dev ? \"env=dev\" : '';\n      var url = baseUrl + '?' + [contractParam, tokenParam, itemParam, profileParam, urnParams, urlsParams, base64sParams, skinParam, hairParam, eyesParam, bodyShapeParam, emoteParam, cameraParam, zoomParam, autoRotateSpeedParam, offsetXParam, offsetYParam, offsetZParam, wheelZoomParam, wheelPrecisionParam, wheelStartParam, transparentBackgroundParam, envParam].filter(function (param) {\n        return !!param;\n      }).join('&');\n      return url;\n    };\n\n    _this.getOptions = function () {\n      var _a = _this.props,\n          dev = _a.dev,\n          hotreload = _a.hotreload,\n          rest = __rest(_a, [\"dev\", \"hotreload\"]);\n\n      if (!hotreload) {\n        throw new Error('Should not generate options if hotreload is not turned on');\n      }\n\n      var options = {\n        env: dev ? preview_1.PreviewEnv.DEV : preview_1.PreviewEnv.PROD\n      };\n\n      for (var key in rest) {\n        if (typeof rest[key] !== 'function') {\n          options[key] = rest[key];\n        }\n      }\n\n      return options;\n    };\n\n    _this.handleMessage = function (event) {\n      var _a = _this.props,\n          baseUrl = _a.baseUrl,\n          onLoad = _a.onLoad,\n          onError = _a.onError;\n      var origin = event.origin;\n\n      if (origin === baseUrl) {\n        if (event.data && event.data.type) {\n          var type = event.data.type;\n\n          switch (type) {\n            case preview_1.PreviewMessageType.LOAD:\n              {\n                onLoad();\n                break;\n              }\n\n            case preview_1.PreviewMessageType.ERROR:\n              {\n                var payload = event.data.payload;\n                onError(new Error(payload.message));\n                break;\n              }\n\n            case preview_1.PreviewMessageType.READY:\n              {\n                var _b = _this.state,\n                    isReady = _b.isReady,\n                    pendingOptions = _b.pendingOptions; // ignore if already flagged as ready\n\n                if (isReady) {\n                  return;\n                }\n\n                if (pendingOptions !== null) {\n                  // if there were pending options, flush them and flag as ready\n                  _this.sendUpdate(pendingOptions);\n\n                  _this.setState({\n                    isReady: true,\n                    pendingOptions: null\n                  });\n                } else {\n                  // otherwise just flag as ready\n                  _this.setState({\n                    isReady: true\n                  });\n                }\n\n                break;\n              }\n\n            default: // do nothing\n\n          }\n        }\n      }\n    };\n\n    _this.handleUpdate = function () {\n      if (_this.iframe) {\n        // SSR check\n        if (window) {\n          var options = _this.getOptions();\n\n          if (_this.state.isReady) {\n            // if the iframe is ready, send the update\n            _this.sendUpdate(options);\n          } else {\n            // otherwise store last update in state until it's ready\n            _this.setState({\n              pendingPreviewOptions: options\n            });\n          }\n        }\n      } else {\n        console.warn(\"Could not send update, iframe is not referenced\");\n      }\n    };\n\n    _this.sendUpdate = function (options) {\n      var lastOptions = _this.state.lastOptions; // only send update if new options are different\n\n      if (!lastOptions || !(0, deep_equal_1.default)(options, lastOptions)) {\n        // send message to iframe\n        (0, preview_1.sendMessage)(_this.iframe.contentWindow, preview_1.PreviewMessageType.UPDATE, {\n          options: options\n        }); // callback\n\n        var onUpdate = _this.props.onUpdate;\n\n        if (onUpdate) {\n          onUpdate(options);\n        } // store options on state\n\n\n        _this.setState({\n          lastOptions: options\n        });\n      }\n    };\n\n    _this.refIframe = function (iframe) {\n      _this.iframe = iframe;\n    };\n\n    return _this;\n  }\n\n  WearablePreview.prototype.componentDidMount = function () {\n    window.addEventListener('message', this.handleMessage, false);\n    this.setState({\n      url: this.getUrl()\n    });\n  };\n\n  WearablePreview.prototype.componentWillUnmount = function () {\n    window.removeEventListener('message', this.handleMessage, false);\n  };\n\n  WearablePreview.prototype.componentDidUpdate = function () {\n    if (this.props.hotreload) {\n      debounce(this.handleUpdate, 500);\n    }\n  };\n\n  WearablePreview.prototype.render = function () {\n    if (this.props.tokenId && this.props.itemId) {\n      console.warn('You should NOT use `tokenId` and `itemId` props simultaneously');\n    }\n\n    return React.createElement(\"iframe\", {\n      id: this.props.id,\n      className: \"WearablePreview\",\n      src: this.props.hotreload ? this.state.url : this.getUrl(),\n      width: \"100%\",\n      height: \"100%\",\n      frameBorder: \"0\",\n      ref: this.refIframe\n    });\n  };\n\n  WearablePreview.defaultProps = {\n    dev: false,\n    baseUrl: 'https://wearable-preview.decentraland.org',\n    onLoad: function onLoad() {},\n    onError: function onError() {}\n  };\n  return WearablePreview;\n}(React.PureComponent);\n\nexports.WearablePreview = WearablePreview;","map":null,"metadata":{},"sourceType":"script"}