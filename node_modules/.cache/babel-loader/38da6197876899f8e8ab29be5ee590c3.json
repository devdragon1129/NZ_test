{"ast":null,"code":"import _regeneratorRuntime from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _slicedToArray from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _asyncToGenerator from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"/opt/work/NZ_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"/opt/work/NZ_test/src/components/Modals/CreateAssetPackModal/CreateAssetPackModal.tsx\";\nimport * as React from 'react';\nimport uuidv4 from 'uuid/v4';\nimport { Button, ModalNavigation, Row } from 'decentraland-ui';\nimport { getAnalytics } from 'decentraland-dapps/dist/modules/analytics/utils';\nimport { t } from 'decentraland-dapps/dist/modules/translation/utils';\nimport Modal from 'decentraland-dapps/dist/containers/Modal';\nimport { ProgressStage } from 'modules/assetPack/types';\nimport AssetPackEditor from 'components/AssetPackEditor';\nimport { convertToFullAssetPack } from 'modules/assetPack/utils';\nimport AssetImporter from 'components/AssetImporter';\nimport AssetsEditor from 'components/AssetsEditor';\nimport WalletLoginModal from '../WalletLoginModal';\nimport { CreateAssetPackView } from './CreateAssetPackModal.types';\nimport './CreateAssetPackModal.css';\n\nvar CreateAssetPackModal = /*#__PURE__*/function (_React$PureComponent) {\n  _inherits(CreateAssetPackModal, _React$PureComponent);\n\n  function CreateAssetPackModal() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, CreateAssetPackModal);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(CreateAssetPackModal)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      view: _this.props.isLoggedIn ? CreateAssetPackView.IMPORT : CreateAssetPackView.LOGIN,\n      back: CreateAssetPackView.IMPORT,\n      assetPack: _this.getAssetPack()\n    };\n    _this.analytics = getAnalytics();\n\n    _this.handleAssetPackChange = function (assetPack) {\n      _this.setState({\n        assetPack: assetPack\n      });\n    };\n\n    _this.handleAssetImportSubmit = function (assetPack) {\n      _this.analytics.track('Create Asset Pack Assets Review');\n\n      _this.setState({\n        assetPack: assetPack,\n        view: CreateAssetPackView.EDIT_ASSETS\n      });\n    };\n\n    _this.handleAssetEditorSubmit = function (assetPack) {\n      _this.analytics.track('Create Asset Pack Review');\n\n      _this.setState({\n        assetPack: assetPack,\n        view: CreateAssetPackView.EDIT_ASSET_PACK\n      });\n    };\n\n    _this.handleAssetPackEditorSubmit = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(assetPack) {\n        var _yield$convertToFullA, _yield$convertToFullA2, fullAssetPack, contents;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return convertToFullAssetPack(assetPack);\n\n              case 2:\n                _yield$convertToFullA = _context.sent;\n                _yield$convertToFullA2 = _slicedToArray(_yield$convertToFullA, 2);\n                fullAssetPack = _yield$convertToFullA2[0];\n                contents = _yield$convertToFullA2[1];\n\n                _this.props.onCreateAssetPack(fullAssetPack, contents);\n\n              case 7:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    _this.handleReset = function () {\n      _this.setState({\n        view: CreateAssetPackView.IMPORT,\n        assetPack: _this.getAssetPack()\n      });\n    };\n\n    _this.handleLogin = function () {\n      var _this$props = _this.props,\n          project = _this$props.project,\n          onOpenModal = _this$props.onOpenModal;\n\n      if (project) {\n        onOpenModal('WalletLoginModal');\n      }\n    };\n\n    _this.handleClose = function () {\n      var view = _this.state.view;\n      var onClose = _this.props.onClose;\n\n      switch (view) {\n        case CreateAssetPackView.LOGIN:\n        case CreateAssetPackView.SUCCESS:\n        case CreateAssetPackView.IMPORT:\n          onClose();\n          break;\n\n        case CreateAssetPackView.EDIT_ASSETS:\n        case CreateAssetPackView.EDIT_ASSET_PACK:\n          _this.setState({\n            view: CreateAssetPackView.EXIT,\n            back: view\n          });\n\n          break;\n\n        case CreateAssetPackView.EXIT:\n        case CreateAssetPackView.PROGRESS:\n          // can't close here\n          break;\n      }\n    };\n\n    _this.handleBack = function () {\n      _this.setState({\n        view: _this.state.back\n      });\n    };\n\n    _this.renderAssetImport = function () {\n      var assetPack = _this.state.assetPack;\n      var onClose = _this.props.onClose;\n      return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(ModalNavigation, {\n        title: t('asset_pack.title_create'),\n        subtitle: t('asset_pack.import.description_create'),\n        onClose: onClose,\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 135,\n          columnNumber: 9\n        }\n      }), /*#__PURE__*/React.createElement(Modal.Content, {\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 136,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(AssetImporter, {\n        assetPack: assetPack,\n        onSubmit: _this.handleAssetImportSubmit,\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 137,\n          columnNumber: 11\n        }\n      })));\n    };\n\n    _this.renderAssetEditor = function () {\n      var assetPack = _this.state.assetPack;\n      return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(ModalNavigation, {\n        title: t('asset_pack.title_create'),\n        subtitle: t('asset_pack.edit_asset.description_create'),\n        onClose: _this.handleClose,\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 147,\n          columnNumber: 9\n        }\n      }), /*#__PURE__*/React.createElement(Modal.Content, {\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 152,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(AssetsEditor, {\n        assetPack: assetPack,\n        onChange: _this.handleAssetPackChange,\n        onSubmit: _this.handleAssetEditorSubmit,\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 153,\n          columnNumber: 11\n        }\n      })));\n    };\n\n    _this.renderAssetpackEditor = function () {\n      var error = _this.props.error;\n      var assetPack = _this.state.assetPack;\n      return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(ModalNavigation, {\n        title: t('asset_pack.title_create'),\n        subtitle: t('asset_pack.edit_assetpack.description_create'),\n        onClose: _this.handleClose,\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 164,\n          columnNumber: 9\n        }\n      }), /*#__PURE__*/React.createElement(Modal.Content, {\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 169,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(AssetPackEditor, {\n        assetPack: assetPack,\n        onChange: _this.handleAssetPackChange,\n        onSubmit: _this.handleAssetPackEditorSubmit,\n        onReset: _this.handleReset,\n        error: error,\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 170,\n          columnNumber: 11\n        }\n      })));\n    };\n\n    _this.renderProgress = function () {\n      var progress = _this.props.progress;\n      var className = 'progress-bar';\n\n      if (progress.value === 100) {\n        className += ' active';\n      }\n\n      return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(ModalNavigation, {\n        title: t('asset_pack.progress.creating_asset_pack'),\n        subtitle: t('asset_pack.progress.uploading_contents'),\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 192,\n          columnNumber: 9\n        }\n      }), /*#__PURE__*/React.createElement(Modal.Content, {\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 193,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"progress-bar-container\",\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 194,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: className,\n        style: {\n          width: \"\".concat(progress.value, \"%\")\n        },\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 195,\n          columnNumber: 13\n        }\n      }))));\n    };\n\n    _this.renderSuccess = function () {\n      return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(ModalNavigation, {\n        title: t('asset_pack.success.title'),\n        subtitle: t('asset_pack.success.description'),\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 205,\n          columnNumber: 9\n        }\n      }), /*#__PURE__*/React.createElement(Modal.Content, {\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 206,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(Row, {\n        center: true,\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 207,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(Button, {\n        primary: true,\n        onClick: _this.props.onClose,\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 208,\n          columnNumber: 13\n        }\n      }, t('asset_pack.success.continue')))));\n    };\n\n    return _this;\n  }\n\n  _createClass(CreateAssetPackModal, [{\n    key: \"componentWillReceiveProps\",\n    value: function componentWillReceiveProps(nextProps) {\n      if (!this.props.isLoggedIn && nextProps.isLoggedIn) {\n        this.setState({\n          view: CreateAssetPackView.IMPORT\n        });\n      }\n    }\n  }, {\n    key: \"getDefaultAssetPackName\",\n    value: function getDefaultAssetPackName() {\n      var assetPacks = this.props.assetPacks;\n      var defaultName = t('asset_pack.default_name');\n      var name = defaultName;\n      var suffix = 2;\n\n      while (assetPacks.some(function (assetPack) {\n        return assetPack.title === name;\n      })) {\n        name = t('asset_pack.default_name_suffix', {\n          suffix: suffix\n        });\n        suffix++;\n      }\n\n      return name;\n    }\n  }, {\n    key: \"getAssetPack\",\n    value: function getAssetPack() {\n      var ethAddress = this.props.ethAddress;\n      var existingAssetPack = this.state ? this.state.assetPack : null;\n      var id = uuidv4();\n      return {\n        id: id,\n        title: existingAssetPack ? existingAssetPack.title : this.getDefaultAssetPackName(),\n        thumbnail: existingAssetPack ? existingAssetPack.thumbnail : '',\n        url: \"\".concat(id, \".json\"),\n        ethAddress: ethAddress || null,\n        assets: []\n      };\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate() {\n      var _this$props2 = this.props,\n          progress = _this$props2.progress,\n          error = _this$props2.error,\n          isLoading = _this$props2.isLoading;\n      var view = this.state.view;\n\n      if (progress.stage === ProgressStage.UPLOAD_CONTENTS && progress.value === 100 && !error && !isLoading) {\n        view = CreateAssetPackView.SUCCESS;\n      } else if (progress.stage !== ProgressStage.NONE && !error) {\n        view = CreateAssetPackView.PROGRESS;\n      } else if (view !== CreateAssetPackView.EXIT && error) {\n        view = CreateAssetPackView.EDIT_ASSET_PACK;\n      }\n\n      this.setState({\n        view: view\n      });\n    }\n  }, {\n    key: \"renderLogin\",\n    value: function renderLogin() {\n      var _this$props3 = this.props,\n          name = _this$props3.name,\n          onClose = _this$props3.onClose;\n      return /*#__PURE__*/React.createElement(WalletLoginModal, {\n        name: name,\n        onClose: onClose,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 219,\n          columnNumber: 12\n        }\n      });\n    }\n  }, {\n    key: \"renderExit\",\n    value: function renderExit() {\n      var onClose = this.props.onClose;\n      return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(ModalNavigation, {\n        title: t('asset_pack.exit.title_create'),\n        subtitle: t('asset_pack.exit.description_create'),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 226,\n          columnNumber: 9\n        }\n      }), /*#__PURE__*/React.createElement(Modal.Actions, {\n        className: \"exit-actions\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 227,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(Button, {\n        primary: true,\n        onClick: onClose,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 228,\n          columnNumber: 11\n        }\n      }, t('asset_pack.exit.action')), /*#__PURE__*/React.createElement(Button, {\n        onClick: this.handleBack,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 231,\n          columnNumber: 11\n        }\n      }, t('asset_pack.exit.back'))));\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var name = this.props.name;\n      var view = this.state.view;\n\n      if (view === CreateAssetPackView.LOGIN) {\n        return this.renderLogin();\n      }\n\n      var content;\n      var className = name;\n\n      switch (view) {\n        case CreateAssetPackView.IMPORT:\n          content = this.renderAssetImport();\n          break;\n\n        case CreateAssetPackView.EDIT_ASSETS:\n          content = this.renderAssetEditor();\n          break;\n\n        case CreateAssetPackView.EDIT_ASSET_PACK:\n          content = this.renderAssetpackEditor();\n          break;\n\n        case CreateAssetPackView.PROGRESS:\n          content = this.renderProgress();\n          break;\n\n        case CreateAssetPackView.SUCCESS:\n          content = this.renderSuccess();\n          break;\n\n        case CreateAssetPackView.EXIT:\n          content = this.renderExit();\n          className += ' narrow';\n          break;\n\n        default:\n          content = null;\n      }\n\n      return /*#__PURE__*/React.createElement(Modal, {\n        name: name,\n        className: className,\n        onClose: this.handleClose,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 272,\n          columnNumber: 7\n        }\n      }, content);\n    }\n  }]);\n\n  return CreateAssetPackModal;\n}(React.PureComponent);\n\nexport { CreateAssetPackModal as default };","map":{"version":3,"sources":["/opt/work/NZ_test/src/components/Modals/CreateAssetPackModal/CreateAssetPackModal.tsx"],"names":["React","uuidv4","Button","ModalNavigation","Row","getAnalytics","t","Modal","ProgressStage","AssetPackEditor","convertToFullAssetPack","AssetImporter","AssetsEditor","WalletLoginModal","CreateAssetPackView","CreateAssetPackModal","state","view","props","isLoggedIn","IMPORT","LOGIN","back","assetPack","getAssetPack","analytics","handleAssetPackChange","setState","handleAssetImportSubmit","track","EDIT_ASSETS","handleAssetEditorSubmit","EDIT_ASSET_PACK","handleAssetPackEditorSubmit","fullAssetPack","contents","onCreateAssetPack","handleReset","handleLogin","project","onOpenModal","handleClose","onClose","SUCCESS","EXIT","PROGRESS","handleBack","renderAssetImport","renderAssetEditor","renderAssetpackEditor","error","renderProgress","progress","className","value","width","renderSuccess","nextProps","assetPacks","defaultName","name","suffix","some","title","ethAddress","existingAssetPack","id","getDefaultAssetPackName","thumbnail","url","assets","isLoading","stage","UPLOAD_CONTENTS","NONE","renderLogin","content","renderExit","PureComponent"],"mappings":"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","sourcesContent":["import * as React from 'react'\nimport uuidv4 from 'uuid/v4'\nimport { Button, ModalNavigation, Row } from 'decentraland-ui'\nimport { getAnalytics } from 'decentraland-dapps/dist/modules/analytics/utils'\nimport { t } from 'decentraland-dapps/dist/modules/translation/utils'\nimport Modal from 'decentraland-dapps/dist/containers/Modal'\nimport { RawAssetPack, ProgressStage } from 'modules/assetPack/types'\nimport AssetPackEditor from 'components/AssetPackEditor'\nimport { convertToFullAssetPack } from 'modules/assetPack/utils'\nimport AssetImporter from 'components/AssetImporter'\nimport AssetsEditor from 'components/AssetsEditor'\nimport WalletLoginModal from '../WalletLoginModal'\n\nimport { Props, State, CreateAssetPackView } from './CreateAssetPackModal.types'\nimport './CreateAssetPackModal.css'\n\nexport default class CreateAssetPackModal extends React.PureComponent<Props, State> {\n  state: State = {\n    view: this.props.isLoggedIn ? CreateAssetPackView.IMPORT : CreateAssetPackView.LOGIN,\n    back: CreateAssetPackView.IMPORT,\n    assetPack: this.getAssetPack()\n  }\n\n  analytics = getAnalytics()\n\n  componentWillReceiveProps(nextProps: Props) {\n    if (!this.props.isLoggedIn && nextProps.isLoggedIn) {\n      this.setState({ view: CreateAssetPackView.IMPORT })\n    }\n  }\n\n  getDefaultAssetPackName() {\n    const { assetPacks } = this.props\n    const defaultName = t('asset_pack.default_name')\n    let name = defaultName\n    let suffix = 2\n    while (assetPacks.some(assetPack => assetPack.title === name)) {\n      name = t('asset_pack.default_name_suffix', { suffix })\n      suffix++\n    }\n    return name\n  }\n\n  getAssetPack() {\n    const { ethAddress } = this.props\n    const existingAssetPack = this.state ? this.state.assetPack : null\n    const id = uuidv4()\n    return {\n      id,\n      title: existingAssetPack ? existingAssetPack.title : this.getDefaultAssetPackName(),\n      thumbnail: existingAssetPack ? existingAssetPack.thumbnail : '',\n      url: `${id}.json`,\n      ethAddress: ethAddress || null,\n      assets: []\n    }\n  }\n\n  componentDidUpdate() {\n    const { progress, error, isLoading } = this.props\n    let view: CreateAssetPackView = this.state.view\n\n    if (progress.stage === ProgressStage.UPLOAD_CONTENTS && progress.value === 100 && !error && !isLoading) {\n      view = CreateAssetPackView.SUCCESS\n    } else if (progress.stage !== ProgressStage.NONE && !error) {\n      view = CreateAssetPackView.PROGRESS\n    } else if (view !== CreateAssetPackView.EXIT && error) {\n      view = CreateAssetPackView.EDIT_ASSET_PACK\n    }\n\n    this.setState({ view })\n  }\n\n  handleAssetPackChange = (assetPack: RawAssetPack) => {\n    this.setState({ assetPack })\n  }\n\n  handleAssetImportSubmit = (assetPack: RawAssetPack) => {\n    this.analytics.track('Create Asset Pack Assets Review')\n    this.setState({ assetPack, view: CreateAssetPackView.EDIT_ASSETS })\n  }\n\n  handleAssetEditorSubmit = (assetPack: RawAssetPack) => {\n    this.analytics.track('Create Asset Pack Review')\n    this.setState({ assetPack, view: CreateAssetPackView.EDIT_ASSET_PACK })\n  }\n\n  handleAssetPackEditorSubmit = async (assetPack: RawAssetPack) => {\n    const [fullAssetPack, contents] = await convertToFullAssetPack(assetPack)\n    this.props.onCreateAssetPack(fullAssetPack, contents)\n  }\n\n  handleReset = () => {\n    this.setState({\n      view: CreateAssetPackView.IMPORT,\n      assetPack: this.getAssetPack()\n    })\n  }\n\n  handleLogin = () => {\n    const { project, onOpenModal } = this.props\n    if (project) {\n      onOpenModal('WalletLoginModal')\n    }\n  }\n\n  handleClose = () => {\n    const { view } = this.state\n    const { onClose } = this.props\n    switch (view) {\n      case CreateAssetPackView.LOGIN:\n      case CreateAssetPackView.SUCCESS:\n      case CreateAssetPackView.IMPORT:\n        onClose()\n        break\n      case CreateAssetPackView.EDIT_ASSETS:\n      case CreateAssetPackView.EDIT_ASSET_PACK:\n        this.setState({ view: CreateAssetPackView.EXIT, back: view })\n        break\n      case CreateAssetPackView.EXIT:\n      case CreateAssetPackView.PROGRESS:\n        // can't close here\n        break\n    }\n  }\n\n  handleBack = () => {\n    this.setState({ view: this.state.back })\n  }\n\n  renderAssetImport = () => {\n    const { assetPack } = this.state\n    const { onClose } = this.props\n    return (\n      <>\n        <ModalNavigation title={t('asset_pack.title_create')} subtitle={t('asset_pack.import.description_create')} onClose={onClose} />\n        <Modal.Content>\n          <AssetImporter assetPack={assetPack} onSubmit={this.handleAssetImportSubmit} />\n        </Modal.Content>\n      </>\n    )\n  }\n\n  renderAssetEditor = () => {\n    const { assetPack } = this.state\n    return (\n      <>\n        <ModalNavigation\n          title={t('asset_pack.title_create')}\n          subtitle={t('asset_pack.edit_asset.description_create')}\n          onClose={this.handleClose}\n        />\n        <Modal.Content>\n          <AssetsEditor assetPack={assetPack!} onChange={this.handleAssetPackChange} onSubmit={this.handleAssetEditorSubmit} />\n        </Modal.Content>\n      </>\n    )\n  }\n\n  renderAssetpackEditor = () => {\n    const { error } = this.props\n    const { assetPack } = this.state\n    return (\n      <>\n        <ModalNavigation\n          title={t('asset_pack.title_create')}\n          subtitle={t('asset_pack.edit_assetpack.description_create')}\n          onClose={this.handleClose}\n        />\n        <Modal.Content>\n          <AssetPackEditor\n            assetPack={assetPack!}\n            onChange={this.handleAssetPackChange}\n            onSubmit={this.handleAssetPackEditorSubmit}\n            onReset={this.handleReset}\n            error={error}\n          />\n        </Modal.Content>\n      </>\n    )\n  }\n\n  renderProgress = () => {\n    const { progress } = this.props\n    let className = 'progress-bar'\n\n    if (progress.value === 100) {\n      className += ' active'\n    }\n\n    return (\n      <>\n        <ModalNavigation title={t('asset_pack.progress.creating_asset_pack')} subtitle={t('asset_pack.progress.uploading_contents')} />\n        <Modal.Content>\n          <div className=\"progress-bar-container\">\n            <div className={className} style={{ width: `${progress.value}%` }} />\n          </div>\n        </Modal.Content>\n      </>\n    )\n  }\n\n  renderSuccess = () => {\n    return (\n      <>\n        <ModalNavigation title={t('asset_pack.success.title')} subtitle={t('asset_pack.success.description')} />\n        <Modal.Content>\n          <Row center>\n            <Button primary onClick={this.props.onClose}>\n              {t('asset_pack.success.continue')}\n            </Button>\n          </Row>\n        </Modal.Content>\n      </>\n    )\n  }\n\n  renderLogin() {\n    const { name, onClose } = this.props\n    return <WalletLoginModal name={name} onClose={onClose} />\n  }\n\n  renderExit() {\n    const { onClose } = this.props\n    return (\n      <>\n        <ModalNavigation title={t('asset_pack.exit.title_create')} subtitle={t('asset_pack.exit.description_create')} />\n        <Modal.Actions className=\"exit-actions\">\n          <Button primary onClick={onClose}>\n            {t('asset_pack.exit.action')}\n          </Button>\n          <Button onClick={this.handleBack}>{t('asset_pack.exit.back')}</Button>\n        </Modal.Actions>\n      </>\n    )\n  }\n\n  render() {\n    const { name } = this.props\n    const { view } = this.state\n\n    if (view === CreateAssetPackView.LOGIN) {\n      return this.renderLogin()\n    }\n\n    let content\n    let className = name\n    switch (view) {\n      case CreateAssetPackView.IMPORT:\n        content = this.renderAssetImport()\n        break\n      case CreateAssetPackView.EDIT_ASSETS:\n        content = this.renderAssetEditor()\n        break\n      case CreateAssetPackView.EDIT_ASSET_PACK:\n        content = this.renderAssetpackEditor()\n        break\n      case CreateAssetPackView.PROGRESS:\n        content = this.renderProgress()\n        break\n      case CreateAssetPackView.SUCCESS:\n        content = this.renderSuccess()\n        break\n      case CreateAssetPackView.EXIT:\n        content = this.renderExit()\n        className += ' narrow'\n        break\n      default:\n        content = null\n    }\n\n    return (\n      <Modal name={name} className={className} onClose={this.handleClose}>\n        {content}\n      </Modal>\n    )\n  }\n}\n"]},"metadata":{},"sourceType":"module"}