{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar isFunction_1 = __importDefault(require(\"lodash/fp/isFunction\"));\n\nvar isObject_1 = __importDefault(require(\"lodash/fp/isObject\"));\n\nvar actions_1 = require(\"./actions\");\n\nvar warnings_1 = require(\"./warnings\");\n\nfunction defaultTransformer(state) {\n  return state;\n}\n\nfunction isValidAction(action) {\n  var isFunc = isFunction_1.default(action);\n  var isObj = isObject_1.default(action);\n  var hasType = isObj && action.hasOwnProperty('type');\n\n  if (!isFunc && isObj && hasType) {\n    return true;\n  }\n\n  if (process.env.NODE_ENV !== 'production') {\n    if (isFunc) {\n      console.warn(warnings_1.receivedFunctionalAction());\n    } else if (!isObj) {\n      console.warn(warnings_1.receivedNonObjectAction(action));\n    } else if (!hasType) {\n      console.warn(warnings_1.missingActionType());\n    }\n  }\n\n  return false;\n}\n\nfunction createMiddleware(engine) {\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var opts = Object.assign({\n    disableDispatchSaveAction: false\n  }, options);\n  return function (store) {\n    var dispatch = store.dispatch,\n        getState = store.getState;\n    return function (next) {\n      return function (action) {\n        var result = next(action);\n\n        if (!isValidAction(action)) {\n          return result;\n        }\n\n        var isOwnAction = action.type === actions_1.SAVE || action.type === actions_1.LOAD;\n        var isBlacklisted = isOwnAction || options.filterAction && !options.filterAction(action);\n\n        if (!isBlacklisted) {\n          var transform = options.transform || defaultTransformer;\n          var saveState = transform(getState());\n          var saveAction = actions_1.save(saveState);\n\n          if (process.env.NODE_ENV !== 'production') {\n            if (!saveAction.meta) {\n              saveAction.meta = {};\n            }\n\n            saveAction.meta.origin = action;\n          }\n\n          var dispatchSave = function dispatchSave() {\n            return dispatch(saveAction);\n          };\n\n          engine.save(saveState).then(function () {\n            if (opts.disableDispatchSaveAction === false) {\n              return dispatchSave();\n            }\n          }, function (e) {\n            if (options.onError) {\n              options.onError(e, store);\n            } else {\n              if (process.env.NODE_ENV !== 'production') {\n                console.warn(warnings_1.defaultErrorHandler());\n              }\n\n              console.error(e);\n            }\n          });\n        }\n\n        return result;\n      };\n    };\n  };\n}\n\nexports.createMiddleware = createMiddleware;","map":null,"metadata":{},"sourceType":"script"}